class Ajax{constructor(){this.baseUrl="/api",this.token=localStorage.getItem("auth_token")||null}setToken(e){this.token=e,localStorage.setItem("auth_token",e)}async request(e,t="GET",n=null){const o=`${this.baseUrl}${e}`,a={method:t,headers:{"Content-Type":"application/json",Authorization:this.token?`Bearer ${this.token}`:""}};n&&(a.body=JSON.stringify(n));try{const e=await fetch(o,a);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(e){throw console.error("Błąd API:",e),e}}get(e){return this.request(e,"GET")}post(e,t){return this.request(e,"POST",t)}put(e,t){return this.request(e,"PUT",t)}delete(e){return this.request(e,"DELETE")}}const ajax=new Ajax;export default ajax;import ajax from"./ajax";document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("login-form"),t=document.getElementById("register-form"),n=document.getElementById("error-container");function o(){window.location.href="/dashboard"}function a(e){n&&(n.innerText=e,n.style.display="block")}function r(){n&&(n.innerText="",n.style.display="none")}function i(e,t,n=null){return!e||e.length<3?(a("Nazwa użytkownika musi mieć co najmniej 3 znaki."),!1):!t||t.length<6?(a("Hasło musi mieć co najmniej 6 znaków."),!1):null===n||t===n||(a("Hasła nie są identyczne."),!1)}function s(){localStorage.removeItem("auth_token"),window.location.href="/login"}e&&e.addEventListener("submit",(async function(t){t.preventDefault(),r();const n=new FormData(e),s=n.get("username").trim(),c=n.get("password").trim();if(!i(s,c))return;try{const e=await ajax.post("/login",{username:s,password:c});e.success?(ajax.setToken(e.token),o()):a(e.error||"Błąd podczas logowania.")}catch(e){console.error("Błąd logowania:",e),a("Wystąpił problem podczas logowania. Spróbuj ponownie.")}})),t&&t.addEventListener("submit",(async function(e){e.preventDefault(),r();const n=new FormData(t),s=n.get("username").trim(),c=n.get("password").trim(),d=n.get("confirm_password").trim();if(!i(s,c,d))return;try{const e=await ajax.post("/register",{username:s,password:c});e.success?(ajax.setToken(e.token),o()):a(e.error||"Błąd podczas rejestracji.")}catch(e){console.error("Błąd rejestracji:",e),a("Wystąpił problem podczas rejestracji. Spróbuj ponownie.")}})),setInterval((function(){const e=localStorage.getItem("auth_token");if(e)try{const t=1e3*JSON.parse(atob(e.split(".")[1])).exp;Date.now()>=t&&s()}catch(e){console.error("Błąd walidacji tokena:",e),s()}}),6e4)}));import ajax from"./ajax";async function fetchStatistics(){try{const e=await fetch("/api/statistics");if(!e.ok)throw new Error("Błąd odpowiedzi API");updateWidgets(await e.json())}catch(e){showErrorToast("Nie udało się pobrać statystyk."),console.error("Błąd pobierania statystyk:",e)}}function updateWidgets(e){updateWidget("total-users",e.totalUsers),updateWidget("active-sessions",e.activeSessions),updateWidget("new-bookings",e.newBookings),updateWidget("total-revenue",formatCurrency(e.totalRevenue))}function updateWidget(e,t){const n=document.getElementById(e);n&&(n.innerText=t??"Brak danych")}function handleResponsiveUpdates(){console.log("Aktualizacja UI na podstawie zmiany rozmiaru ekranu.")}function formatCurrency(e){return new Intl.NumberFormat("pl-PL",{style:"currency",currency:"PLN"}).format(e)}function checkUserActivity(){"visible"===document.visibilityState&&fetchStatistics()}function showErrorToast(e){const t=document.getElementById("toast-container");if(!t)return;const n=document.createElement("div");n.className="toast toast-error",n.innerText=e,t.appendChild(n),setTimeout((()=>n.remove()),4e3)}function initDocumentForm(){const e=document.getElementById("document-upload-form"),t=document.getElementById("sign-button"),n=document.getElementById("uploadButton");e&&e.addEventListener("submit",uploadDocument),t&&t.addEventListener("click",handleSignButtonClick),n&&n.addEventListener("change",handleFileSelection)}async function uploadDocument(e){e.preventDefault();const t=new FormData(e.target);try{const e=await fetch("/api/documents/upload",{method:"POST",body:t,headers:{Authorization:"Bearer "+getAuthToken()}}),n=await e.json();n.success?(alert("Dokument przesłany pomyślnie."),previewDocument(n.documentUrl)):showError("Błąd przesyłania dokumentu: "+n.message)}catch(e){console.error("Błąd przesyłania dokumentu:",e),showError("Wystąpił problem podczas przesyłania dokumentu.")}}function handleFileSelection(e){const t=e.target.files[0];t&&previewContract(t)}function previewDocument(e){const t=document.getElementById("document-preview");t&&(t.src=e,t.style.display="block")}function handleSignButtonClick(){const e=document.getElementById("document-id").value.trim();e?signDocument(e):showError("Brak wybranego dokumentu do podpisania.")}async function signDocument(e){try{const t=await fetch("/api/documents/sign",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+getAuthToken()},body:JSON.stringify({documentId:e})}),n=await t.json();n.success?alert("Dokument został pomyślnie podpisany."):showError("Błąd podpisywania dokumentu: "+n.message)}catch(e){console.error("Błąd podpisywania dokumentu:",e),showError("Wystąpił problem podczas podpisywania dokumentu.")}}function previewContract(e){const t=new FileReader;t.onload=function(e){const t=document.getElementById("contractPreview");t&&(t.src=e.target.result)},t.readAsDataURL(e)}function showError(e){const t=document.getElementById("error-container");t&&(t.innerText=e,t.style.display="block")}function getAuthToken(){return localStorage.getItem("auth_token")||""}function validateForm(e){let t=!0;return e.querySelectorAll("input[required], textarea[required], select[required]").forEach((e=>{validateInput(e)||(t=!1)})),t}function attachRealTimeValidation(e){e.querySelectorAll("input[required], textarea[required], select[required]").forEach((e=>{e.addEventListener("input",(function(){validateInput(e)}))}))}function validateInput(e){const t=e.value.trim(),n=e.type;return t?"email"!==n||isValidEmail(t)?"password"===n&&t.length<6?(showError(e,"Hasło musi zawierać co najmniej 6 znaków."),!1):e.dataset.minLength&&t.length<e.dataset.minLength?(showError(e,`To pole musi mieć co najmniej ${e.dataset.minLength} znaków.`),!1):(clearError(e),!0):(showError(e,"Wprowadź poprawny adres e-mail."),!1):(showError(e,"To pole jest wymagane."),!1)}function showError(e,t){let n=e.nextElementSibling;n&&n.classList.contains("error-message")||(n=document.createElement("div"),n.classList.add("error-message"),e.parentNode.insertBefore(n,e.nextSibling)),n.textContent=t,e.classList.add("error")}function clearError(e){let t=e.nextElementSibling;t&&t.classList.contains("error-message")&&t.remove(),e.classList.remove("error")}function isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("pickup-date"),t=document.getElementById("booking-form"),n=document.getElementById("error-container"),o=document.getElementById("loading-indicator");function a(){o&&(o.style.display="block")}function r(){o&&(o.style.display="none")}function i(e){n&&(n.innerText=e,n.style.display="block")}e&&e.addEventListener("change",(async function(){const t=e.value.trim();if(!t)return;a();try{const e=await fetch(`/vehicles/available?pickup_date=${t}`),n=await e.json();r(),n.vehicles&&n.vehicles.length>0?function(e){const t=document.getElementById("vehicles-container");t.innerHTML="",e.forEach((e=>{const n=document.createElement("div");n.className="vehicle",n.innerHTML=`\n                <p>${e.name}</p>\n                <p>${e.type}</p>\n            `,t.appendChild(n)}))}(n.vehicles):i("Brak dostępnych pojazdów na wybrany termin.")}catch(e){r(),console.error("Błąd pobierania dostępnych pojazdów:",e),i("Nie udało się pobrać dostępnych pojazdów.")}})),t&&t.addEventListener("submit",(async function(e){if(e.preventDefault(),function(){n&&(n.innerText="",n.style.display="none")}(),!function(){const e=document.getElementById("pickup-location").value.trim(),t=document.getElementById("dropoff-location").value.trim();if(!e||!t)return i("Miejsce odbioru i zwrotu są wymagane."),!1;return!0}()||!function(){let e=!0;return["pickup-date","return-date","pickup-location","dropoff-location"].forEach((t=>{const n=document.getElementById(t);n&&n.value.trim()||(i(`Pole ${t.replace("-"," ")} jest wymagane.`),e=!1)})),e}())return;const o=new FormData(t);a();try{const e=await fetch("/booking/create",{method:"POST",body:o}),t=await e.json();r(),t.success?(alert("Rezerwacja zakończona sukcesem!"),window.location.href="/bookings/view"):i(t.error||"Wystąpił problem podczas tworzenia rezerwacji.")}catch(e){r(),console.error("Błąd tworzenia rezerwacji:",e),i("Nie udało się utworzyć rezerwacji.")}}))})),document.addEventListener("DOMContentLoaded",(function(){fetchStatistics(),setInterval(checkUserActivity,6e4),window.addEventListener("resize",handleResponsiveUpdates)})),document.addEventListener("DOMContentLoaded",(function(){initDocumentForm()})),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll("form").forEach((e=>{e.addEventListener("submit",(function(t){validateForm(e)||t.preventDefault()})),attachRealTimeValidation(e)}))}));import ajax from"./ajax";async function fetchNotifications(){try{const e=await ajax.get("/notifications");e.length>0?displayNotifications(e):displayNoNotificationsMessage()}catch(e){console.error("Błąd pobierania powiadomień:",e)}}function displayNotifications(e){const t=document.getElementById("notifications-container");t&&(t.innerHTML="",e.forEach((e=>{const n=document.createElement("div");n.className="notification "+(e.read?"read":"unread"),n.innerHTML=`\n            <p>${e.message}</p>\n            <button class="mark-as-read" data-id="${e.id}">Oznacz jako przeczytane</button>\n        `,t.appendChild(n)})),attachMarkAsReadListeners())}function attachMarkAsReadListeners(){document.querySelectorAll(".mark-as-read").forEach((e=>{e.addEventListener("click",(function(){markAsRead(this.dataset.id)}))}))}async function markAsRead(e){try{const t=await fetch(`/notifications/${e}/read`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+getAuthToken()}}),n=await t.json();n.success?updateNotificationStatus(e):console.error("Błąd oznaczania powiadomienia jako przeczytanego:",n.error)}catch(e){console.error("Błąd oznaczania powiadomienia jako przeczytanego:",e)}}function updateNotificationStatus(e){const t=document.querySelector(`.mark-as-read[data-id="${e}"]`);t&&(t.closest(".notification").classList.add("read"),t.remove())}function displayNoNotificationsMessage(){const e=document.getElementById("notifications-container");e&&(e.innerHTML='<p class="text-muted">Brak nowych powiadomień.</p>')}function getAuthToken(){return localStorage.getItem("auth_token")||""}document.addEventListener("DOMContentLoaded",(function(){fetchNotifications()}));import ajax from"./ajax";async function updateProfile(e){e.preventDefault();const t=new FormData(e.target);if(validateProfileForm(t))try{const e=await fetch("/api/profile/update",{method:"POST",body:t}),n=await e.json();n.success?alert("Profile updated successfully"):alert("Error updating profile: "+n.message)}catch(e){console.error("Error updating profile:",e)}}function handleAvatarUpload(e){const t=e.target.files[0];if(t){const e=new FileReader;e.onload=function(e){document.getElementById("avatar-preview").src=e.target.result},e.readAsDataURL(t)}}function validateProfileForm(e){const t=e.get("name"),n=e.get("email"),o=e.get("password");return!(!t||!n||o&&o.length<6)||(alert("Please fill out all required fields and ensure password is at least 6 characters long."),!1)}function initProfileForm(){document.getElementById("profile-form").addEventListener("submit",updateProfile),document.getElementById("avatar-upload").addEventListener("change",handleAvatarUpload)}function showToast(e,t){const n=document.getElementById("toastContainer"),o=document.createElement("div");o.className=`toast align-items-center text-bg-${e} border-0 show`,o.role="alert",o.innerHTML=`\n        <div class="d-flex">\n            <div class="toast-body">${t}</div>\n            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n        </div>`,n.appendChild(o),setTimeout((()=>o.remove()),5e3)}function createToast(e,t,n=!0,o=3e3){const a=document.getElementById("toast-container");if(!a)return void console.error("Toast container not found");const r=document.createElement("div");r.className=`toast toast-${e}`,r.innerText=t,a.appendChild(r),n&&setTimeout((()=>{r.remove()}),o)}function showSuccessToast(e,t=!0,n=3e3){createToast("success",e,t,n)}function showWarningToast(e,t=!0,n=3e3){createToast("warning",e,t,n)}function showErrorToast(e,t=!0,n=3e3){createToast("error",e,t,n)}document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("paymentForm");function t(e){const t=document.getElementById("errorMessage");t.innerHTML="",e.forEach((function(e){t.innerHTML+=`<p>${e}</p>`}))}e.addEventListener("submit",(function(n){if(n.preventDefault(),function(){let e=!0;const t=document.getElementById("cardNumber").value,n=document.getElementById("expiryDate").value,o=document.getElementById("cvv").value,a=document.getElementById("errorMessage");a.innerHTML="",t.match(/^\d{16}$/)||(a.innerHTML+="<p>Invalid card number. Must be 16 digits.</p>",e=!1);n.match(/^\d{2}\/\d{2}$/)||(a.innerHTML+="<p>Invalid expiry date. Must be in MM/YY format.</p>",e=!1);o.match(/^\d{3}$/)||(a.innerHTML+="<p>Invalid CVV. Must be 3 digits.</p>",e=!1);return e}()){!async function(e){try{const n=await ajax.post("/payments",e);n.success?window.location.href="/booking/confirmation":t(n.errors)}catch(e){t(["An error occurred while processing the payment. Please try again."])}}(new FormData(e))}}))})),document.addEventListener("DOMContentLoaded",initProfileForm),document.getElementById("registerForm").addEventListener("submit",(async function(e){e.preventDefault();const t=new FormData(this),n=Object.fromEntries(t.entries());try{const e=await fetch("/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),t=await e.json();e.ok?(showToast("success","Registration successful! Welcome to Carfuse."),this.reset()):showToast("error",t.message||"Registration failed.")}catch(e){console.error("Error:",e),showToast("error","An unexpected error occurred.")}})),document.addEventListener("DOMContentLoaded",(()=>{let e=document.getElementById("toast-container");e||(e=document.createElement("div"),e.id="toast-container",document.body.appendChild(e))}));