=== public/.htaccess ===
RewriteEngine On
DirectoryIndex index.php

# Ensure PHP files are executed
AddHandler application/x-httpd-php .php

# Allow direct access to static files (CSS, JS, images)
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Redirect all other requests to /public/index.php
RewriteRule ^ /public/index.php [QSA,L]
=== public/layouts/header.php ===
=== public/layouts/footer.php ===
=== public/layouts/sidebar.php ===
<?php
/*
|--------------------------------------------------------------------------
| Sidebar - Nawigacja w Dashboardzie
|--------------------------------------------------------------------------
| Plik odpowiada za wy≈õwietlanie bocznego menu nawigacyjnego w dashboardzie.
| Umo≈ºliwia u≈ºytkownikom i administratorom prze≈ÇƒÖczanie siƒô miƒôdzy podstronami.
|
| ≈öcie≈ºka: App/Views/layouts/sidebar.php
*/
?>

<aside class="sidebar">
    <nav class="sidebar-menu">
        <ul>
            <li><a href="/user/dashboard" class="dashboard-link">üìä Panel</a></li>
            <li><a href="/bookings/view" class="dashboard-link">üìÖ Moje rezerwacje</a></li>
            <li><a href="/payments/history" class="dashboard-link">üí≥ Historia p≈Çatno≈õci</a></li>
            <li><a href="/documents/user_documents" class="dashboard-link">üìÑ Moje dokumenty</a></li>
            <li><a href="/user/notifications" class="dashboard-link">üîî Powiadomienia</a></li>
            <li><a href="/user/profile" class="dashboard-link">üë§ Profil</a></li>
            <li><a href="/admin/users" class="dashboard-link">üë• ZarzƒÖdzanie u≈ºytkownikami</a></li>
            <li><a href="/admin/audit_logs" class="dashboard-link">üìú Logi audytowe</a></li>
            <li><a href="/admin/logs" class="dashboard-link">üìÇ Logi systemowe</a></li>
            <li><a href="/admin/reports" class="dashboard-link">üìë Raporty</a></li>
            <li><a href="/admin/settings" class="dashboard-link">‚öôÔ∏è Ustawienia</a></li>
            <li><a href="/logout">üö™ Wyloguj</a></li>
        </ul>
    </nav>
</aside>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll(".dashboard-link").forEach(link => {
            link.addEventListener("click", function(e) {
                e.preventDefault();
                let targetView = this.getAttribute("href");
                fetch(targetView).then(response => response.text()).then(data => {
                    document.getElementById("dashboard-view").innerHTML = data;
                });
            });
        });
    });
</script>
=== public/layouts/main copy.php ===
<?php
/*
|--------------------------------------------------------------------------
| Global Layout Wrapper - main.php
|--------------------------------------------------------------------------
| This file ensures all views have a consistent layout with a header and footer.
|
| Path: public/layouts/main.php
*/

require_once __DIR__ . '/../bootstrap.php';
require_once __DIR__ . '/../vendor/autoload.php';
require_once __DIR__ . '/../App/Helpers/SecurityHelper.php';

// Ensure $view is set before including it
if (!isset($view) || !file_exists($view)) {
    die("Error: View file not found.");
}

// Include header
require_once __DIR__ . '/header.php';
?>

<main class="content">
    <?php include $view; ?>
</main>

<?php
// Include footer
require_once __DIR__ . '/footer.php';
?>
=== public/layouts/modals.php ===
<?php
/*
|--------------------------------------------------------------------------
| Modale - Okna Modalne
|--------------------------------------------------------------------------
| Plik zawiera globalne okna modalne wykorzystywane w aplikacji.
|
| ≈öcie≈ºka: App/Views/layouts/modals.php
*/
?>

<div id="globalModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="modalTitle"></h2>
        <div id="modalBody"></div>
        <button class="btn btn-primary" id="modalConfirm">OK</button>
    </div>
</div>
=== public/layouts/main.php ===
<?php
/*
|--------------------------------------------------------------------------
| Global Layout Wrapper - main.php
|--------------------------------------------------------------------------
| This wrapper ensures that every view is displayed inside a structured
| layout with a header and footer.
|
| Path: public/layouts/main.php
*/

require_once __DIR__ . '/../layouts/header.php';
?>

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/public/css/dashboard.css">
    <script src="/public/js/dashboard.js" defer></script>
</head>
<body>

<?php include __DIR__ . '/../layouts/header.php'; ?>

<div class="dashboard-container">
    <aside class="sidebar">
        <?php
        if ($userRole === 'admin') {
            include __DIR__ . '/../layouts/sidebars/admin_sidebar.php';
        } else {
            include __DIR__ . '/../layouts/sidebars/user_sidebar.php';
        }
        ?>
    </aside>
    <main class="main-content">
        <?php include $view; ?>
    </main>
</div>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

</body>
</html>
=== public/layouts/alerts.php ===
<?php
/*
|--------------------------------------------------------------------------
| Alerts - Globalne Powiadomienia
|--------------------------------------------------------------------------
| Plik odpowiada za wy≈õwietlanie globalnych alert√≥w i powiadomie≈Ñ.
|
| ≈öcie≈ºka: App/Views/layouts/alerts.php
*/
?>

<div id="alert-container"></div>
=== public/layouts/navbar.php ===
<?php
/*
|--------------------------------------------------------------------------
| Navbar - G√≥rna Nawigacja Dashboardu
|--------------------------------------------------------------------------
| Plik odpowiada za wy≈õwietlanie g√≥rnej belki nawigacyjnej w dashboardzie.
| Pokazuje podstawowe opcje nawigacyjne i dostƒôp do ustawie≈Ñ konta.
|
| ≈öcie≈ºka: App/Views/layouts/navbar.php
*/
?>

<nav class="navbar">
    <div class="container">
        <a href="/dashboard" class="logo">üöó CarFuse</a>
        <ul class="nav-links">
            <li><a href="/user/profile" class="dashboard-link">üë§ M√≥j Profil</a></li>
            <li><a href="/user/notifications" class="dashboard-link">üîî Powiadomienia</a></li>
            <li><a href="/logout">üö™ Wyloguj</a></li>
        </ul>
    </div>
</nav>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll(".dashboard-link").forEach(link => {
            link.addEventListener("click", function(e) {
                e.preventDefault();
                let targetView = this.getAttribute("href");
                fetch(targetView).then(response => response.text()).then(data => {
                    document.getElementById("dashboard-view").innerHTML = data;
                });
            });
        });
    });
</script>
=== public/css/style.css ===
/* Dark Minimal Theme */
body {
    background-color: #121212;
    color: #fff;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
}
header {
    background-color: #181818;
    text-align: center;
    padding: 15px 0;
}
.logo img {
    max-height: 104px;
    margin: 15px 0;
}
nav {
    display: flex;
    justify-content: center;
    padding: 15px 0;
}
nav a {
    color: #fff;
    text-decoration: none;
    margin: 0 15px;
    font-size: 18px;
}
nav a:hover {
    color: #FFD700;
}

/* Hero Section */
.hero {
    text-align: center;
    padding: 100px 20px;
    background: url('/public/images/hero-bg.jpg') no-repeat center center/cover;
}
.hero h1 {
    font-size: 48px;
    margin-bottom: 20px;
    text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
}
.hero p {
    font-size: 20px;
    opacity: 0.8;
    margin-bottom: 30px;
}

/* Search Form */
.search-form {
    display: flex;
    justify-content: center;
    gap: 10px;
}
.search-form input, .search-form button {
    padding: 12px;
    font-size: 16px;
    border-radius: 5px;
    border: none;
}
.search-form button {
    background: #FFD700;
    color: #121212;
    font-weight: bold;
    cursor: pointer;
}
.search-form button:hover {
    background: #FFC107;
}

/* Features Section */
.features {
    text-align: center;
    padding: 60px 20px;
}
.features h2 {
    font-size: 36px;
    margin-bottom: 20px;
}
.feature-list {
    display: flex;
    justify-content: center;
    gap: 50px;
}
.feature {
    font-size: 18px;
    background: #181818;
    padding: 20px;
    border-radius: 5px;
}

/* Footer */
.footer {
    text-align: center;
    padding: 20px;
    background: #181818;
    opacity: 0.8;
}

/* Error Message */
.error-message {
    color: #FF4C4C;
    display: none;
}
=== public/css/profile.css ===
/*
|--------------------------------------------------------------------------
| Profile Styles (profile.css)
|--------------------------------------------------------------------------
| This file contains styles for the user profile page, including form fields,
| avatar upload, and account settings. Designed with a sleek, modern look.
*/

/* General Profile Page Styles */
body {
    background-color: #121212;
    color: #ffffff;
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
}

.profile-container {
    max-width: 600px;
    margin: 40px auto;
    background: #1E1E1E;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(255, 255, 255, 0.1);
    text-align: center;
}

.profile-container h2 {
    font-size: 2rem;
    margin-bottom: 20px;
}

/* Avatar Upload */
.avatar-upload {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 20px;
}

.avatar-preview {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    border: 3px solid #FFD700;
    object-fit: cover;
    margin-bottom: 10px;
}

.avatar-upload input[type="file"] {
    display: none;
}

.upload-label {
    background: linear-gradient(45deg, #FFD700, #FF8C00);
    color: #121212;
    font-weight: bold;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s;
}

.upload-label:hover {
    background: linear-gradient(45deg, #FFC107, #FF4500);
}

/* Profile Form */
.profile-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.profile-form input, .profile-form select, .profile-form button {
    padding: 12px;
    font-size: 1rem;
    border-radius: 5px;
    border: none;
}

.profile-form input, .profile-form select {
    background: #333;
    color: #fff;
    border: 1px solid #444;
    width: 100%;
}

.profile-form input:focus, .profile-form select:focus {
    border-color: #FFD700;
    outline: 0;
}

.profile-form button {
    background: linear-gradient(45deg, #FFD700, #FF8C00);
    color: #121212;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s;
}

.profile-form button:hover {
    background: linear-gradient(45deg, #FFC107, #FF4500);
}

/* Responsive Design */
@media (max-width: 768px) {
    .profile-container {
        padding: 15px;
    }
}

=== public/css/logs.css ===
=== public/css/documents.css ===
/*
|--------------------------------------------------------------------------
| Documents Styles (documents.css)
|--------------------------------------------------------------------------
| This file contains styles for document management, including uploading,
| signing, and previewing documents. The design follows a dark, modern theme.
*/

/* General Document Page Styles */
body {
    background-color: #121212;
    color: #ffffff;
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
}

.document-container {
    max-width: 800px;
    margin: 40px auto;
    background: #1E1E1E;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(255, 255, 255, 0.1);
}

.document-container h2 {
    text-align: center;
    font-size: 2rem;
    margin-bottom: 20px;
}

/* Document Upload Section */
.upload-area {
    border: 2px dashed #FFD700;
    padding: 20px;
    text-align: center;
    border-radius: 8px;
    transition: all 0.3s;
}

.upload-area:hover {
    background: rgba(255, 255, 255, 0.05);
}

.upload-input {
    display: none;
}

.upload-label {
    display: block;
    background: linear-gradient(45deg, #FFD700, #FF8C00);
    color: #121212;
    font-weight: bold;
    padding: 12px 20px;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s;
}

.upload-label:hover {
    background: linear-gradient(45deg, #FFC107, #FF4500);
}

/* Document Preview */
.document-preview {
    margin-top: 20px;
    padding: 15px;
    background: #242424;
    border-radius: 8px;
    text-align: center;
}

.document-preview iframe {
    width: 100%;
    height: 500px;
    border: none;
    background: #000;
}

/* Signature Section */
.signature-area {
    text-align: center;
    margin-top: 20px;
}

.signature-pad {
    width: 100%;
    height: 200px;
    background: #fff;
    border-radius: 5px;
    border: 2px solid #FFD700;
}

/* Confirmation & Action Buttons */
.document-actions {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 20px;
}

.document-actions button {
    background: linear-gradient(45deg, #FFD700, #FF8C00);
    color: #121212;
    font-weight: bold;
    padding: 12px 15px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
    transition: background 0.3s;
}

.document-actions button:hover {
    background: linear-gradient(45deg, #FFC107, #FF4500);
}

/* Responsive Design */
@media (max-width: 768px) {
    .document-container {
        padding: 15px;
    }
    .document-preview iframe {
        height: 300px;
    }
}

=== public/css/dashboard.css ===
/*
|--------------------------------------------------------------------------
| Dashboard Styles (dashboard.css)
|--------------------------------------------------------------------------
| This file contains styles for both user and admin dashboards.
| Ensures a dark, sleek, and minimal look with responsive design.
*/

/* General Dashboard Layout */
body {
    background-color: #121212;
    color: #ffffff;
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
}

.dashboard-container {
    display: flex;
    min-height: 100vh;
}

.sidebar {
    width: 250px;
    background: #1E1E1E;
    padding: 20px;
    transition: width 0.3s ease;
}

.sidebar a {
    display: block;
    padding: 12px;
    color: #FFFFFF;
    text-decoration: none;
    border-radius: 5px;
    transition: background 0.3s;
}

.sidebar a:hover {
    background: #FFD700;
    color: #121212;
}

.sidebar .active {
    background: #FF8C00;
}

.main-content {
    flex-grow: 1;
    padding: 20px;
}

/* Widgets & Stats */
.widget {
    background: #1E1E1E;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    margin-bottom: 20px;
    transition: transform 0.3s;
}

.widget:hover {
    transform: scale(1.05);
}

.widget h2 {
    font-size: 1.5rem;
    margin-bottom: 10px;
}

.widget .value {
    font-size: 2rem;
    font-weight: bold;
    color: #FFD700;
}

/* Tables */
.dashboard-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

.dashboard-table th, .dashboard-table td {
    padding: 12px;
    border-bottom: 1px solid #333;
    text-align: left;
}

.dashboard-table th {
    background: #181818;
}

.dashboard-table tr:hover {
    background: rgba(255, 255, 255, 0.05);
}

/* Buttons */
.action-button {
    background: linear-gradient(45deg, #FFD700, #FF8C00);
    color: #121212;
    font-weight: bold;
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.3s;
}

.action-button:hover {
    background: linear-gradient(45deg, #FFC107, #FF4500);
}

/* Responsive Design */
@media (max-width: 768px) {
    .dashboard-container {
        flex-direction: column;
    }
    
    .sidebar {
        width: 100%;
        text-align: center;
    }
    
    .sidebar a {
        display: inline-block;
        margin: 5px;
    }
}

=== public/css/payments.css ===
/*
|--------------------------------------------------------------------------
| Payments Styles (payments.css)
|--------------------------------------------------------------------------
| This file contains styles for the payments page, ensuring a sleek, modern,
| and secure UI with a dark, minimal aesthetic.
*/

/* General Payment Page Styles */
body {
    background-color: #121212;
    color: #ffffff;
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
}

.payment-container {
    max-width: 600px;
    margin: 40px auto;
    background: #1E1E1E;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(255, 255, 255, 0.1);
}

.payment-container h2 {
    text-align: center;
    font-size: 2rem;
    margin-bottom: 20px;
}

/* Payment Form */
.payment-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.payment-form input, .payment-form select, .payment-form button {
    padding: 12px;
    font-size: 1rem;
    border-radius: 5px;
    border: none;
}

.payment-form input, .payment-form select {
    background: #333;
    color: #fff;
    border: 1px solid #444;
    width: 100%;
}

.payment-form input:focus, .payment-form select:focus {
    border-color: #FFD700;
    outline: 0;
}

.payment-form button {
    background: linear-gradient(45deg, #FFD700, #FF8C00);
    color: #121212;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s;
}

.payment-form button:hover {
    background: linear-gradient(45deg, #FFC107, #FF4500);
}

/* Transaction History */
.transaction-history {
    margin-top: 30px;
}

.transaction-history table {
    width: 100%;
    border-collapse: collapse;
}

.transaction-history th, .transaction-history td {
    padding: 12px;
    border-bottom: 1px solid #333;
    text-align: left;
}

.transaction-history th {
    background: #181818;
}

.transaction-history tr:hover {
    background: rgba(255, 255, 255, 0.05);
}

/* Payment Success & Error Messages */
.payment-message {
    text-align: center;
    padding: 15px;
    border-radius: 5px;
    margin-top: 20px;
}

.payment-success {
    background-color: #28a745;
    color: white;
}

.payment-error {
    background-color: #dc3545;
    color: white;
}

/* Responsive Design */
@media (max-width: 768px) {
    .payment-container {
        padding: 15px;
    }
    
    .transaction-history table {
        display: block;
        overflow-x: auto;
    }
}

=== public/css/notifications.css ===
/* notifications.css _ Real_Time Notifications */

.notifications-panel {
    position: absolute;
    right: 20px;
    top: 50px;
    background: #1E1E1E;
    color: #FFF;
    padding: 15px;
    border-radius: 5px;
    max-width: 90%;
    width: 300px;
    transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
    transform: translateY(-10px);
    opacity: 0;
}

.notifications-panel.show {
    opacity: 1;
    transform: translateY(0);
}

.notification.unread {
    background: #1E1E1E;
    font-weight: bold;
    border-left: 5px solid #FF4500; /* Add indicator */
}

.notification.read {
    background: #252525;
    opacity: 0.85;
}

.notification {
    position: relative;
    padding-right: 30px; /* Space for close button */
}

.notification .close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: transparent;
    border: none;
    color: #FFF;
    cursor: pointer;
    font-size: 16px;
    transition: color 0.3s;
}

.notification .close-btn:hover {
    color: #FF4500;
}

@media (max-width: 600px) {
    .notifications-panel {
        right: 10px;
        top: 10px;
        width: 100%;
    }
}

=== public/css/main.css ===
/* main.css - Unified Styling for CarFuse */

:root {
    --bg-color: #121212;
    --text-color: #f5f5f5;
    --primary-color: #0066ff;
    --hover-color: #0044cc;
    --surface-color: #181818;
    --border-color: #444;
    --success-color: #28a745;
    --warning-color: #ffc107;
    --error-color: #dc3545;
    --card-bg: #1E1E1E;
    --highlight-color: #FFD700;
}

body {
    font-family: 'Poppins', sans-serif;
    color: var(--text-color);
    background: var(--bg-color);
    margin: 0;
    padding: 0;
}

/* Buttons */
.btn, .btn-primary {
    background: linear-gradient(45deg, var(--highlight-color), #FF8C00);
    color: #000;
    padding: 10px 15px;
    border-radius: 6px;
    transition: 0.3s;
    font-weight: bold;
    border: none;
    cursor: pointer;
}
.btn:hover, .btn-primary:hover {
    filter: brightness(1.2);
    background-color: var(--hover-color);
}
.btn:focus, input[type="submit"]:focus {
    outline: 2px solid var(--warning-color);
}

/* Forms */
input, select, textarea {
    background: #333;
    border: 1px solid var(--border-color);
    color: #fff;
    padding: 10px;
    border-radius: 5px;
    width: 100%;
}
input:focus, select:focus, textarea:focus {
    border-color: var(--primary-color);
    outline: 0;
}

/* Navigation */
nav {
    background: var(--surface-color);
    padding: 10px;
    text-align: center;
}
nav a {
    color: var(--text-color);
    margin: 0 15px;
    text-decoration: none;
}
nav a:hover {
    color: var(--highlight-color);
}

/* Cards & Widgets */
.card, .widget {
    background: var(--card-bg);
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(255, 255, 255, 0.1);
}
.card h3, .widget h3 {
    color: var(--text-color);
    font-size: 1.8rem;
}
.card p, .widget p {
    color: #bbb;
    font-size: 1.2rem;
}

/* Tables */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    background-color: var(--surface-color);
}
th, td {
    padding: 12px;
    border-bottom: 1px solid var(--border-color);
    text-align: left;
}
th {
    background: var(--primary-color);
    color: white;
}
tr:nth-child(even) {
    background-color: #222;
}
tr:hover {
    background-color: #333;
}

/* Toast Notifications */
#toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    max-width: 300px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.toast {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 15px;
    border-radius: 5px;
    font-size: 14px;
    font-weight: bold;
    color: #fff;
    box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.2);
    opacity: 0;
    transform: translateY(-10px);
    animation: fadeInUp 0.3s ease-in-out forwards;
}
.toast-success {
    background: var(--success-color);
}
.toast-warning {
    background: var(--warning-color);
    color: #121212;
}
.toast-error {
    background: var(--error-color);
}
.toast .close-btn {
    background: transparent;
    border: none;
    color: #fff;
    font-size: 16px;
    cursor: pointer;
    transition: color 0.3s;
}
.toast .close-btn:hover {
    color: #ffd700;
}
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
@media (max-width: 600px) {
    #toast-container {
        right: 10px;
        width: 90%;
    }
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
    body {
        font-size: 14px;
    }
    .card, .widget {
        margin: 10px 0;
    }
    table {
        display: block;
        overflow-x: auto;
    }
    th, td {
        white-space: nowrap;
    }
    #toast-container {
        right: 10px;
        bottom: 10px;
        max-width: 250px;
    }
}

/* Homepage Specific Styles */
.homepage {
    /* Hero Section */
    .hero {
        height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        background: url('/public/assets/images/hero-bg.jpg') no-repeat center center/cover;
        position: relative;
    }
    .hero h1 {
        font-size: 3rem;
        font-weight: bold;
        text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
        margin-bottom: 15px;
    }
    .hero p {
        font-size: 1.5rem;
        opacity: 0.8;
        margin-bottom: 20px;
    }
    .cta-button {
        display: inline-block;
        background: linear-gradient(45deg, #FFD700, #FF8C00);
        color: #121212;
        font-weight: bold;
        padding: 12px 25px;
        border-radius: 8px;
        text-decoration: none;
        transition: all 0.3s ease;
    }
    .cta-button:hover {
        background: linear-gradient(45deg, #FFC107, #FF4500);
        transform: scale(1.05);
    }

    /* Why Us Section */
    .why-us {
        text-align: center;
        padding: 60px 20px;
        background: #181818;
    }
    .why-us h2 {
        font-size: 2rem;
        margin-bottom: 30px;
    }
    .features {
        display: flex;
        justify-content: center;
        gap: 50px;
        flex-wrap: wrap;
    }
    .feature {
        background: #1E1E1E;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        width: 250px;
        transition: transform 0.3s ease;
    }
    .feature:hover {
        transform: translateY(-5px);
    }
    .icon {
        font-size: 2rem;
        margin-bottom: 10px;
        color: #FFD700;
    }

    /* Booking Form */
    .booking-form {
        text-align: center;
        padding: 50px 20px;
    }
    .booking-form h2 {
        font-size: 2rem;
        margin-bottom: 20px;
    }
    .booking-form form {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
        max-width: 600px;
        margin: auto;
    }
    .booking-form input, .booking-form button {
        padding: 12px;
        font-size: 1rem;
        border-radius: 5px;
        border: none;
    }
    .booking-form input {
        width: 100%;
        max-width: 250px;
        background: #222;
        color: #fff;
        border: 1px solid #444;
    }
    .booking-form button {
        background: #FFD700;
        color: #121212;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.3s;
    }
    .booking-form button:hover {
        background: #FFC107;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .hero h1 {
            font-size: 2.5rem;
        }
        .hero p {
            font-size: 1.2rem;
        }
        .booking-form form {
            flex-direction: column;
            align-items: center;
        }
        .booking-form input {
            max-width: 100%;
        }
    }
}

/* Dark Minimal Theme */
body {
    background-color: var(--bg-color);
    color: var(--text-color);
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
}
header {
    background-color: var(--surface-color);
    text-align: center;
    padding: 15px 0;
}
.logo img {
    max-height: 104px;
    margin: 15px 0;
}
nav {
    display: flex;
    justify-content: center;
    padding: 15px 0;
}
nav a {
    color: var(--text-color);
    text-decoration: none;
    margin: 0 15px;
    font-size: 18px;
}
nav a:hover {
    color: var(--highlight-color);
}

/* Hero Section */
.hero {
    text-align: center;
    padding: 100px 20px;
    background: url('/public/images/hero-bg.jpg') no-repeat center center/cover;
    text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
}
.hero h1 {
    font-size: 48px;
    margin-bottom: 20px;
    text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
}
.hero p {
    font-size: 20px;
    opacity: 0.8;
    margin-bottom: 30px;
}
.hero-title {
    font-size: 2.5rem;
    font-weight: bold;
}
.hero-subtitle {
    font-size: 1.2rem;
    opacity: 0.8;
}

/* Search Form */
.search-form {
    display: flex;
    justify-content: center;
    gap: 10px;
}
.search-form input, .search-form button {
    padding: 12px;
    font-size: 16px;
    border-radius: 5px;
    border: none;
}
.search-form button {
    background: var(--highlight-color);
    color: var(--bg-color);
    font-weight: bold;
    cursor: pointer;
}
.search-form button:hover {
    background: var(--warning-color);
}

/* Features Section */
.features {
    text-align: center;
    padding: 60px 20px;
}
.features h2 {
    font-size: 36px;
    margin-bottom: 20px;
}
.feature-list {
    display: flex;
    justify-content: center;
    gap: 50px;
}
.feature {
    font-size: 18px;
    background: var(--surface-color);
    padding: 20px;
    border-radius: 5px;
}
.features-container {
    display: flex;
    justify-content: center;
    gap: 20px;
}
.feature-box {
    background: #1a1a1a;
    padding: 20px;
    border-radius: 8px;
    transition: transform 0.3s ease;
}
.feature-box:hover {
    transform: scale(1.05);
}

/* CTA Section */
.cta {
    margin-top: 40px;
    background: var(--success-color);
    padding: 20px;
    border-radius: 8px;
}
.btn {
    display: inline-block;
    background: var(--primary-color);
    color: white;
    padding: 10px 15px;
    border-radius: 5px;
    text-decoration: none;
    transition: background 0.3s ease;
}
.btn:hover {
    background: var(--hover-color);
}

/* Footer */
.footer {
    text-align: center;
    padding: 20px;
    background: var(--surface-color);
    opacity: 0.8;
}

/* Error Message */
.error-message {
    color: var(--error-color);
    display: none;
}

=== public/css/transaction-logs.css ===
/* ...existing code... */

/* Remove redundant table styles */
/* .transaction-logs table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    background-color: var(--surface-color);
}
.transaction-logs table th {
    background-color: var(--primary-color);
    color: white;
}
.transaction-logs table td {
    border: 1px solid var(--border-color);
    padding: 8px;
    text-align: left;
}
.transaction-logs table tr:nth-child(even) {
    background-color: #222;
}
.transaction-logs table tr:hover {
    background-color: #333;
} */

/* Ensure tables remain responsive on smaller screens */
@media (max-width: 768px) {
    .transaction-logs table {
        display: block;
        overflow-x: auto;
    }
    .transaction-logs table th, .transaction-logs table td {
        white-space: nowrap;
    }
}
=== public/css/auth.css ===
/* ===================================================
   Authentication Pages Styles (Dark Minimal Theme)
   Path: public/css/auth.css
   Applies to: Login, Register, Forgot Password
   =================================================== */

   :root {
    --primary-color: #1a1a1a;
    --secondary-color: #2c2c2c;
    --accent-color: #5d9cec;
    --text-color: #e0e0e0;
    --error-color: #e74c3c;
    --border-radius: 8px;
}

/* Global Styling */
body {
    background-color: var(--primary-color);
    color: var(--text-color);
    font-family: "Arial", sans-serif;
}

/* Centering the Authentication Box */
.auth-container {
    max-width: 400px;
    width: 90%;
    background: var(--secondary-color);
    padding: 20px;
    border-radius: var(--border-radius);
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.3);
    text-align: center;
}

/* Form Inputs */
.auth-container input {
    width: 100%;
    padding: 10px;
    margin-bottom: 12px;
    border: 1px solid #444;
    border-radius: var(--border-radius);
    background-color: #333;
    color: var(--text-color);
}

.auth-container input:focus {
    border-color: var(--accent-color);
    outline: none;
}

/* Submit Button */
.auth-container button {
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: var(--border-radius);
    background-color: var(--accent-color);
    color: white;
    font-size: 16px;
    cursor: pointer;
    transition: 0.3s ease;
}

.auth-container button:hover {
    background-color: #3b8ed6;
}

/* Error & Response Messages */
.auth-container .alert {
    padding: 10px;
    margin-top: 10px;
    border-radius: var(--border-radius);
    display: none;
}

.alert-danger {
    background-color: var(--error-color);
    color: white;
}

.alert-success {
    background-color: #27ae60;
    color: white;
}

/* Forgot Password Link */
.auth-container a {
    color: var(--accent-color);
    font-size: 14px;
    text-decoration: none;
}

.auth-container a:hover {
    text-decoration: underline;
}
=== public/css/home.css ===
/*
|--------------------------------------------------------------------------
| Home Page Styles (home.css)
|--------------------------------------------------------------------------
| This file contains styles for the home page, ensuring a dark, sleek, and
| minimal design. It applies to the hero section, booking form, and the
| "Why Us" section.
*/

/* General Page Styling */
body {
    background-color: #121212;
    color: #ffffff;
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
}

/* Hero Section */
.hero {
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    background: url('/public/assets/images/hero-bg.jpg') no-repeat center center/cover;
    position: relative;
}

.hero h1 {
    font-size: 3rem;
    font-weight: bold;
    text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
    margin-bottom: 15px;
}

.hero p {
    font-size: 1.5rem;
    opacity: 0.8;
    margin-bottom: 20px;
}

.cta-button {
    display: inline-block;
    background: linear-gradient(45deg, #FFD700, #FF8C00);
    color: #121212;
    font-weight: bold;
    padding: 12px 25px;
    border-radius: 8px;
    text-decoration: none;
    transition: all 0.3s ease;
}

.cta-button:hover {
    background: linear-gradient(45deg, #FFC107, #FF4500);
    transform: scale(1.05);
}

/* Why Us Section */
.why-us {
    text-align: center;
    padding: 60px 20px;
    background: #181818;
}

.why-us h2 {
    font-size: 2rem;
    margin-bottom: 30px;
}

.features {
    display: flex;
    justify-content: center;
    gap: 50px;
    flex-wrap: wrap;
}

.feature {
    background: #1E1E1E;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    width: 250px;
    transition: transform 0.3s ease;
}

.feature:hover {
    transform: translateY(-5px);
}

.icon {
    font-size: 2rem;
    margin-bottom: 10px;
    color: #FFD700;
}

/* Booking Form */
.booking-form {
    text-align: center;
    padding: 50px 20px;
}

.booking-form h2 {
    font-size: 2rem;
    margin-bottom: 20px;
}

.booking-form form {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    max-width: 600px;
    margin: auto;
}

.booking-form input, .booking-form button {
    padding: 12px;
    font-size: 1rem;
    border-radius: 5px;
    border: none;
}

.booking-form input {
    width: 100%;
    max-width: 250px;
    background: #222;
    color: #fff;
    border: 1px solid #444;
}

.booking-form button {
    background: #FFD700;
    color: #121212;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s;
}

.booking-form button:hover {
    background: #FFC107;
}

/* Responsive Design */
@media (max-width: 768px) {
    .hero h1 {
        font-size: 2.5rem;
    }

    .hero p {
        font-size: 1.2rem;
    }

    .booking-form form {
        flex-direction: column;
        align-items: center;
    }

    .booking-form input {
        max-width: 100%;
    }
}

=== public/css/toasts.css ===
/* This file has been removed. */

=== public/css/bookings.css ===
/*
|--------------------------------------------------------------------------
| Bookings Styles (bookings.css)
|--------------------------------------------------------------------------
| This file contains styles for the booking process, ensuring a sleek and
| user-friendly experience with a dark, modern aesthetic.
*/

/* General Booking Page Styles */
body {
    background-color: #121212;
    color: #ffffff;
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
}

.booking-container {
    max-width: 800px;
    margin: 40px auto;
    background: #1E1E1E;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(255, 255, 255, 0.1);
}

.booking-container h2 {
    text-align: center;
    font-size: 2rem;
    margin-bottom: 20px;
}

/* Booking Form */
.booking-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.booking-form input, .booking-form select, .booking-form button {
    padding: 12px;
    font-size: 1rem;
    border-radius: 5px;
    border: none;
}

.booking-form input, .booking-form select {
    background: #333;
    color: #fff;
    border: 1px solid #444;
    width: 100%;
}

.booking-form input:focus, .booking-form select:focus {
    border-color: #FFD700;
    outline: 0;
}

.booking-form button {
    background: linear-gradient(45deg, #FFD700, #FF8C00);
    color: #121212;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s;
}

.booking-form button:hover {
    background: linear-gradient(45deg, #FFC107, #FF4500);
}

/* Vehicle Selection */
.vehicle-selection {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.vehicle-card {
    background: #181818;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    transition: transform 0.3s;
}

.vehicle-card:hover {
    transform: scale(1.05);
}

.vehicle-card h3 {
    color: #FFD700;
    font-size: 1.2rem;
    margin-bottom: 10px;
}

/* Booking Confirmation */
.booking-confirmation {
    text-align: center;
    padding: 20px;
    background: #242424;
    border-radius: 8px;
    margin-top: 30px;
}

.booking-confirmation p {
    font-size: 1.2rem;
    color: #FFD700;
}

/* Responsive Design */
@media (max-width: 768px) {
    .booking-container {
        padding: 15px;
    }
    
    .vehicle-selection {
        grid-template-columns: 1fr;
    }
}

=== public/css/reports.css ===
/* ...existing code... */

/* Remove redundant table styles */
/* .reports table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    background-color: var(--surface-color);
}
.reports table th {
    background-color: var(--primary-color);
    color: white;
}
.reports table td {
    border: 1px solid var(--border-color);
    padding: 8px;
    text-align: left;
}
.reports table tr:nth-child(even) {
    background-color: #222;
}
.reports table tr:hover {
    background-color: #333;
} */

/* Ensure tables remain responsive on smaller screens */
@media (max-width: 768px) {
    .reports table {
        display: block;
        overflow-x: auto;
    }
    .reports table th, .reports table td {
        white-space: nowrap;
    }
}
=== public/index.php ===
<?php
declare(strict_types=1);

require_once __DIR__ . '/../bootstrap.php'; // Bootstrap application
require_once __DIR__ . '/../vendor/autoload.php'; // Load dependencies
require_once __DIR__ . '/../App/Helpers/SecurityHelper.php'; // Load security functions globally

header("Content-Type: text/html; charset=UTF-8");
?>

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carfuse - Wynajmij auto szybko i ≈Çatwo</title>
    <link rel="stylesheet" href="/public/css/style.css">
    <link rel="stylesheet" href="/public/css/home.css"> <!-- Link to home.css -->
    <script src="/public/js/main.js" defer></script>
</head>
<body>

<?php include __DIR__ . '/layouts/header.php'; ?>

<?php include __DIR__ . '/home.php'; ?>

<?php include __DIR__ . '/layouts/footer.php'; ?>

</body>
</html>
=== public/views/auth/register.php ===
<?php
/*
|--------------------------------------------------------------------------
| Rejestracja U≈ºytkownika
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi za≈Ço≈ºenie konta.
|
| ≈öcie≈ºka: App/Views/auth/register.php
|
| Zale≈ºy od:
| - JavaScript: /js/auth.js (obs≈Çuga AJAX, dynamiczna walidacja)
| - CSS: /css/auth.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego przetwarzania rejestracji)
| - HTML, CSS (interfejs)
*/

require_once BASE_PATH . '/App/Helpers/SecurityHelper.php';

if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

if (isset($_SESSION['user_id'])) {
    header("Location: /dashboard");
    exit;
}
?>

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rejestracja</title>
    
    <!-- ‚úÖ Bootstrap & Custom Styles -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/public/css/auth.css">
</head>
<body class="d-flex justify-content-center align-items-center vh-100 bg-light">

<div class="auth-container bg-white p-4 rounded shadow-lg">
    <h1 class="text-center mb-4">Zarejestruj siƒô</h1>

    <form id="registerForm">
        <?= csrf_field(); ?>
        <div class="mb-3">
            <label for="name" class="form-label">Imiƒô i nazwisko</label>
            <input type="text" class="form-control" id="name" name="name" required>
        </div>
        <div class="mb-3">
            <label for="email" class="form-label">Adres e-mail</label>
            <input type="email" class="form-control" id="email" name="email" required>
        </div>
        <div class="mb-3">
            <label for="password" class="form-label">Has≈Ço</label>
            <input type="password" class="form-control" id="password" name="password" required>
        </div>
        <div class="mb-3">
            <label for="confirm_password" class="form-label">Potwierd≈∫ has≈Ço</label>
            <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Zarejestruj siƒô</button>
    </form>

    <div id="responseMessage" class="alert mt-3 d-none"></div>
    <p class="text-center mt-3"><a href="/auth/login.php">Masz ju≈º konto? Zaloguj siƒô</a></p>
</div>

<!-- ‚úÖ Bootstrap & Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/auth.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const registerForm = document.getElementById("registerForm");

    registerForm.addEventListener("submit", function(e) {
        e.preventDefault();
        
        const formData = new FormData(registerForm);
        formData.append("csrf_token", document.querySelector('input[name="csrf_token"]').value); // Ensure CSRF token is included
        
        registerUser(formData);
    });

    function registerUser(formData) {
        fetch("/api/auth/register.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            const responseMessage = document.getElementById("responseMessage");
            responseMessage.classList.remove("d-none");
            responseMessage.style.display = "block";

            if (data.success) {
                responseMessage.className = "alert alert-success";
                responseMessage.textContent = "‚úÖ Rejestracja udana! Przekierowywanie...";
                setTimeout(() => window.location.href = "/auth/login.php", 2000);
            } else {
                responseMessage.className = "alert alert-danger";
                responseMessage.textContent = "‚ùå B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            console.error("B≈ÇƒÖd rejestracji:", error);
        });
    }
});
</script>

</body>
</html>
=== public/views/auth/password_reset.php ===
<?php
/*
|--------------------------------------------------------------------------
| Resetowanie Has≈Ça
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi ustawienie nowego has≈Ça po klikniƒôciu w link
| resetujƒÖcy, kt√≥ry zosta≈Ç wys≈Çany na jego e-mail.
|
| ≈öcie≈ºka: App/Views/auth/password_reset.php
|
| Zale≈ºy od:
| - JavaScript: /js/auth.js (obs≈Çuga AJAX, dynamiczne przetwarzanie resetu)
| - CSS: /css/auth.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznej zmiany has≈Ça)
| - HTML, CSS (interfejs)
*/

require_once BASE_PATH . '/App/Helpers/SecurityHelper.php';

if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

if (isset($_SESSION['user_id'])) {
    header("Location: /dashboard");
    exit;
}

// Pobranie tokenu resetujƒÖcego z URL
$token = $_GET['token'] ?? null;
if (!$token) {
    die("‚ùå Nieprawid≈Çowy link resetujƒÖcy.");
}
?>

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ustaw nowe has≈Ço</title>
    
    <!-- ‚úÖ Bootstrap & Custom Styles -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/public/css/auth.css">
</head>
<body class="d-flex justify-content-center align-items-center vh-100 bg-light">

<div class="auth-container bg-white p-4 rounded shadow-lg">
    <h1 class="text-center mb-4">Ustaw nowe has≈Ço</h1>

    <form id="passwordResetForm">
        <?= csrf_field(); ?>
        <input type="hidden" name="token" value="<?= htmlspecialchars($token) ?>">

        <div class="mb-3">
            <label for="new_password" class="form-label">Nowe has≈Ço</label>
            <input type="password" class="form-control" id="new_password" name="new_password" required>
        </div>
        <div class="mb-3">
            <label for="confirm_password" class="form-label">Potwierd≈∫ nowe has≈Ço</label>
            <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Zmie≈Ñ has≈Ço</button>
    </form>

    <div id="responseMessage" class="alert mt-3 d-none"></div>
</div>

<!-- ‚úÖ Bootstrap & Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/auth.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const passwordResetForm = document.getElementById("passwordResetForm");

    passwordResetForm.addEventListener("submit", function(e) {
        e.preventDefault();
        resetPassword(new FormData(passwordResetForm));
    });

    function resetPassword(formData) {
        fetch("/api/auth/password_reset.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            const responseMessage = document.getElementById("responseMessage");
            responseMessage.classList.remove("d-none");
            responseMessage.style.display = "block";

            if (data.success) {
                responseMessage.className = "alert alert-success";
                responseMessage.textContent = "‚úÖ Has≈Ço zosta≈Ço zmienione! Mo≈ºesz siƒô teraz zalogowaƒá.";
                setTimeout(() => window.location.href = "/auth/login.php", 2000);
            } else {
                responseMessage.className = "alert alert-danger";
                responseMessage.textContent = "‚ùå B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            console.error("B≈ÇƒÖd zmiany has≈Ça:", error);
        });
    }
});
</script>

</body>
</html>
=== public/views/auth/login.php ===
<?php
/*
|--------------------------------------------------------------------------
| Logowanie U≈ºytkownika
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi zalogowanie siƒô do systemu.
|
| ≈öcie≈ºka: App/Views/auth/login.php
|
| Zale≈ºy od:
| - JavaScript: /js/auth.js (obs≈Çuga AJAX, dynamiczna walidacja)
| - CSS: /css/auth.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego logowania)
| - HTML, CSS (interfejs)
*/
header("Content-Type: text/html; charset=UTF-8");

require_once BASE_PATH . '/App/Helpers/SecurityHelper.php'; // Ensure CSRF functions are loaded
include __DIR__ . '/../layouts/header.php';

if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

if (isset($_SESSION['user_id'])) {
    header("Location: /dashboard");
    exit;
}
?>

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zaloguj siƒô</title>

    <!-- ‚úÖ Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <!-- ‚úÖ Custom Authentication CSS -->
    <link rel="stylesheet" href="/public/css/auth.css">
</head>
<body class="d-flex justify-content-center align-items-center vh-100 bg-light">

<div class="auth-container bg-white p-4 rounded shadow-lg">
    <h1 class="text-center mb-4">Zaloguj siƒô</h1>

    <form id="loginForm">
        <?= csrf_field(); ?>
        <div class="mb-3">
            <label for="email" class="form-label">Adres e-mail</label>
            <input type="email" class="form-control" id="email" name="email" required>
        </div>
        <div class="mb-3">
            <label for="password" class="form-label">Has≈Ço</label>
            <input type="password" class="form-control" id="password" name="password" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Zaloguj siƒô</button>
    </form>
    
    <div id="responseMessage" class="alert mt-3 d-none"></div>
    <p class="text-center mt-3"><a href="/auth/password_reset.php">Nie pamiƒôtasz has≈Ça?</a></p>
</div>

<!-- ‚úÖ Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- ‚úÖ Custom Authentication Script -->
<script src="/js/auth.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const loginForm = document.getElementById("loginForm");

    loginForm.addEventListener("submit", function(e) {
        e.preventDefault();
        
        const formData = new FormData(loginForm);
        formData.append("csrf_token", document.querySelector('input[name="csrf_token"]').value); // Ensure CSRF token is included

        loginUser(formData);
    });

    function loginUser(formData) {
        fetch("/api/auth/login.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            const responseMessage = document.getElementById("responseMessage");
            responseMessage.classList.remove("d-none");
            responseMessage.style.display = "block";

            if (data.success) {
                responseMessage.className = "alert alert-success";
                responseMessage.textContent = "Logowanie pomy≈õlne! Przekierowywanie...";
                setTimeout(() => window.location.href = "/dashboard", 2000);
            } else {
                responseMessage.className = "alert alert-danger";
                responseMessage.textContent = "B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            console.error("B≈ÇƒÖd logowania:", error);
        });
    }
});
</script>

</body>
</html>
<?php include __DIR__ . '/../layouts/footer.php'; ?>
=== public/views/auth/reset_request.php ===
<?php
/*
|--------------------------------------------------------------------------
| ≈ªƒÖdanie Resetu Has≈Ça
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi wys≈Çanie pro≈õby o resetowanie has≈Ça.
| Na podany adres e-mail zostanie wys≈Çany link do resetu.
|
| ≈öcie≈ºka: App/Views/auth/reset_request.php
|
| Zale≈ºy od:
| - JavaScript: /js/auth.js (obs≈Çuga AJAX, dynamiczne wysy≈Çanie resetu)
| - CSS: /css/auth.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego wysy≈Çania zapytania)
| - HTML, CSS (interfejs)
*/

require_once BASE_PATH . '/App/Helpers/SecurityHelper.php';

if (session_status() === PHP_SESSION_NONE) {
    session_start();
}

if (isset($_SESSION['user_id'])) {
    header("Location: /dashboard");
    exit;
}
?>

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resetowanie Has≈Ça</title>

    <!-- ‚úÖ Bootstrap & Custom Styles -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/public/css/auth.css">
</head>
<body class="d-flex justify-content-center align-items-center vh-100 bg-light">

<div class="auth-container bg-white p-4 rounded shadow-lg">
    <h1 class="text-center mb-4">Resetowanie Has≈Ça</h1>

    <form id="resetRequestForm">
        <?= csrf_field(); ?>
        <div class="mb-3">
            <label for="email" class="form-label">Adres e-mail</label>
            <input type="email" class="form-control" id="email" name="email" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Wy≈õlij link resetujƒÖcy</button>
    </form>

    <div id="responseMessage" class="alert mt-3 d-none"></div>
    <p class="text-center mt-3"><a href="/auth/login.php">Pamiƒôtasz has≈Ço? Zaloguj siƒô</a></p>
</div>

<!-- ‚úÖ Bootstrap & Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/auth.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const resetRequestForm = document.getElementById("resetRequestForm");

    resetRequestForm.addEventListener("submit", function(e) {
        e.preventDefault();

        const formData = new FormData(resetRequestForm);
        formData.append("csrf_token", document.querySelector('input[name="csrf_token"]').value);

        requestPasswordReset(formData);
    });

    function requestPasswordReset(formData) {
        fetch("/api/auth/reset_request.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            const responseMessage = document.getElementById("responseMessage");
            responseMessage.classList.remove("d-none");
            responseMessage.style.display = "block";

            if (data.success) {
                responseMessage.className = "alert alert-success";
                responseMessage.textContent = "‚úÖ Link do resetowania has≈Ça zosta≈Ç wys≈Çany na podany e-mail.";
            } else {
                responseMessage.className = "alert alert-danger";
                responseMessage.textContent = "‚ùå B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            console.error("B≈ÇƒÖd wysy≈Çania resetu:", error);
        });
    }
});
</script>

</body>
</html>
=== public/views/admin/payments/dashboard.php ===
<?php
session_start();
if (!isset($_SESSION['admin_id'])) {
    header('Location: login.php');
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Panel ZarzƒÖdzania P≈Çatno≈õciami
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia administratorowi przeglƒÖd wszystkich transakcji, zwrot√≥w
| oraz statystyk finansowych. Obs≈Çuguje dynamiczne filtrowanie i obs≈Çugƒô zwrot√≥w.
|
| ≈öcie≈ºka: App/Views/admin/payments/dashboard.php
|
| Zale≈ºy od:
| - JavaScript: /js/admin.js (obs≈Çuga AJAX, filtrowanie)
| - CSS: /css/admin.css (stylizacja interfejsu)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane transakcji, zwroty)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do pobierania danych)
| - Chart.js (wizualizacja p≈Çatno≈õci)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Panel P≈Çatno≈õci</h1>

<div class="admin-container">
    <div class="row">
        <!-- Statystyki p≈Çatno≈õci -->
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>≈ÅƒÖczna liczba transakcji</h4>
                    <p id="totalTransactions" class="display-6">0</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>≈ÅƒÖczna kwota przychodu</h4>
                    <p id="totalRevenue" class="display-6">0 PLN</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>≈ÅƒÖczna liczba zwrot√≥w</h4>
                    <p id="totalRefunds" class="display-6">0</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Filtry transakcji -->
    <form id="paymentFilterForm" class="row mt-4">
        <?= csrf_field() ?>
        <div class="col-md-3">
            <select class="form-control" name="status">
                <option value="">Wybierz status</option>
                <option value="completed">Zako≈Ñczona</option>
                <option value="pending">OczekujƒÖca</option>
                <option value="failed">Nieudana</option>
            </select>
        </div>
        <div class="col-md-3">
            <select class="form-control" name="method">
                <option value="">Metoda p≈Çatno≈õci</option>
                <option value="card">Karta kredytowa</option>
                <option value="paypal">PayPal</option>
                <option value="transfer">Przelew bankowy</option>
            </select>
        </div>
        <div class="col-md-3">
            <input type="date" class="form-control" name="start_date" placeholder="Data poczƒÖtkowa">
        </div>
        <div class="col-md-3 text-end">
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </div>
    </form>

    <!-- Tabela transakcji -->
    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>U≈ºytkownik</th>
                <th>Kwota</th>
                <th>Metoda</th>
                <th>Status</th>
                <th>Data</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody id="transactionList">
            <!-- Dane bƒôdƒÖ ≈Çadowane dynamicznie -->
        </tbody>
    </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterForm = document.getElementById("paymentFilterForm");

    filterForm.addEventListener("submit", function(e) {
        e.preventDefault();
        fetchTransactions(new FormData(filterForm));
    });

    function fetchTransactions(formData = null) {
        let url = "/api/admin/payments.php";
        if (formData) {
            url += "?" + new URLSearchParams(formData).toString();
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const transactionTable = document.getElementById("transactionList");
                transactionTable.innerHTML = "";

                if (data.length === 0) {
                    transactionTable.innerHTML = `<tr><td colspan="7" class="text-center text-muted">Brak transakcji spe≈ÇniajƒÖcych kryteria.</td></tr>`;
                } else {
                    data.forEach(transaction => {
                        transactionTable.innerHTML += `
                            <tr>
                                <td>${transaction.id}</td>
                                <td>${transaction.user}</td>
                                <td>${transaction.amount} PLN</td>
                                <td>${transaction.method}</td>
                                <td>${transaction.status}</td>
                                <td>${transaction.date}</td>
                                <td>
                                    ${transaction.status === "completed" ? `<button class="btn btn-danger btn-sm" onclick="processRefund(${transaction.id})">Zwrot</button>` : ""}
                                </td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania transakcji:", error));
    }

    function processRefund(transactionId) {
        if (!confirm("Czy na pewno chcesz dokonaƒá zwrotu?")) return;

        fetch(`/api/admin/refund.php?id=${transactionId}`, { method: "POST" })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Zwrot zosta≈Ç pomy≈õlnie przetworzony.");
                    fetchTransactions();
                } else {
                    alert("B≈ÇƒÖd zwrotu: " + data.error);
                }
            })
            .catch(error => console.error("B≈ÇƒÖd zwrotu:", error));
    }

    fetchTransactions();
});
</script>
=== public/views/admin/payments/transactions.php ===
<?php
session_start();
if (!isset($_SESSION['admin_id'])) {
    header('Location: login.php');
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Panel Transakcji P≈Çatno≈õci
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia administratorowi przeglƒÖd i zarzƒÖdzanie wszystkimi
| transakcjami finansowymi systemu. Obs≈Çuguje filtrowanie i eksport danych.
|
| ≈öcie≈ºka: App/Views/admin/payments/transactions.php
|
| Zale≈ºy od:
| - JavaScript: /js/admin.js (obs≈Çuga AJAX, filtrowanie, eksport)
| - CSS: /css/admin.css (stylizacja interfejsu)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane transakcji)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do pobierania danych)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Transakcje P≈Çatno≈õci</h1>

<div class="admin-container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Historia Transakcji</h3>
        <div>
            <button class="btn btn-success btn-sm" id="exportCSV">Eksport CSV</button>
            <button class="btn btn-danger btn-sm" id="exportPDF">Eksport PDF</button>
        </div>
    </div>

    <!-- Filtry transakcji -->
    <form id="transactionFilterForm" class="row mt-4">
        <?= csrf_field() ?>
        <div class="col-md-3">
            <input type="text" class="form-control" name="user_id" placeholder="ID U≈ºytkownika">
        </div>
        <div class="col-md-3">
            <select class="form-control" name="status">
                <option value="">Status transakcji</option>
                <option value="completed">Zako≈Ñczona</option>
                <option value="pending">OczekujƒÖca</option>
                <option value="failed">Nieudana</option>
            </select>
        </div>
        <div class="col-md-3">
            <select class="form-control" name="method">
                <option value="">Metoda p≈Çatno≈õci</option>
                <option value="card">Karta kredytowa</option>
                <option value="paypal">PayPal</option>
                <option value="transfer">Przelew bankowy</option>
            </select>
        </div>
        <div class="col-md-3 text-end">
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </div>
    </form>

    <!-- Tabela transakcji -->
    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>U≈ºytkownik</th>
                <th>Kwota</th>
                <th>Metoda</th>
                <th>Status</th>
                <th>Data</th>
            </tr>
        </thead>
        <tbody id="transactionList">
            <!-- Dane bƒôdƒÖ ≈Çadowane dynamicznie -->
        </tbody>
    </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterForm = document.getElementById("transactionFilterForm");
    const exportCSV = document.getElementById("exportCSV");
    const exportPDF = document.getElementById("exportPDF");

    filterForm.addEventListener("submit", function(e) {
        e.preventDefault();
        fetchTransactions(new FormData(filterForm));
    });

    exportCSV.addEventListener("click", function() {
        window.location.href = "/api/admin/export_transactions.php?format=csv";
    });

    exportPDF.addEventListener("click", function() {
        window.location.href = "/api/admin/export_transactions.php?format=pdf";
    });

    function fetchTransactions(formData = null) {
        let url = "/api/admin/transactions.php";
        if (formData) {
            url += "?" + new URLSearchParams(formData).toString();
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const transactionTable = document.getElementById("transactionList");
                transactionTable.innerHTML = "";

                if (data.length === 0) {
                    transactionTable.innerHTML = `<tr><td colspan="6" class="text-center text-muted">Brak transakcji spe≈ÇniajƒÖcych kryteria.</td></tr>`;
                } else {
                    data.forEach(transaction => {
                        transactionTable.innerHTML += `
                            <tr>
                                <td>${transaction.id}</td>
                                <td>${transaction.user}</td>
                                <td>${transaction.amount} PLN</td>
                                <td>${transaction.method}</td>
                                <td>${transaction.status}</td>
                                <td>${transaction.date}</td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania transakcji:", error));
    }

    fetchTransactions();
});
</script>
=== public/views/admin/payments/refunds.php ===
<?php
session_start();
if (!isset($_SESSION['admin_id'])) {
    header('Location: login.php');
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Panel Zwrot√≥w P≈Çatno≈õci
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia administratorowi przeglƒÖd i zarzƒÖdzanie zwrotami.
| Administrator mo≈ºe sprawdziƒá status zwrot√≥w oraz anulowaƒá wybrane operacje.
|
| ≈öcie≈ºka: App/Views/admin/payments/refunds.php
|
| Zale≈ºy od:
| - JavaScript: /js/admin.js (obs≈Çuga AJAX, filtrowanie, anulowanie zwrot√≥w)
| - CSS: /css/admin.css (stylizacja interfejsu)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane zwrot√≥w)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do pobierania danych)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Zwroty P≈Çatno≈õci</h1>

<div class="admin-container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Historia Zwrot√≥w</h3>
    </div>

    <!-- Filtry zwrot√≥w -->
    <form id="refundFilterForm" class="row mt-4">
        <?= csrf_field() ?>
        <div class="col-md-3">
            <input type="text" class="form-control" name="user_id" placeholder="ID U≈ºytkownika">
        </div>
        <div class="col-md-3">
            <select class="form-control" name="status">
                <option value="">Status zwrotu</option>
                <option value="pending">OczekujƒÖcy</option>
                <option value="completed">Zako≈Ñczony</option>
                <option value="failed">Nieudany</option>
            </select>
        </div>
        <div class="col-md-3">
            <input type="date" class="form-control" name="start_date" placeholder="Data poczƒÖtkowa">
        </div>
        <div class="col-md-3 text-end">
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </div>
    </form>

    <!-- Tabela zwrot√≥w -->
    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>U≈ºytkownik</th>
                <th>Kwota</th>
                <th>Status</th>
                <th>Data</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody id="refundList">
            <!-- Dane bƒôdƒÖ ≈Çadowane dynamicznie -->
        </tbody>
    </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterForm = document.getElementById("refundFilterForm");

    filterForm.addEventListener("submit", function(e) {
        e.preventDefault();
        fetchRefunds(new FormData(filterForm));
    });

    function fetchRefunds(formData = null) {
        let url = "/api/admin/refunds.php";
        if (formData) {
            url += "?" + new URLSearchParams(formData).toString();
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const refundTable = document.getElementById("refundList");
                refundTable.innerHTML = "";

                if (data.length === 0) {
                    refundTable.innerHTML = `<tr><td colspan="6" class="text-center text-muted">Brak zwrot√≥w spe≈ÇniajƒÖcych kryteria.</td></tr>`;
                } else {
                    data.forEach(refund => {
                        refundTable.innerHTML += `
                            <tr>
                                <td>${refund.id}</td>
                                <td>${refund.user}</td>
                                <td>${refund.amount} PLN</td>
                                <td>${refund.status}</td>
                                <td>${refund.date}</td>
                                <td>
                                    ${refund.status === "pending" ? `<button class="btn btn-danger btn-sm" onclick="cancelRefund(${refund.id})">Anuluj</button>` : ""}
                                </td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania zwrot√≥w:", error));
    }

    function cancelRefund(refundId) {
        if (!confirm("Czy na pewno chcesz anulowaƒá ten zwrot?")) return;

        fetch(`/api/admin/cancel_refund.php?id=${refundId}`, { method: "POST" })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Zwrot zosta≈Ç anulowany.");
                    fetchRefunds();
                } else {
                    alert("B≈ÇƒÖd anulowania zwrotu: " + data.error);
                }
            })
            .catch(error => console.error("B≈ÇƒÖd anulowania zwrotu:", error));
    }

    fetchRefunds();
});
</script>
=== public/views/admin/dashboard.php ===
<?php require_once __DIR__ . '/../layouts/header.php'; ?>

<h1 class="text-center">Admin Dashboard</h1>

<div class="dashboard-container">
    <!-- Overview Cards -->
    <div class="row">
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>Total Users</h4>
                    <p id="totalUsers" class="display-6">0</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>Total Bookings</h4>
                    <p id="totalBookings" class="display-6">0</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>Total Revenue</h4>
                    <p id="totalRevenue" class="display-6">$0.00</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Graphs -->
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-body">
                    <h5 class="text-center">Monthly Booking Trends</h5>
                    <canvas id="bookingTrends"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-body">
                    <h5 class="text-center">Monthly Revenue Trends</h5>
                    <canvas id="revenueTrends"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/js/admin.js"></script>

<?php require_once __DIR__ . '/../layouts/footer.php'; ?>
=== public/views/admin/users.php ===
<?php
session_start();
if (!isset($_SESSION['admin_id'])) {
    header('Location: login.php');
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Panel ZarzƒÖdzania U≈ºytkownikami
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia administratorowi przeglƒÖd i zarzƒÖdzanie u≈ºytkownikami.
| Obs≈Çuguje filtrowanie, edycjƒô, dodawanie i usuwanie u≈ºytkownik√≥w.
|
| ≈öcie≈ºka: App/Views/admin/users.php
|
| Zale≈ºy od:
| - JavaScript: /js/admin.js (obs≈Çuga AJAX, edycja, usuwanie)
| - CSS: /css/admin.css (stylizacja interfejsu)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane u≈ºytkownik√≥w)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do pobierania danych)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">ZarzƒÖdzanie U≈ºytkownikami</h1>

<div class="admin-container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Lista U≈ºytkownik√≥w</h3>
        <button class="btn btn-primary" id="addUserBtn">Dodaj U≈ºytkownika</button>
    </div>

    <!-- Filtry u≈ºytkownik√≥w -->
    <form id="userFilterForm" class="row mt-4">
        <?= csrf_field() ?>
        <div class="col-md-3">
            <select class="form-control" name="role">
                <option value="">Wybierz rolƒô</option>
                <option value="user">U≈ºytkownik</option>
                <option value="admin">Administrator</option>
            </select>
        </div>
        <div class="col-md-3">
            <select class="form-control" name="status">
                <option value="">Status</option>
                <option value="active">Aktywny</option>
                <option value="inactive">Nieaktywny</option>
            </select>
        </div>
        <div class="col-md-3">
            <input type="date" class="form-control" name="registration_date" placeholder="Data rejestracji">
        </div>
        <div class="col-md-3 text-end">
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </div>
    </form>

    <!-- Tabela u≈ºytkownik√≥w -->
    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>Imiƒô i nazwisko</th>
                <th>Email</th>
                <th>Rola</th>
                <th>Status</th>
                <th>Data rejestracji</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody id="userList">
            <!-- Dane bƒôdƒÖ ≈Çadowane dynamicznie -->
        </tbody>
    </table>
</div>

<!-- Modal dodawania/edycji u≈ºytkownika -->
<div id="userModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="modalTitle">Dodaj U≈ºytkownika</h2>
        <form id="userForm">
            <?= csrf_field() ?>
            <input type="hidden" id="userId" name="userId">

            <div class="form-group">
                <label for="name">Imiƒô i nazwisko</label>
                <input type="text" id="name" name="name" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="email">Adres e-mail</label>
                <input type="email" id="email" name="email" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="role">Rola</label>
                <select id="role" name="role" class="form-control" required>
                    <option value="user">U≈ºytkownik</option>
                    <option value="admin">Administrator</option>
                </select>
            </div>

            <div class="form-group">
                <label for="status">Status</label>
                <select id="status" name="status" class="form-control" required>
                    <option value="active">Aktywny</option>
                    <option value="inactive">Nieaktywny</option>
                </select>
            </div>

            <button type="submit" class="btn btn-success">Zapisz</button>
        </form>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterForm = document.getElementById("userFilterForm");
    const addUserBtn = document.getElementById("addUserBtn");

    filterForm.addEventListener("submit", function(e) {
        e.preventDefault();
        fetchUsers(new FormData(filterForm));
    });

    addUserBtn.addEventListener("click", function() {
        openUserModal();
    });

    function fetchUsers(formData = null) {
        let url = "/api/admin/users.php";
        if (formData) {
            url += "?" + new URLSearchParams(formData).toString();
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const userTable = document.getElementById("userList");
                userTable.innerHTML = "";

                if (data.length === 0) {
                    userTable.innerHTML = `<tr><td colspan="7" class="text-center text-muted">Brak u≈ºytkownik√≥w spe≈ÇniajƒÖcych kryteria.</td></tr>`;
                } else {
                    data.forEach(user => {
                        userTable.innerHTML += `
                            <tr>
                                <td>${user.id}</td>
                                <td>${user.name}</td>
                                <td>${user.email}</td>
                                <td>${user.role}</td>
                                <td>${user.status}</td>
                                <td>${user.registration_date}</td>
                                <td>
                                    <button class="btn btn-warning btn-sm" onclick="editUser(${user.id})">Edytuj</button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">Usu≈Ñ</button>
                                </td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania u≈ºytkownik√≥w:", error));
    }

    fetchUsers();
});
</script>

<?php
// Improved AJAX for fetching users
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['action']) && $_POST['action'] === 'fetch_users') {
    // Fetch users from the database
    // ...existing code...
    $users = []; // Assume this array is populated with user data from the database

    foreach ($users as &$user) {
        $user['role'] = $user['is_admin'] ? 'admin' : 'user';
    }

    echo json_encode($users);
    exit();
}
?>
=== public/views/admin/audit_logs.php ===
<?php
if (!isset($_SESSION['admin_id'])) {
    header('Location: login.php');
    exit();
}

/*
|--------------------------------------------------------------------------
| Logi Audytowe Administratora
|--------------------------------------------------------------------------
| Ten plik odpowiada za wy≈õwietlanie log√≥w audytowych systemu. Administrator
| mo≈ºe filtrowaƒá historiƒô dzia≈Ça≈Ñ u≈ºytkownik√≥w wed≈Çug ID, rezerwacji, daty i IP.
|
| ≈öcie≈ºka: App/Views/admin/audit_logs.php
|
| Zale≈ºy od:
| - JavaScript: admin.js (obs≈Çuga log√≥w, AJAX)
| - CSS: admin.css (stylizacja tabeli, formularzy)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane pobierane z bazy)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX, dynamiczne ≈Çadowanie danych)
| - HTML, CSS (interfejs)
*/
?>
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logi Audytowe</title>
    <link rel="stylesheet" href="path/to/admin.css">
</head>
<body>
    <h1 class="text-center">Logi Audytowe</h1>

    <div class="admin-container">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3>Historia Zdarze≈Ñ w Systemie</h3>
            <button class="btn btn-secondary" id="clearFilters">Wyczy≈õƒá Filtry</button>
        </div>

        <!-- Filtry -->
        <form id="filterForm" class="row mb-4">
            <?= csrf_field() ?>
            <div class="col-md-2">
                <input type="text" class="form-control" name="user_id" placeholder="ID U≈ºytkownika">
            </div>
            <div class="col-md-2">
                <input type="text" class="form-control" name="booking_id" placeholder="ID Rezerwacji">
            </div>
            <div class="col-md-2">
                <input type="date" class="form-control" name="start_date" placeholder="Data poczƒÖtkowa">
            </div>
            <div class="col-md-2">
                <input type="date" class="form-control" name="end_date" placeholder="Data ko≈Ñcowa">
            </div>
            <div class="col-md-2">
                <select class="form-control" name="action_type">
                    <option value="">Rodzaj akcji</option>
                    <option value="login">Logowanie</option>
                    <option value="update">Aktualizacja</option>
                    <option value="delete">Usuniƒôcie</option>
                </select>
            </div>
            <div class="col-md-2 text-end">
                <button type="submit" class="btn btn-primary">Filtruj</button>
            </div>
        </form>

        <!-- Tabela Log√≥w -->
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>U≈ºytkownik</th>
                    <th>Akcja</th>
                    <th>Opis</th>
                    <th>ID Rezerwacji</th>
                    <th>Adres IP</th>
                    <th>Data</th>
                </tr>
            </thead>
            <tbody id="auditLogs">
                <!-- Dane bƒôdƒÖ ≈Çadowane dynamicznie -->
            </tbody>
        </table>
    </div>

    <script src="path/to/admin.js"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        const filterForm = document.getElementById("filterForm");
        const clearFilters = document.getElementById("clearFilters");

        // Obs≈Çuga filtr√≥w
        filterForm.addEventListener("submit", function(e) {
            e.preventDefault();
            fetchAuditLogs(new FormData(filterForm));
        });

        clearFilters.addEventListener("click", function() {
            filterForm.reset();
            fetchAuditLogs();
        });

        // Pobieranie log√≥w audytowych przez AJAX
        function fetchAuditLogs(formData = null) {
            let url = "/api/admin/audit_logs.php";
            if (formData) {
                url += "?" + new URLSearchParams(formData).toString();
            }

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const auditLogsTable = document.getElementById("auditLogs");
                    auditLogsTable.innerHTML = "";
                    data.forEach(log => {
                        auditLogsTable.innerHTML += `
                            <tr>
                                <td>${log.id}</td>
                                <td>${log.user}</td>
                                <td>${log.action}</td>
                                <td>${log.details}</td>
                                <td>${log.booking_id || '-'}</td>
                                <td>${log.ip_address}</td>
                                <td>${log.formatted_date}</td>
                            </tr>
                        `;
                    });
                })
                .catch(error => console.error("B≈ÇƒÖd pobierania log√≥w audytowych:", error));
        }

        // Automatyczne za≈Çadowanie log√≥w po otwarciu strony
        fetchAuditLogs();
    });
    </script>
</body>
</html>
=== public/views/admin/logs.php ===
<?php
session_start();
if (!isset($_SESSION['admin_id'])) {
    header('Location: login.php');
    exit();
}

/*
|--------------------------------------------------------------------------
| Logi Systemowe Administratora
|--------------------------------------------------------------------------
| Ten plik odpowiada za wy≈õwietlanie log√≥w systemowych, kt√≥re pomagajƒÖ
| administratorowi diagnozowaƒá problemy techniczne.
|
| ≈öcie≈ºka: App/Views/admin/logs.php
|
| Zale≈ºy od:
| - JavaScript: /js/admin.js (obs≈Çuga log√≥w, AJAX)
| - CSS: /css/admin.css (stylizacja tabeli)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane pobierane z bazy)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX, dynamiczne ≈Çadowanie danych)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Logi Systemowe</h1>

<div class="admin-container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>PrzeglƒÖd Log√≥w Systemowych</h3>
        <button class="btn btn-secondary" id="clearFilters">Wyczy≈õƒá Filtry</button>
    </div>

    <!-- Filtry log√≥w -->
    <form id="logFilterForm" class="row mb-4">
        <?= csrf_field() ?>
        <div class="col-md-3">
            <select class="form-control" name="log_type">
                <option value="">Wybierz typ logu</option>
                <option value="error">B≈ÇƒÖd</option>
                <option value="info">Informacja</option>
                <option value="warning">Ostrze≈ºenie</option>
            </select>
        </div>
        <div class="col-md-3">
            <input type="text" class="form-control" name="log_message" placeholder="Wyszukaj w tre≈õci logu">
        </div>
        <div class="col-md-2">
            <input type="date" class="form-control" name="start_date" placeholder="Data poczƒÖtkowa">
        </div>
        <div class="col-md-2">
            <input type="date" class="form-control" name="end_date" placeholder="Data ko≈Ñcowa">
        </div>
        <div class="col-md-2 text-end">
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </div>
    </form>

    <!-- Tabela log√≥w -->
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Typ Logu</th>
                <th>Wiadomo≈õƒá</th>
                <th>Data</th>
            </tr>
        </thead>
        <tbody id="systemLogs">
            <!-- Dane bƒôdƒÖ ≈Çadowane dynamicznie -->
        </tbody>
    </table>
    <p id="noLogsMessage" class="text-center text-muted" style="display:none;">Brak log√≥w spe≈ÇniajƒÖcych kryteria.</p>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterForm = document.getElementById("logFilterForm");
    const clearFilters = document.getElementById("clearFilters");

    // Obs≈Çuga filtr√≥w
    filterForm.addEventListener("submit", function(e) {
        e.preventDefault();
        fetchLogs(new FormData(filterForm));
    });

    clearFilters.addEventListener("click", function() {
        filterForm.reset();
        fetchLogs();
    });

    // Pobieranie log√≥w systemowych przez AJAX
    function fetchLogs(formData = null) {
        let url = "/api/admin/logs.php";
        if (formData) {
            url += "?" + new URLSearchParams(formData).toString();
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const logsTable = document.getElementById("systemLogs");
                logsTable.innerHTML = "";
                const noLogsMessage = document.getElementById("noLogsMessage");

                if (data.length === 0) {
                    noLogsMessage.style.display = "block";
                } else {
                    noLogsMessage.style.display = "none";
                    data.forEach(log => {
                        logsTable.innerHTML += `
                            <tr>
                                <td>${log.id}</td>
                                <td>${log.type}</td>
                                <td>${log.message}</td>
                                <td>${log.formatted_date}</td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania log√≥w systemowych:", error));
    }

    // Automatyczne za≈Çadowanie log√≥w po otwarciu strony
    fetchLogs();
});
</script>

<?php
// Fetch and display logs
$logs = []; // Assume this array is populated with log data from the database

foreach ($logs as &$log) {
    $log['formatted_date'] = date('Y-m-d H:i:s', strtotime($log['date']));
}
?>
=== public/views/admin/documents.php ===
<?php
session_start();
if (!isset($_SESSION['admin_id'])) {
    header('Location: login.php');
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Panel ZarzƒÖdzania Dokumentami
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia administratorowi przeglƒÖd i zarzƒÖdzanie dokumentami 
| przes≈Çanymi przez u≈ºytkownik√≥w. Obs≈Çuguje filtrowanie i podglƒÖd plik√≥w.
|
| ≈öcie≈ºka: App/Views/admin/documents.php
|
| Zale≈ºy od:
| - JavaScript: /js/admin.js (obs≈Çuga AJAX, filtrowanie, usuwanie dokument√≥w)
| - CSS: /css/admin.css (stylizacja interfejsu)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane dokument√≥w)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do pobierania danych)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">ZarzƒÖdzanie Dokumentami</h1>

<div class="admin-container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Lista Dokument√≥w</h3>
    </div>

    <!-- Filtry dokument√≥w -->
    <form id="documentFilterForm" class="row mt-4">
        <?= csrf_field() ?>
        <div class="col-md-3">
            <input type="text" class="form-control" name="user_id" placeholder="ID U≈ºytkownika">
        </div>
        <div class="col-md-3">
            <select class="form-control" name="document_type">
                <option value="">Typ dokumentu</option>
                <option value="contract">Umowa</option>
                <option value="invoice">Faktura</option>
                <option value="identity">Dow√≥d to≈ºsamo≈õci</option>
            </select>
        </div>
        <div class="col-md-3">
            <input type="date" class="form-control" name="upload_date" placeholder="Data przes≈Çania">
        </div>
        <div class="col-md-3 text-end">
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </div>
    </form>

    <!-- Tabela dokument√≥w -->
    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>U≈ºytkownik</th>
                <th>Typ</th>
                <th>Plik</th>
                <th>Data przes≈Çania</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody id="documentList">
            <!-- Dane bƒôdƒÖ ≈Çadowane dynamicznie -->
        </tbody>
    </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterForm = document.getElementById("documentFilterForm");

    filterForm.addEventListener("submit", function(e) {
        e.preventDefault();
        fetchDocuments(new FormData(filterForm));
    });

    function fetchDocuments(formData = null) {
        let url = "/api/admin/documents.php";
        if (formData) {
            url += "?" + new URLSearchParams(formData).toString();
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const documentTable = document.getElementById("documentList");
                documentTable.innerHTML = "";

                if (data.length === 0) {
                    documentTable.innerHTML = `<tr><td colspan="6" class="text-center text-muted">Brak dokument√≥w spe≈ÇniajƒÖcych kryteria.</td></tr>`;
                } else {
                    data.forEach(doc => {
                        documentTable.innerHTML += `
                            <tr>
                                <td>${doc.id}</td>
                                <td>${doc.user}</td>
                                <td>${doc.type}</td>
                                <td><a href="${doc.file_url}" target="_blank">PodglƒÖd</a></td>
                                <td>${doc.upload_date}</td>
                                <td>
                                    <button class="btn btn-danger btn-sm" onclick="deleteDocument(${doc.id})">Usu≈Ñ</button>
                                </td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania dokument√≥w:", error));
    }

    function deleteDocument(documentId) {
        if (!confirm("Czy na pewno chcesz usunƒÖƒá ten dokument?")) return;

        fetch(`/api/admin/delete_document.php?id=${documentId}`, { method: "POST" })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Dokument zosta≈Ç usuniƒôty.");
                    fetchDocuments();
                } else {
                    alert("B≈ÇƒÖd usuwania dokumentu: " + data.error);
                }
            })
            .catch(error => console.error("B≈ÇƒÖd usuwania dokumentu:", error));
    }

    fetchDocuments();
});
</script>
=== public/views/admin/reports.php ===
<?php
session_start();
if (!isset($_SESSION['admin_id'])) {
    header('Location: login.php');
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Raporty Administratora
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia generowanie raport√≥w dotyczƒÖcych rezerwacji, p≈Çatno≈õci,
| u≈ºytkownik√≥w, aktywno≈õci w systemie oraz audyt√≥w.
|
| ≈öcie≈ºka: App/Views/admin/reports.php
|
| Zale≈ºy od:
| - JavaScript: /js/admin.js (obs≈Çuga generowania raport√≥w, AJAX)
| - CSS: /css/admin.css (stylizacja formularzy i tabeli)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane pobierane z bazy)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX, dynamiczne generowanie raport√≥w)
| - Chart.js (wizualizacja raport√≥w)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Raporty Systemowe</h1>

<div class="admin-container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Generowanie raport√≥w</h3>
        <button class="btn btn-secondary" id="clearFilters">Reset</button>
    </div>

    <!-- Formularz generowania raport√≥w -->
    <form id="adminReportForm" class="mt-4">
        <?= csrf_field() ?>

        <div class="mb-3">
            <label for="reportType" class="form-label">Typ raportu</label>
            <select class="form-select" id="reportType" name="reportType" required>
                <option value="" disabled selected>Wybierz typ raportu</option>
                <option value="bookings">Rezerwacje</option>
                <option value="payments">P≈Çatno≈õci</option>
                <option value="users">U≈ºytkownicy</option>
                <option value="activity">Aktywno≈õƒá u≈ºytkownik√≥w</option>
                <option value="audit">Logi audytowe</option>
            </select>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="startDate" class="form-label">Data poczƒÖtkowa</label>
                <input type="date" class="form-control" id="startDate" name="startDate" required>
            </div>

            <div class="col-md-6 mb-3">
                <label for="endDate" class="form-label">Data ko≈Ñcowa</label>
                <input type="date" class="form-control" id="endDate" name="endDate" required>
            </div>
        </div>

        <div class="mb-3">
            <label for="format" class="form-label">Format raportu</label>
            <select class="form-select" id="format" name="format" required>
                <option value="csv">CSV</option>
                <option value="pdf">PDF</option>
                <option value="json">JSON</option>
            </select>
        </div>

        <button type="submit" class="btn btn-primary w-100">Generuj raport</button>
    </form>

    <div id="responseMessage" class="alert mt-3" style="display:none;"></div>

    <div class="mt-4">
        <h4>PodglƒÖd raportu</h4>
        <canvas id="reportChart"></canvas>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const reportForm = document.getElementById("adminReportForm");
    const responseMessage = document.getElementById("responseMessage");
    const clearFilters = document.getElementById("clearFilters");

    reportForm.addEventListener("submit", function(e) {
        e.preventDefault();
        generateReport(new FormData(reportForm));
    });

    clearFilters.addEventListener("click", function() {
        reportForm.reset();
        responseMessage.style.display = "none";
    });

    function generateReport(formData) {
        let url = "/api/admin/reports.php";

        fetch(url, {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            responseMessage.style.display = "block";
            if (data.success) {
                responseMessage.className = "alert alert-success";
                responseMessage.textContent = "Raport wygenerowany pomy≈õlnie! Pobierz go tutaj: " + data.download_link;
                renderChart(data.chartData);
            } else {
                responseMessage.className = "alert alert-danger";
                responseMessage.textContent = "B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            responseMessage.style.display = "block";
            responseMessage.className = "alert alert-danger";
            responseMessage.textContent = "B≈ÇƒÖd po≈ÇƒÖczenia z serwerem.";
            console.error("B≈ÇƒÖd generowania raportu:", error);
        });
    }

    function renderChart(chartData) {
        const ctx = document.getElementById("reportChart").getContext("2d");
        new Chart(ctx, {
            type: "bar",
            data: {
                labels: chartData.labels,
                datasets: [{
                    label: "Liczba zg≈Çosze≈Ñ",
                    data: chartData.values,
                    backgroundColor: "rgba(54, 162, 235, 0.6)"
                }]
            }
        });
    }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<?php
// Date range validation
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['start_date'], $_POST['end_date'])) {
    $start_date = $_POST['start_date'];
    $end_date = $_POST['end_date'];

    if (strtotime($start_date) > strtotime($end_date)) {
        echo 'Invalid date range';
        exit();
    }

    // Export reports logic (PDF, CSV)
    // ...existing code...
}
?>
=== public/views/admin/settings.php ===
/*
|--------------------------------------------------------------------------
| Ustawienia Systemowe Administratora
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia administratorowi konfiguracjƒô systemu ‚Äì ustawienia
| og√≥lne, tryb konserwacji, strefƒô czasowƒÖ oraz konfiguracjƒô API.
|
| ≈öcie≈ºka: App/Views/admin/settings.php
|
| Zale≈ºy od:
| - JavaScript: /js/admin.js (obs≈Çuga formularza ustawie≈Ñ, AJAX)
| - CSS: /css/admin.css (stylizacja interfejsu)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (przechowywanie ustawie≈Ñ)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do zapisu ustawie≈Ñ)
| - HTML, CSS (interfejs)
*/

<?php
if (!isset($_SESSION['admin_id'])) {
    header('Location: login.php');
    exit();
}

// Improved form validation
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $errors = [];

    if (empty($_POST['setting_name'])) {
        $errors[] = 'Setting name is required';
    }

    if (empty($_POST['setting_value'])) {
        $errors[] = 'Setting value is required';
    }

    if (empty($errors)) {
        // Save settings logic
        // ...existing code...
    } else {
        foreach ($errors as $error) {
            echo "<p>$error</p>";
        }
    }
}
?>

<h1 class="text-center">Ustawienia Systemowe</h1>

<div class="admin-container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Konfiguracja systemu</h3>
        <button class="btn btn-secondary" id="resetSettings">Resetuj</button>
    </div>

    <!-- Formularz ustawie≈Ñ systemowych -->
    <form id="settingsForm" class="mt-4">
        <?= csrf_field() ?>

        <div class="mb-3">
            <label for="site_name" class="form-label">Nazwa strony</label>
            <input type="text" id="site_name" name="site_name" class="form-control" placeholder="Podaj nazwƒô strony" value="<?= esc($settings['site_name'] ?? '') ?>" required>
        </div>

        <div class="mb-3">
            <label for="admin_email" class="form-label">E-mail administratora</label>
            <input type="email" id="admin_email" name="admin_email" class="form-control" placeholder="Podaj e-mail administratora" value="<?= esc($settings['admin_email'] ?? '') ?>" required>
        </div>

        <div class="mb-3">
            <label for="logo_url" class="form-label">Logo strony (URL)</label>
            <input type="url" id="logo_url" name="logo_url" class="form-control" placeholder="Podaj URL logo" value="<?= esc($settings['logo_url'] ?? '') ?>">
        </div>

        <div class="mb-3">
            <label for="timezone" class="form-label">Strefa czasowa</label>
            <select id="timezone" name="timezone" class="form-select">
                <?php foreach (timezone_identifiers_list() as $tz): ?>
                    <option value="<?= esc($tz) ?>" <?= ($settings['timezone'] ?? '') === $tz ? 'selected' : '' ?>><?= esc($tz) ?></option>
                <?php endforeach; ?>
            </select>
        </div>

        <div class="mb-3">
            <label for="log_limit" class="form-label">Maksymalna liczba log√≥w</label>
            <input type="number" id="log_limit" name="log_limit" class="form-control" value="<?= esc($settings['log_limit'] ?? 1000) ?>" min="100">
        </div>

        <div class="mb-3">
            <label for="api_key" class="form-label">Klucz API</label>
            <input type="text" id="api_key" name="api_key" class="form-control" placeholder="Podaj klucz API" value="<?= esc($settings['api_key'] ?? '') ?>">
        </div>

        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="maintenance_mode" name="maintenance_mode" <?= isset($settings['maintenance_mode']) && $settings['maintenance_mode'] ? 'checked' : '' ?>>
            <label class="form-check-label" for="maintenance_mode">Tryb konserwacji</label>
        </div>

        <button type="submit" class="btn btn-primary w-100">Zapisz zmiany</button>
    </form>

    <div id="responseMessage" class="alert mt-3" style="display:none;"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const settingsForm = document.getElementById("settingsForm");
    const responseMessage = document.getElementById("responseMessage");
    const resetSettings = document.getElementById("resetSettings");

    settingsForm.addEventListener("submit", function(e) {
        e.preventDefault();
        saveSettings(new FormData(settingsForm));
    });

    resetSettings.addEventListener("click", function() {
        if (confirm("Czy na pewno chcesz przywr√≥ciƒá domy≈õlne ustawienia?")) {
            fetch("/api/admin/reset_settings.php", { method: "POST" })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    responseMessage.style.display = "block";
                    responseMessage.className = "alert alert-danger";
                    responseMessage.textContent = "B≈ÇƒÖd resetowania ustawie≈Ñ.";
                }
            })
            .catch(error => console.error("B≈ÇƒÖd resetowania ustawie≈Ñ:", error));
        }
    });

    function saveSettings(formData) {
        let url = "/api/admin/save_settings.php";

        fetch(url, {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            responseMessage.style.display = "block";
            if (data.success) {
                responseMessage.className = "alert alert-success";
                responseMessage.textContent = "Ustawienia zapisane pomy≈õlnie!";
            } else {
                responseMessage.className = "alert alert-danger";
                responseMessage.textContent = "B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            responseMessage.style.display = "block";
            responseMessage.className = "alert alert-danger";
            responseMessage.textContent = "B≈ÇƒÖd po≈ÇƒÖczenia z serwerem.";
            console.error("B≈ÇƒÖd zapisywania ustawie≈Ñ:", error);
        });
    }
});
</script>
=== public/views/payments/make_payment.php ===
<?php
/*
|--------------------------------------------------------------------------
| Dokonaj P≈Çatno≈õci
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi dokonanie nowej p≈Çatno≈õci za rezerwacje
| lub inne us≈Çugi dostƒôpne w systemie.
|
| ≈öcie≈ºka: App/Views/payments/make_payment.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, dynamiczne przetwarzanie p≈Çatno≈õci)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (obs≈Çuga transakcji)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego przetwarzania p≈Çatno≈õci)
| - HTML, CSS (interfejs)
*/


if (!isset($_SESSION['user_id'])) {
    header("Location: /auth/login.php");
    exit;
}

$userId = $_SESSION['user_id'];
?>

<h1 class="text-center">Dokonaj P≈Çatno≈õci</h1>

<div class="payments-make-container">
    <form id="paymentForm">
        <?= csrf_field() ?>

        <!-- Wyb√≥r kwoty -->
        <div class="mb-3">
            <label for="amount" class="form-label">Kwota p≈Çatno≈õci (PLN)</label>
            <input type="number" class="form-control" id="amount" name="amount" min="1" required>
        </div>

        <!-- Metoda p≈Çatno≈õci -->
        <div class="mb-3">
            <label for="payment_method" class="form-label">Metoda p≈Çatno≈õci</label>
            <select class="form-select" id="payment_method" name="payment_method" required>
                <option value="card">Karta kredytowa</option>
                <option value="paypal">PayPal</option>
                <option value="transfer">Przelew bankowy</option>
            </select>
        </div>

        <div id="cardDetails" style="display:none;">
            <div class="mb-3">
                <label for="card_number" class="form-label">Numer karty</label>
                <input type="text" class="form-control" id="card_number" name="card_number" pattern="\d{16}" placeholder="1234 5678 9012 3456">
            </div>
            <div class="mb-3 row">
                <div class="col">
                    <label for="expiry_date" class="form-label">Data wa≈ºno≈õci</label>
                    <input type="text" class="form-control" id="expiry_date" name="expiry_date" placeholder="MM/YY">
                </div>
                <div class="col">
                    <label for="cvv" class="form-label">CVV</label>
                    <input type="text" class="form-control" id="cvv" name="cvv" pattern="\d{3}" placeholder="123">
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary w-100">Zap≈Çaƒá</button>
    </form>

    <div id="responseMessage" class="alert mt-3" style="display:none;"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const paymentTypeSelect = document.getElementById("payment_method");
    const cardDetails = document.getElementById("cardDetails");

    paymentTypeSelect.addEventListener("change", function() {
        cardDetails.style.display = this.value === "card" ? "block" : "none";
    });

    const paymentForm = document.getElementById("paymentForm");

    paymentForm.addEventListener("submit", function(e) {
        e.preventDefault();
        submitPayment(new FormData(paymentForm));
    });

    function submitPayment(formData) {
        fetch("/api/user/make_payment.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            const responseMessage = document.getElementById("responseMessage");
            responseMessage.style.display = "block";

            if (data.success) {
                responseMessage.className = "alert alert-success";
                responseMessage.textContent = "P≈Çatno≈õƒá zosta≈Ça pomy≈õlnie zrealizowana!";
                setTimeout(() => window.location.href = "/payments/history", 2000);
            } else {
                responseMessage.className = "alert alert-danger";
                responseMessage.textContent = "B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            const responseMessage = document.getElementById("responseMessage");
            responseMessage.style.display = "block";
            responseMessage.className = "alert alert-danger";
            responseMessage.textContent = "B≈ÇƒÖd po≈ÇƒÖczenia z serwerem.";
            console.error("B≈ÇƒÖd p≈Çatno≈õci:", error);
        });
    }
});
</script>
=== public/views/payments/methods.php ===
<?php
/*
|--------------------------------------------------------------------------
| Metody P≈Çatno≈õci U≈ºytkownika
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi zarzƒÖdzanie zapisanymi metodami p≈Çatno≈õci.
| Obs≈Çuguje dodawanie nowych metod oraz usuwanie zapisanych kart czy kont PayPal.
|
| ≈öcie≈ºka: App/Views/payments/methods.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, dynamiczne pobieranie metod p≈Çatno≈õci)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane metod p≈Çatno≈õci)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego pobierania metod p≈Çatno≈õci)
| - HTML, CSS (interfejs)
*/


if (!isset($_SESSION['user_id'])) {
    header("Location: /auth/login.php");
    exit;
}

$userId = $_SESSION['user_id'];
?>

<h1 class="text-center">Moje Metody P≈Çatno≈õci</h1>

<div class="payments-methods-container">
    <!-- Formularz dodawania metody p≈Çatno≈õci -->
    <form id="addPaymentMethodForm">
        <?= csrf_field() ?>
        <div class="mb-3">
            <label for="payment_type" class="form-label">Wybierz metodƒô</label>
            <select class="form-select" id="payment_type" name="payment_type" required>
                <option value="card">Karta kredytowa</option>
                <option value="paypal">PayPal</option>
                <option value="transfer">Przelew bankowy</option>
            </select>
        </div>

        <div id="cardDetails" style="display:none;">
            <div class="mb-3">
                <label for="card_number" class="form-label">Numer karty</label>
                <input type="text" class="form-control" id="card_number" name="card_number" pattern="\d{16}" placeholder="1234 5678 9012 3456">
            </div>
            <div class="mb-3 row">
                <div class="col">
                    <label for="expiry_date" class="form-label">Data wa≈ºno≈õci</label>
                    <input type="text" class="form-control" id="expiry_date" name="expiry_date" placeholder="MM/YY">
                </div>
                <div class="col">
                    <label for="cvv" class="form-label">CVV</label>
                    <input type="text" class="form-control" id="cvv" name="cvv" pattern="\d{3}" placeholder="123">
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary w-100">Dodaj metodƒô p≈Çatno≈õci</button>
    </form>

    <h3 class="mt-4">Zapisane Metody P≈Çatno≈õci</h3>
    <ul id="paymentMethodsList" class="list-group">
        <!-- Metody p≈Çatno≈õci ≈Çadowane dynamicznie -->
    </ul>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const paymentTypeSelect = document.getElementById("payment_type");
    const cardDetails = document.getElementById("cardDetails");

    paymentTypeSelect.addEventListener("change", function() {
        cardDetails.style.display = this.value === "card" ? "block" : "none";
    });

    const addPaymentForm = document.getElementById("addPaymentMethodForm");

    addPaymentForm.addEventListener("submit", function(e) {
        e.preventDefault();
        addPaymentMethod(new FormData(addPaymentForm));
    });

    function loadPaymentMethods() {
        fetch("/api/user/get_payment_methods.php")
            .then(response => response.json())
            .then(data => {
                const methodList = document.getElementById("paymentMethodsList");
                methodList.innerHTML = "";

                if (data.length > 0) {
                    data.forEach(method => {
                        methodList.innerHTML += `
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>${method.type === "card" ? "üí≥ Karta kredytowa" : method.type === "paypal" ? "üÖøÔ∏è PayPal" : "üè¶ Przelew bankowy"}</span>
                                <button class="btn btn-sm btn-danger" onclick="deletePaymentMethod(${method.id})">Usu≈Ñ</button>
                            </li>
                        `;
                    });
                } else {
                    methodList.innerHTML = `<li class="list-group-item text-muted">Brak zapisanych metod p≈Çatno≈õci</li>`;
                }
            })
            .catch(error => console.error("B≈ÇƒÖd ≈Çadowania metod p≈Çatno≈õci:", error));
    }

    function addPaymentMethod(formData) {
        fetch("/api/user/add_payment_method.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Metoda p≈Çatno≈õci zosta≈Ça dodana!");
                loadPaymentMethods();
            } else {
                alert("B≈ÇƒÖd: " + data.error);
            }
        })
        .catch(error => console.error("B≈ÇƒÖd dodawania metody p≈Çatno≈õci:", error));
    }

    function deletePaymentMethod(methodId) {
        if (!confirm("Czy na pewno chcesz usunƒÖƒá tƒô metodƒô p≈Çatno≈õci?")) return;

        fetch(`/api/user/delete_payment_method.php?id=${methodId}`, { method: "POST" })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Metoda p≈Çatno≈õci zosta≈Ça usuniƒôta!");
                loadPaymentMethods();
            } else {
                alert("B≈ÇƒÖd: " + data.error);
            }
        })
        .catch(error => console.error("B≈ÇƒÖd usuwania metody p≈Çatno≈õci:", error));
    }

    loadPaymentMethods();
});
</script>
=== public/views/payments/history.php ===
/*
|--------------------------------------------------------------------------
| Historia P≈Çatno≈õci
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi przeglƒÖdanie historii p≈Çatno≈õci i ich status√≥w.
| Obs≈Çuguje filtrowanie oraz podglƒÖd szczeg√≥≈Ç√≥w transakcji.
|
| ≈öcie≈ºka: App/Views/payments/history.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, dynamiczne pobieranie p≈Çatno≈õci)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane p≈Çatno≈õci)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego pobierania p≈Çatno≈õci)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Historia P≈Çatno≈õci</h1>

<div class="payments-history-container">
    <!-- Filtry p≈Çatno≈õci -->
    <form id="paymentFilterForm" class="row mt-4">
        <?= csrf_field() ?>
        <div class="col-md-4">
            <select class="form-control" name="status">
                <option value="">Wybierz status</option>
                <option value="completed">Zako≈Ñczona</option>
                <option value="pending">OczekujƒÖca</option>
                <option value="failed">Nieudana</option>
            </select>
        </div>
        <div class="col-md-4">
            <input type="date" class="form-control" name="start_date" placeholder="Data poczƒÖtkowa">
        </div>
        <div class="col-md-4 text-end">
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </div>
    </form>

    <!-- Tabela p≈Çatno≈õci -->
    <table class="table table-bordered table-striped table-responsive mt-3">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Kwota</th>
                <th>Metoda</th>
                <th>Status</th>
                <th>Data</th>
                <th class="text-center">Akcje</th>
            </tr>
        </thead>
        <tbody id="paymentList">
            <!-- Dane bƒôdƒÖ ≈Çadowane dynamicznie -->
        </tbody>
    </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterForm = document.getElementById("paymentFilterForm");

    filterForm.addEventListener("submit", function(e) {
        e.preventDefault();
        fetchPayments(new FormData(filterForm));
    });

    function fetchPayments(formData = null) {
        let url = "/api/user/payments.php";
        if (formData) {
            url += "?" + new URLSearchParams(formData).toString();
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const paymentTable = document.getElementById("paymentList");
                paymentTable.innerHTML = "";

                if (data.length === 0) {
                    paymentTable.innerHTML = `<tr><td colspan="6" class="text-center text-muted">Brak p≈Çatno≈õci spe≈ÇniajƒÖcych kryteria.</td></tr>`;
                } else {
                    data.forEach(payment => {
                        paymentTable.innerHTML += `
                            <tr>
                                <td>${payment.id}</td>
                                <td>${payment.amount} PLN</td>
                                <td>${payment.method}</td>
                                <td>${payment.status}</td>
                                <td>${payment.date}</td>
                                <td class="text-center">
                                    <button class="btn btn-info btn-sm" onclick="viewPayment(${payment.id})">PodglƒÖd</button>
                                    <button class="btn btn-warning btn-sm" onclick="refundPayment(${payment.id})">Zwrot</button>
                                </td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania p≈Çatno≈õci:", error));
    }

    function viewPayment(paymentId) {
        fetch(`/api/user/payment_details.php?id=${paymentId}`)
            .then(response => response.json())
            .then(data => {
                alert(`Szczeg√≥≈Çy p≈Çatno≈õci:\n\nKwota: ${data.amount} PLN\nMetoda: ${data.method}\nStatus: ${data.status}\nData: ${data.date}`);
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania szczeg√≥≈Ç√≥w p≈Çatno≈õci:", error));
    }

    function refundPayment(paymentId) {
        if (confirm("Czy na pewno chcesz zwr√≥ciƒá tƒô p≈Çatno≈õƒá?")) {
            fetch(`/api/user/refund_payment.php?id=${paymentId}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert("P≈Çatno≈õƒá zosta≈Ça zwr√≥cona.");
                        fetchPayments();
                    } else {
                        alert("B≈ÇƒÖd zwrotu p≈Çatno≈õci: " + data.message);
                    }
                })
                .catch(error => console.error("B≈ÇƒÖd zwrotu p≈Çatno≈õci:", error));
        }
    }

    fetchPayments();
});
</script>
=== public/views/payments/refund.php ===
<?php
/*
|--------------------------------------------------------------------------
| Historia Zwrot√≥w P≈Çatno≈õci
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi przeglƒÖdanie historii swoich zwrot√≥w p≈Çatno≈õci
| oraz ich status√≥w. Obs≈Çuguje filtrowanie oraz podglƒÖd szczeg√≥≈Ç√≥w.
|
| ≈öcie≈ºka: App/Views/payments/refund.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, dynamiczne pobieranie zwrot√≥w)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane zwrot√≥w p≈Çatno≈õci)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego pobierania zwrot√≥w)
| - HTML, CSS (interfejs)
*/


if (!isset($_SESSION['user_id'])) {
    header("Location: /auth/login.php");
    exit;
}

$userId = $_SESSION['user_id'];
?>

<h1 class="text-center">Historia Zwrot√≥w</h1>

<div class="payments-refund-container">
    <!-- Filtry zwrot√≥w -->
    <form id="refundFilterForm" class="row mt-4">
        <?= csrf_field() ?>
        <div class="col-md-4">
            <select class="form-control" name="status">
                <option value="">Wybierz status</option>
                <option value="processed">Zako≈Ñczony</option>
                <option value="pending">OczekujƒÖcy</option>
                <option value="failed">Nieudany</option>
            </select>
        </div>
        <div class="col-md-4">
            <input type="date" class="form-control" name="start_date" placeholder="Data poczƒÖtkowa">
        </div>
        <div class="col-md-4 text-end">
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </div>
    </form>

    <!-- Tabela zwrot√≥w -->
    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>Kwota</th>
                <th>Metoda</th>
                <th>Status</th>
                <th>Data</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody id="refundList">
            <tr>
                <td colspan="6" class="text-center text-muted">≈Åadowanie danych...</td>
            </tr>
        </tbody>
    </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterForm = document.getElementById("refundFilterForm");

    filterForm.addEventListener("submit", function(e) {
        e.preventDefault();
        fetchRefunds(new FormData(filterForm));
    });

    function fetchRefunds(formData = null) {
        let url = "/api/user/refunds.php";
        if (formData) {
            url += "?" + new URLSearchParams(formData).toString();
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const refundTable = document.getElementById("refundList");
                refundTable.innerHTML = "";

                if (data.length === 0) {
                    refundTable.innerHTML = `<tr><td colspan="6" class="text-center text-muted">Brak zwrot√≥w spe≈ÇniajƒÖcych kryteria.</td></tr>`;
                } else {
                    data.forEach(refund => {
                        let statusColor;
                        switch (refund.status) {
                            case "processed": statusColor = "text-success"; break;
                            case "pending": statusColor = "text-warning"; break;
                            case "failed": statusColor = "text-danger"; break;
                            default: statusColor = "text-secondary";
                        }

                        refundTable.innerHTML += `
                            <tr>
                                <td>${refund.id}</td>
                                <td>${refund.amount} PLN</td>
                                <td>${refund.method}</td>
                                <td class="${statusColor}">${refund.status}</td>
                                <td>${refund.date}</td>
                                <td>
                                    <button class="btn btn-info btn-sm" onclick="viewRefund(${refund.id})">PodglƒÖd</button>
                                </td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania zwrot√≥w:", error));
    }

    function viewRefund(refundId) {
        fetch(`/api/user/refund_details.php?id=${refundId}`)
            .then(response => response.json())
            .then(data => {
                alert(`Szczeg√≥≈Çy zwrotu:\n\nKwota: ${data.amount} PLN\nMetoda: ${data.method}\nStatus: ${data.status}\nData: ${data.date}`);
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania szczeg√≥≈Ç√≥w zwrotu:", error));
    }

    fetchRefunds();
});
</script>
=== public/views/user/profile.php ===
<?php
session_start();
if (!isset($_SESSION['user_id'])) {
    header("Location: /login.php");
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Edycja Profilu U≈ºytkownika
|--------------------------------------------------------------------------
| Ten plik pozwala u≈ºytkownikowi aktualizowaƒá swoje dane, zmieniaƒá has≈Ço
| oraz zarzƒÖdzaƒá swoim zdjƒôciem profilowym.
|
| ≈öcie≈ºka: App/Views/user/profile.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, walidacja formularzy)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane u≈ºytkownika)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego zapisu)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">M√≥j Profil</h1>

<div class="user-profile-container">
    <div class="row">
        <!-- Edycja Danych U≈ºytkownika -->
        <div class="col-md-6 mb-4">
            <div class="card shadow">
                <div class="card-body">
                    <h4>Edycja Danych</h4>
                    <form id="profileForm">
                        <?= csrf_field() ?>
                        <div class="mb-3">
                            <label for="name" class="form-label">Imiƒô i nazwisko</label>
                            <input type="text" class="form-control" id="name" name="name" value="<?= esc($user['name']) ?>" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Adres e-mail</label>
                            <input type="email" class="form-control" id="email" name="email" value="<?= esc($user['email']) ?>" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Zapisz zmiany</button>
                    </form>
                    <div id="profileResponseMessage" class="alert mt-3" style="display:none;"></div>
                </div>
            </div>
        </div>

        <!-- Zmiana Has≈Ça -->
        <div class="col-md-6 mb-4">
            <div class="card shadow">
                <div class="card-body">
                    <h4>Zmiana Has≈Ça</h4>
                    <form id="passwordForm">
                        <?= csrf_field() ?>
                        <div class="mb-3">
                            <label for="current_password" class="form-label">Obecne has≈Ço</label>
                            <input type="password" class="form-control" id="current_password" name="current_password" required>
                        </div>
                        <div class="mb-3">
                            <label for="new_password" class="form-label">Nowe has≈Ço</label>
                            <input type="password" class="form-control" id="new_password" name="new_password" required>
                        </div>
                        <div class="mb-3">
                            <label for="confirm_password" class="form-label">Potwierd≈∫ nowe has≈Ço</label>
                            <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                        </div>
                        <button type="submit" class="btn btn-danger w-100">Zmie≈Ñ has≈Ço</button>
                    </form>
                    <div id="passwordResponseMessage" class="alert mt-3" style="display:none;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ZarzƒÖdzanie Awatarem -->
    <div class="row mt-4">
        <div class="col-md-6 offset-md-3">
            <div class="card shadow text-center">
                <div class="card-body">
                    <h4>Zdjƒôcie Profilowe</h4>
                    <img id="profileAvatar" src="<?= esc($user['avatar_url'] ?? '/images/default-avatar.png') ?>" class="profile-avatar img-thumbnail mb-3" width="150">
                    <form id="avatarForm" enctype="multipart/form-data">
                        <?= csrf_field() ?>
                        <input type="file" class="form-control mb-2" id="avatar" name="avatar" accept="image/*" onchange="previewAvatar(event)">
                        <button type="submit" class="btn btn-success">Prze≈õlij nowe zdjƒôcie</button>
                        <button type="button" class="btn btn-danger" onclick="deleteAvatar()">Usu≈Ñ zdjƒôcie</button>
                    </form>
                    <div id="avatarResponseMessage" class="alert mt-3" style="display:none;"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const profileForm = document.getElementById("profileForm");
    const passwordForm = document.getElementById("passwordForm");
    const avatarForm = document.getElementById("avatarForm");
    const profileResponseMessage = document.getElementById("profileResponseMessage");
    const passwordResponseMessage = document.getElementById("passwordResponseMessage");
    const avatarResponseMessage = document.getElementById("avatarResponseMessage");

    profileForm.addEventListener("submit", function(e) {
        e.preventDefault();
        updateProfile(new FormData(profileForm));
    });

    passwordForm.addEventListener("submit", function(e) {
        e.preventDefault();
        updatePassword(new FormData(passwordForm));
    });

    avatarForm.addEventListener("submit", function(e) {
        e.preventDefault();
        updateAvatar(new FormData(avatarForm));
    });

    function updateProfile(formData) {
        fetch("/api/user/update_profile.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            profileResponseMessage.style.display = "block";
            if (data.success) {
                profileResponseMessage.className = "alert alert-success";
                profileResponseMessage.textContent = "Dane zaktualizowane!";
            } else {
                profileResponseMessage.className = "alert alert-danger";
                profileResponseMessage.textContent = "B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            profileResponseMessage.style.display = "block";
            profileResponseMessage.className = "alert alert-danger";
            profileResponseMessage.textContent = "B≈ÇƒÖd po≈ÇƒÖczenia z serwerem.";
            console.error("B≈ÇƒÖd aktualizacji profilu:", error);
        });
    }

    function updatePassword(formData) {
        fetch("/api/user/update_password.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            passwordResponseMessage.style.display = "block";
            if (data.success) {
                passwordResponseMessage.className = "alert alert-success";
                passwordResponseMessage.textContent = "Has≈Ço zmienione!";
            } else {
                passwordResponseMessage.className = "alert alert-danger";
                passwordResponseMessage.textContent = "B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            passwordResponseMessage.style.display = "block";
            passwordResponseMessage.className = "alert alert-danger";
            passwordResponseMessage.textContent = "B≈ÇƒÖd po≈ÇƒÖczenia z serwerem.";
            console.error("B≈ÇƒÖd zmiany has≈Ça:", error);
        });
    }

    function updateAvatar(formData) {
        fetch("/api/user/update_avatar.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            avatarResponseMessage.style.display = "block";
            if (data.success) {
                avatarResponseMessage.className = "alert alert-success";
                avatarResponseMessage.textContent = "Zdjƒôcie profilowe zaktualizowane!";
                location.reload();
            } else {
                avatarResponseMessage.className = "alert alert-danger";
                avatarResponseMessage.textContent = "B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            avatarResponseMessage.style.display = "block";
            avatarResponseMessage.className = "alert alert-danger";
            avatarResponseMessage.textContent = "B≈ÇƒÖd po≈ÇƒÖczenia z serwerem.";
            console.error("B≈ÇƒÖd aktualizacji awatara:", error);
        });
    }

    function deleteAvatar() {
        if (!confirm("Czy na pewno chcesz usunƒÖƒá zdjƒôcie profilowe?")) return;

        fetch("/api/user/delete_avatar.php", { method: "POST" })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Zdjƒôcie profilowe usuniƒôte!");
                location.reload();
            } else {
                alert("B≈ÇƒÖd: " + data.error);
            }
        })
        .catch(error => console.error("B≈ÇƒÖd usuwania awatara:", error));
    }

    function previewAvatar(event) {
        const reader = new FileReader();
        reader.onload = function() {
            const output = document.getElementById('profileAvatar');
            output.src = reader.result;
        };
        reader.readAsDataURL(event.target.files[0]);
    }
});
</script>
=== public/views/user/dashboard.php ===
<?php
session_start();
if (!isset($_SESSION['user_id'])) {
    header("Location: /login.php");
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Panel U≈ºytkownika
|--------------------------------------------------------------------------
| Ten plik jest centralnym miejscem zarzƒÖdzania kontem u≈ºytkownika. Wy≈õwietla
| podsumowanie aktywno≈õci oraz umo≈ºliwia prze≈ÇƒÖczanie miƒôdzy sekcjami dashboardu.
|
| ≈öcie≈ºka: App/Views/user/dashboard.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, dynamiczne ≈Çadowanie sekcji)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane u≈ºytkownika)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego ≈Çadowania sekcji)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Panel U≈ºytkownika</h1>

<div class="user-dashboard-container">
    <div class="row">
        <!-- Podsumowanie aktywno≈õci -->
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>Twoje Rezerwacje</h4>
                    <p id="totalBookings" class="display-6">0</p>
                    <a href="#bookings/view" class="dashboard-link">ZarzƒÖdzaj rezerwacjami</a>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>Historia P≈Çatno≈õci</h4>
                    <p id="totalPayments" class="display-6">0 PLN</p>
                    <a href="#payments/history" class="dashboard-link">Zobacz p≈Çatno≈õci</a>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>Twoje Dokumenty</h4>
                    <p id="totalDocuments" class="display-6">0</p>
                    <a href="#documents/user_documents" class="dashboard-link">PrzeglƒÖdaj dokumenty</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Ostatnie powiadomienia -->
    <h3 class="mt-4">Ostatnie Powiadomienia</h3>
    <ul id="notificationList" class="list-group">
        <!-- Powiadomienia ≈Çadowane dynamicznie -->
    </ul>
    <div id="noNotificationsMessage" class="alert alert-warning mt-3" style="display:none;">Brak nowych powiadomie≈Ñ.</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    function loadDashboardData() {
        fetch("/api/user/dashboard_summary.php")
            .then(response => response.json())
            .then(data => {
                document.getElementById("totalBookings").textContent = data.totalBookings || 0;
                document.getElementById("totalPayments").textContent = data.totalPayments + " PLN" || "0 PLN";
                document.getElementById("totalDocuments").textContent = data.totalDocuments || 0;

                const notificationList = document.getElementById("notificationList");
                const noNotificationsMessage = document.getElementById("noNotificationsMessage");
                notificationList.innerHTML = "";
                if (data.notifications.length > 0) {
                    data.notifications.forEach(notification => {
                        notificationList.innerHTML += `<li class="list-group-item">${notification.message}</li>`;
                    });
                    noNotificationsMessage.style.display = "none";
                } else {
                    noNotificationsMessage.style.display = "block";
                }
            })
            .catch(error => console.error("B≈ÇƒÖd ≈Çadowania danych u≈ºytkownika:", error));
    }

    loadDashboardData();
});
</script>
=== public/views/user/notifications.php ===
<?php
session_start();
if (!isset($_SESSION['user_id'])) {
    header("Location: /login.php");
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Powiadomienia U≈ºytkownika
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi przeglƒÖdanie powiadomie≈Ñ, oznaczanie ich
| jako przeczytane oraz usuwanie.
|
| ≈öcie≈ºka: App/Views/user/notifications.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane powiadomie≈Ñ)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego ≈Çadowania i aktualizacji powiadomie≈Ñ)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Powiadomienia</h1>

<div class="user-notifications-container">
    <ul id="notificationList" class="list-group">
        <!-- Powiadomienia ≈Çadowane dynamicznie -->
    </ul>
    <div id="noNotificationsMessage" class="alert alert-warning mt-3" style="display:none;">Brak nowych powiadomie≈Ñ.</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    function loadNotifications() {
        fetch("/api/user/get_notifications.php")
            .then(response => response.json())
            .then(data => {
                const notificationList = document.getElementById("notificationList");
                const noNotificationsMessage = document.getElementById("noNotificationsMessage");
                notificationList.innerHTML = "";
                
                if (data.length > 0) {
                    data.forEach(notification => {
                        notificationList.innerHTML += `
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>${notification.message}</span>
                                <div>
                                    ${notification.is_read ? "" : `<button class="btn btn-sm btn-success" onclick="markAsRead(${notification.id})">Oznacz jako przeczytane</button>`}
                                    <button class="btn btn-sm btn-danger" onclick="deleteNotification(${notification.id})">Usu≈Ñ</button>
                                </div>
                            </li>
                        `;
                    });
                    noNotificationsMessage.style.display = "none";
                } else {
                    noNotificationsMessage.style.display = "block";
                }
            })
            .catch(error => console.error("B≈ÇƒÖd ≈Çadowania powiadomie≈Ñ:", error));
    }

    function markAsRead(notificationId) {
        fetch(`/api/user/mark_notification_read.php?id=${notificationId}`, { method: "POST" })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    loadNotifications();
                } else {
                    alert("B≈ÇƒÖd: " + data.error);
                }
            })
            .catch(error => console.error("B≈ÇƒÖd oznaczania powiadomienia:", error));
    }

    function deleteNotification(notificationId) {
        if (!confirm("Czy na pewno chcesz usunƒÖƒá to powiadomienie?")) return;

        fetch(`/api/user/delete_notification.php?id=${notificationId}`, { method: "POST" })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    loadNotifications();
                } else {
                    alert("B≈ÇƒÖd: " + data.error);
                }
            })
            .catch(error => console.error("B≈ÇƒÖd usuwania powiadomienia:", error));
    }

    loadNotifications();
});
</script>
=== public/views/user/documents.php ===
<?php
session_start();

if (!isset($_SESSION['user_id'])) {
    header("Location: /login");
    exit();
}
?>

<h1 class="text-center">ZarzƒÖdzanie Dokumentami</h1>

<div class="documents-container">
    <form id="documentUploadForm" class="mt-3">
        <?= csrf_field() ?>
        <input type="file" name="document" class="form-control">
        <button type="submit" class="btn btn-primary mt-2">Prze≈õlij Dokument</button>
    </form>

    <ul id="documentList" class="list-group mt-3">
        <!-- Dokumenty bƒôdƒÖ ≈Çadowane dynamicznie -->
    </ul>
</div>

<script src="/js/documents.js"></script>
=== public/views/user/reports.php ===
<?php
session_start();
if (!isset($_SESSION['user_id'])) {
    header("Location: /login.php");
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Raporty U≈ºytkownika
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi generowanie raport√≥w dotyczƒÖcych rezerwacji,
| p≈Çatno≈õci i aktywno≈õci w systemie. Raporty mogƒÖ byƒá eksportowane do CSV, PDF, JSON.
|
| ≈öcie≈ºka: App/Views/user/reports.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, dynamiczne generowanie raport√≥w)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane do raport√≥w)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego generowania raport√≥w)
| - Chart.js (wizualizacja raport√≥w)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Raporty</h1>

<div class="user-reports-container">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card shadow">
                <div class="card-body">
                    <h4>Generowanie Raport√≥w</h4>
                    <form id="reportForm">
                        <?= csrf_field() ?>

                        <div class="mb-3">
                            <label for="reportType" class="form-label">Typ raportu</label>
                            <select class="form-select" id="reportType" name="reportType" required>
                                <option value="" disabled selected>Wybierz typ raportu</option>
                                <option value="bookings">Rezerwacje</option>
                                <option value="payments">P≈Çatno≈õci</option>
                                <option value="activity">Aktywno≈õƒá u≈ºytkownika</option>
                            </select>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="startDate" class="form-label">Data poczƒÖtkowa</label>
                                <input type="date" class="form-control" id="startDate" name="startDate" required>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="endDate" class="form-label">Data ko≈Ñcowa</label>
                                <input type="date" class="form-control" id="endDate" name="endDate" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="format" class="form-label">Format raportu</label>
                            <select class="form-select" id="format" name="format" required>
                                <option value="csv">CSV</option>
                                <option value="pdf">PDF</option>
                                <option value="json">JSON</option>
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">Generuj raport</button>
                    </form>

                    <div id="responseMessage" class="alert mt-3" style="display:none;"></div>
                    <div id="noResultsMessage" class="alert alert-warning mt-3" style="display:none;">Brak wynik√≥w dla wybranych kryteri√≥w.</div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-4">
        <h4>PodglƒÖd raportu</h4>
        <canvas id="reportChart"></canvas>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const reportForm = document.getElementById("reportForm");
    const responseMessage = document.getElementById("responseMessage");
    const noResultsMessage = document.getElementById("noResultsMessage");

    reportForm.addEventListener("submit", function(e) {
        e.preventDefault();
        generateReport(new FormData(reportForm));
    });

    function generateReport(formData) {
        let url = "/api/user/reports.php";

        fetch(url, {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            responseMessage.style.display = "block";
            if (data.success) {
                responseMessage.className = "alert alert-success";
                responseMessage.textContent = "Raport wygenerowany pomy≈õlnie! Pobierz go tutaj: " + data.download_link;
                renderChart(data.chartData);
                noResultsMessage.style.display = "none";
            } else if (data.noResults) {
                noResultsMessage.style.display = "block";
                responseMessage.style.display = "none";
            } else {
                responseMessage.className = "alert alert-danger";
                responseMessage.textContent = "B≈ÇƒÖd: " + data.error;
                noResultsMessage.style.display = "none";
            }
        })
        .catch(error => {
            responseMessage.style.display = "block";
            responseMessage.className = "alert alert-danger";
            responseMessage.textContent = "B≈ÇƒÖd po≈ÇƒÖczenia z serwerem.";
            console.error("B≈ÇƒÖd generowania raportu:", error);
            noResultsMessage.style.display = "none";
        });
    }

    function renderChart(chartData) {
        const ctx = document.getElementById("reportChart").getContext("2d");
        new Chart(ctx, {
            type: "bar",
            data: {
                labels: chartData.labels,
                datasets: [{
                    label: "Liczba zg≈Çosze≈Ñ",
                    data: chartData.values,
                    backgroundColor: "rgba(54, 162, 235, 0.6)"
                }]
            }
        });
    }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
=== public/views/bookings/view.php ===
<?php
// Sprawdzenie sesji u≈ºytkownika

if (!isset($_SESSION['user_id'])) {
    header("Location: /login");
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Lista Rezerwacji U≈ºytkownika
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi przeglƒÖdanie swoich rezerwacji, filtrowanie
| ich oraz sprawdzanie statusu ka≈ºdej rezerwacji.
|
| ≈öcie≈ºka: App/Views/bookings/view.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, dynamiczne ≈Çadowanie rezerwacji)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane o rezerwacjach)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego ≈Çadowania rezerwacji)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Moje Rezerwacje</h1>

<div class="bookings-container">
    <!-- Filtry rezerwacji -->
    <form id="bookingFilterForm" class="row mt-4">
        <?= csrf_field() ?>
        <div class="col-md-4">
            <select class="form-control" name="status">
                <option value="">Wybierz status</option>
                <option value="active">Aktywna</option>
                <option value="completed">Zako≈Ñczona</option>
                <option value="cancelled">Anulowana</option>
            </select>
        </div>
        <div class="col-md-4">
            <input type="date" class="form-control" name="start_date" placeholder="Data poczƒÖtkowa">
        </div>
        <div class="col-md-4 text-end">
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </div>
    </form>

    <!-- Tabela rezerwacji -->
    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>Pojazd</th>
                <th>Data rozpoczƒôcia</th>
                <th>Data zako≈Ñczenia</th>
                <th>Status</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody id="bookingList">
            <!-- Dane bƒôdƒÖ ≈Çadowane dynamicznie -->
        </tbody>
    </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterForm = document.getElementById("bookingFilterForm");

    filterForm.addEventListener("submit", function(e) {
        e.preventDefault();
        fetchBookings(new FormData(filterForm));
    });

    function fetchBookings(formData = null) {
        let url = "/api/user/bookings.php";
        if (formData) {
            url += "?" + new URLSearchParams(formData).toString();
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const bookingTable = document.getElementById("bookingList");
                bookingTable.innerHTML = "";

                if (data.length === 0) {
                    bookingTable.innerHTML = `<tr><td colspan="6" class="text-center text-muted">Brak rezerwacji spe≈ÇniajƒÖcych kryteria.</td></tr>`;
                } else {
                    data.forEach(booking => {
                        let statusClass = "";
                        switch (booking.status) {
                            case "active":
                                statusClass = "text-success";
                                break;
                            case "completed":
                                statusClass = "text-secondary";
                                break;
                            case "cancelled":
                                statusClass = "text-danger";
                                break;
                        }
                        bookingTable.innerHTML += `
                            <tr>
                                <td>${booking.id}</td>
                                <td>${booking.vehicle}</td>
                                <td>${booking.start_date}</td>
                                <td>${booking.end_date}</td>
                                <td class="${statusClass}">${booking.status}</td>
                                <td>
                                    <button class="btn btn-info btn-sm" onclick="viewBooking(${booking.id})">PodglƒÖd</button>
                                </td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania rezerwacji:", error));
    }

    function viewBooking(bookingId) {
        fetch(`/api/user/booking_details.php?id=${bookingId}`)
            .then(response => response.json())
            .then(data => {
                alert(`Szczeg√≥≈Çy rezerwacji:\n\nPojazd: ${data.vehicle}\nOd: ${data.start_date}\nDo: ${data.end_date}\nStatus: ${data.status}`);
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania szczeg√≥≈Ç√≥w rezerwacji:", error));
    }

    fetchBookings();
});
</script>
=== public/views/bookings/create.php ===
<?php
// Sprawdzenie sesji u≈ºytkownika

if (!isset($_SESSION['user_id'])) {
    header("Location: /login");
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Tworzenie Nowej Rezerwacji
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi dokonanie nowej rezerwacji pojazdu.
| Sprawdza dostƒôpno≈õƒá pojazd√≥w i umo≈ºliwia wyb√≥r metody p≈Çatno≈õci.
|
| ≈öcie≈ºka: App/Views/bookings/create.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, dynamiczne sprawdzanie dostƒôpno≈õci)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane pojazd√≥w, dostƒôpno≈õƒá, rezerwacje)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego sprawdzania dostƒôpno≈õci)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Nowa Rezerwacja</h1>

<div class="bookings-create-container">
    <form id="bookingForm">
        <?= csrf_field() ?>

        <!-- Wyb√≥r pojazdu -->
        <div class="mb-3">
            <label for="vehicle" class="form-label">Wybierz pojazd</label>
            <select class="form-select" id="vehicle" name="vehicle" required>
                <option value="" disabled selected>Wybierz pojazd</option>
                <?php foreach ($vehicles as $vehicle): ?>
                    <option value="<?= esc($vehicle['id']) ?>"><?= esc($vehicle['name']) ?> ‚Äì <?= esc($vehicle['price']) ?> PLN/dzie≈Ñ</option>
                <?php endforeach; ?>
            </select>
        </div>

        <!-- Wyb√≥r daty rezerwacji -->
        <div class="row">
            <div class="col-md-6 col-12 mb-3">
                <label for="start_date" class="form-label">Data rozpoczƒôcia</label>
                <input type="date" class="form-control" id="start_date" name="start_date" required>
            </div>
            <div class="col-md-6 col-12 mb-3">
                <label for="end_date" class="form-label">Data zako≈Ñczenia</label>
                <input type="date" class="form-control" id="end_date" name="end_date" required>
            </div>
        </div>

        <!-- Metoda p≈Çatno≈õci -->
        <div class="mb-3">
            <label for="payment_method" class="form-label">Metoda p≈Çatno≈õci</label>
            <select class="form-select" id="payment_method" name="payment_method" required>
                <option value="card">Karta kredytowa</option>
                <option value="paypal">PayPal</option>
                <option value="transfer">Przelew bankowy</option>
            </select>
        </div>

        <button type="submit" class="btn btn-primary w-100">Zarezerwuj</button>
    </form>

    <div id="responseMessage" class="alert mt-3" style="display:none;"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const bookingForm = document.getElementById("bookingForm");
    const responseMessage = document.getElementById("responseMessage");
    const vehicleSelect = document.getElementById("vehicle");
    const startDateInput = document.getElementById("start_date");
    const endDateInput = document.getElementById("end_date");

    // Sprawdzanie dostƒôpno≈õci pojazdu
    vehicleSelect.addEventListener("change", function() {
        checkAvailability(vehicleSelect.value);
    });

    bookingForm.addEventListener("submit", function(e) {
        e.preventDefault();
        if (validateForm()) {
            submitBooking(new FormData(bookingForm));
        }
    });

    function checkAvailability(vehicleId) {
        if (!vehicleId) return;
        fetch(`/api/bookings/check_availability.php?vehicle_id=${vehicleId}`)
            .then(response => response.json())
            .then(data => {
                if (!data.available) {
                    alert("Wybrany pojazd jest niedostƒôpny w wybranym terminie.");
                    vehicleSelect.value = "";
                }
            })
            .catch(error => console.error("B≈ÇƒÖd sprawdzania dostƒôpno≈õci:", error));
    }

    function validateForm() {
        const startDate = new Date(startDateInput.value);
        const endDate = new Date(endDateInput.value);
        if (startDate >= endDate) {
            alert("Data zako≈Ñczenia musi byƒá p√≥≈∫niejsza ni≈º data rozpoczƒôcia.");
            return false;
        }
        return true;
    }

    function submitBooking(formData) {
        fetch("/api/bookings/create.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            responseMessage.style.display = "block";
            if (data.success) {
                responseMessage.className = "alert alert-success";
                responseMessage.textContent = "Rezerwacja zosta≈Ça pomy≈õlnie dokonana!";
                setTimeout(() => window.location.href = "/dashboard", 2000);
            } else {
                responseMessage.className = "alert alert-danger";
                responseMessage.textContent = "B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            responseMessage.style.display = "block";
            responseMessage.className = "alert alert-danger";
            responseMessage.textContent = "B≈ÇƒÖd po≈ÇƒÖczenia z serwerem.";
            console.error("B≈ÇƒÖd rezerwacji:", error);
        });
    }
});
</script>
=== public/views/home.php ===
<section class="hero">
    <h1>Znajd≈∫ idealne auto na swojƒÖ podr√≥≈º</h1>
    <p>Elastyczny wynajem, najlepsze ceny i wsparcie 24/7.</p>
    <form class="search-form" action="/search" method="GET" onsubmit="return validateDates();">
        <input type="text" name="location" placeholder="Wpisz lokalizacjƒô odbioru" required>
        <input type="date" id="pickup_date" name="pickup_date" required>
        <input type="date" id="return_date" name="return_date" required>
        <button type="submit">Szukaj aut</button>
    </form>
    <p id="dateError" class="error-message">‚ùå Data zwrotu nie mo≈ºe byƒá wcze≈õniejsza ni≈º odbioru.</p>
</section>

<section class="features">
    <h2>Dlaczego warto wybraƒá Carfuse?</h2>
    <div class="feature-list">
        <div class="feature">‚úî Gwarancja najlepszych cen</div>
        <div class="feature">‚úî Wsparcie klienta 24/7</div>
        <div class="feature">‚úî Elastyczne warunki wynajmu</div>
    </div>
</section>

=== public/views/documents/signing_page.php ===
<?php
// Sprawdzenie sesji u≈ºytkownika

if (!isset($_SESSION['user_id'])) {
    header("Location: /login");
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Podpisywanie Dokument√≥w
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi podpisywanie dokument√≥w online.
| Podpisane dokumenty sƒÖ przechowywane w systemie.
|
| ≈öcie≈ºka: App/Views/documents/signing_page.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, podpis elektroniczny)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane dokument√≥w)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (Canvas API do podpisywania dokument√≥w)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Podpisywanie Dokument√≥w</h1>

<div class="documents-sign-container">
    <h3 class="mt-4">Dokumenty do Podpisania</h3>
    <ul id="signDocumentList" class="list-group">
        <!-- Dokumenty ≈Çadowane dynamicznie -->
    </ul>

    <!-- PodglƒÖd dokumentu i podpis elektroniczny -->
    <div id="signingArea" class="mt-4" style="display:none;">
        <h4>Podpisz Dokument</h4>
        <iframe id="documentPreview" style="width:100%; height:400px; border:1px solid #ccc;" onload="resizeIframe(this)"></iframe>
        
        <canvas id="signaturePad" class="border mt-3" style="width:100%; height:200px;" onmousedown="startDrawing(event)" onmouseup="stopDrawing()" onmousemove="draw(event)" ontouchstart="startDrawing(event)" ontouchend="stopDrawing()" ontouchmove="draw(event)"></canvas>
        <button class="btn btn-secondary mt-2" onclick="clearSignature()">Wyczy≈õƒá</button>
        <button class="btn btn-primary mt-2" onclick="submitSignature()">Podpisz</button>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    function loadSignDocuments() {
        fetch("/api/user/get_signable_documents.php")
            .then(response => response.json())
            .then(data => {
                const documentList = document.getElementById("signDocumentList");
                documentList.innerHTML = "";

                if (data.length > 0) {
                    data.forEach(doc => {
                        documentList.innerHTML += `
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>${doc.name}</span>
                                <button class="btn btn-sm btn-success" onclick="openSigning('${doc.file_url}', ${doc.id})">Podpisz</button>
                            </li>
                        `;
                    });
                } else {
                    documentList.innerHTML = `<li class="list-group-item text-muted">Brak dokument√≥w do podpisania</li>`;
                }
            })
            .catch(error => {
                console.error("B≈ÇƒÖd ≈Çadowania dokument√≥w:", error);
                alert("B≈ÇƒÖd ≈Çadowania dokument√≥w.");
            });
    }

    function openSigning(fileUrl, documentId) {
        document.getElementById("signingArea").style.display = "block";
        document.getElementById("documentPreview").src = fileUrl;
        document.getElementById("signaturePad").dataset.documentId = documentId;
    }

    function clearSignature() {
        const canvas = document.getElementById("signaturePad");
        const ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function submitSignature() {
        const canvas = document.getElementById("signaturePad");
        const signature = canvas.toDataURL();
        const documentId = canvas.dataset.documentId;

        fetch("/api/user/sign_document.php", {
            method: "POST",
            body: JSON.stringify({ documentId, signature }),
            headers: { "Content-Type": "application/json" }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Dokument zosta≈Ç podpisany!");
                loadSignDocuments();
                document.getElementById("signingArea").style.display = "none";
            } else {
                alert("B≈ÇƒÖd: " + data.error);
            }
        })
        .catch(error => {
            console.error("B≈ÇƒÖd podpisywania dokumentu:", error);
            alert("B≈ÇƒÖd podpisywania dokumentu.");
        });
    }

    loadSignDocuments();
});

function resizeIframe(iframe) {
    iframe.style.height = iframe.contentWindow.document.documentElement.scrollHeight + 'px';
}

let isDrawing = false;
let lastX = 0;
let lastY = 0;
const canvas = document.getElementById("signaturePad");
const ctx = canvas.getContext("2d");

function startDrawing(event) {
    isDrawing = true;
    [lastX, lastY] = getCoordinates(event);
}

function stopDrawing() {
    isDrawing = false;
    ctx.beginPath();
}

function draw(event) {
    if (!isDrawing) return;
    const [x, y] = getCoordinates(event);
    ctx.lineWidth = 2;
    ctx.lineCap = "round";
    ctx.strokeStyle = "#000";
    ctx.lineTo(x, y);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(x, y);
    [lastX, lastY] = [x, y];
}

function getCoordinates(event) {
    const rect = canvas.getBoundingClientRect();
    const x = (event.clientX || event.touches[0].clientX) - rect.left;
    const y = (event.clientY || event.touches[0].clientY) - rect.top;
    return [x, y];
}
</script>
=== public/views/documents/user_documents.php ===
<?php
// Sprawdzenie sesji u≈ºytkownika

if (!isset($_SESSION['user_id'])) {
    header("Location: /login");
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Dokumenty U≈ºytkownika
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi przeglƒÖdanie dokument√≥w, ich przesy≈Çanie
| oraz usuwanie. Pliki mogƒÖ byƒá np. umowami, fakturami czy dokumentami to≈ºsamo≈õci.
|
| ≈öcie≈ºka: App/Views/documents/user_documents.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, przesy≈Çanie, usuwanie)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane dokument√≥w)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego ≈Çadowania i usuwania plik√≥w)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Moje Dokumenty</h1>

<div class="documents-container">
    <!-- Przesy≈Çanie nowego dokumentu -->
    <form id="uploadDocumentForm" enctype="multipart/form-data" class="mb-4">
        <?= csrf_field() ?>
        <div class="mb-3">
            <label for="document" class="form-label">Prze≈õlij dokument (PDF, JPG, PNG)</label>
            <input type="file" class="form-control" id="document" name="document" accept=".pdf, .jpg, .jpeg, .png" required>
        </div>
        <button type="submit" class="btn btn-success">Prze≈õlij</button>
    </form>

    <!-- Lista dokument√≥w -->
    <h3 class="mt-4">Twoje Dokumenty</h3>
    <ul id="documentList" class="list-group">
        <!-- Dokumenty ≈Çadowane dynamicznie -->
    </ul>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const uploadForm = document.getElementById("uploadDocumentForm");

    uploadForm.addEventListener("submit", function(e) {
        e.preventDefault();
        const fileInput = document.getElementById("document");
        const file = fileInput.files[0];
        if (file && (file.type === "application/pdf" || file.type.startsWith("image/"))) {
            uploadDocument(new FormData(uploadForm));
        } else {
            alert("Nieprawid≈Çowy typ pliku. Dozwolone formaty: PDF, JPG, PNG.");
        }
    });

    function loadDocuments() {
        fetch("/api/user/get_documents.php")
            .then(response => response.json())
            .then(data => {
                const documentList = document.getElementById("documentList");
                documentList.innerHTML = "";

                if (data.length > 0) {
                    data.forEach(doc => {
                        documentList.innerHTML += `
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <a href="${doc.file_url}" target="_blank">${doc.name}</a>
                                <button class="btn btn-sm btn-danger" onclick="deleteDocument(${doc.id})">Usu≈Ñ</button>
                            </li>
                        `;
                    });
                } else {
                    documentList.innerHTML = `<li class="list-group-item text-muted">Brak dokument√≥w</li>`;
                }
            })
            .catch(error => {
                console.error("B≈ÇƒÖd ≈Çadowania dokument√≥w:", error);
                alert("B≈ÇƒÖd ≈Çadowania dokument√≥w.");
            });
    }

    function uploadDocument(formData) {
        fetch("/api/user/upload_document.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Dokument przes≈Çany pomy≈õlnie!");
                loadDocuments();
            } else {
                alert("B≈ÇƒÖd: " + data.error);
            }
        })
        .catch(error => {
            console.error("B≈ÇƒÖd przesy≈Çania dokumentu:", error);
            alert("B≈ÇƒÖd przesy≈Çania dokumentu.");
        });
    }

    function deleteDocument(documentId) {
        if (!confirm("Czy na pewno chcesz usunƒÖƒá ten dokument?")) return;

        fetch(`/api/user/delete_document.php?id=${documentId}`, { method: "POST" })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Dokument usuniƒôty!");
                loadDocuments();
            } else {
                alert("B≈ÇƒÖd: " + data.error);
            }
        })
        .catch(error => {
            console.error("B≈ÇƒÖd usuwania dokumentu:", error);
            alert("B≈ÇƒÖd usuwania dokumentu.");
        });
    }

    loadDocuments();
});
</script>
=== public/views/dashboard/dashboard.php ===
<?php
session_start();
$userRole = $_SESSION['user_role'] ?? 'user'; // Assume 'user' role if not set

$module = $_GET['module'] ?? 'home';
$view = __DIR__ . "/dashboard_modules/{$module}.php";

if (!file_exists($view)) {
    $view = __DIR__ . "/dashboard_modules/404.php"; // Load 404 if module doesn't exist
}

include __DIR__ . '/../layouts/main.php';
?>
=== public/views/dashboard/modules/admin/payments/dashboard.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="payments-dashboard">
    <?php include __DIR__ . '/../../../admin/payments/dashboard.php'; ?>
</div>
=== public/views/dashboard/modules/admin/payments/transactions.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="transactions-container">
    <?php include __DIR__ . '/../../../admin/transactions.php'; ?>
</div>
=== public/views/dashboard/modules/admin/payments/refunds.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="refunds-container">
    <?php include __DIR__ . '/../../../admin/refunds.php'; ?>
</div>
=== public/views/dashboard/modules/admin/dashboard.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="dashboard-overview">
    <?php include __DIR__ . '/../../admin/dashboard.php'; ?>
</div>
=== public/views/dashboard/modules/admin/users.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="users-container">
    <?php include __DIR__ . '/../../admin/users.php'; ?>
</div>
=== public/views/dashboard/modules/admin/audit_logs.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="audit-logs-container">
    <?php include __DIR__ . '/../../admin/audit_logs.php'; ?>
</div>
=== public/views/dashboard/modules/admin/logs.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="logs-container">
    <?php include __DIR__ . '/../../admin/logs.php'; ?>
</div>
=== public/views/dashboard/modules/admin/documents.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="documents-container">
    <?php include __DIR__ . '/../../admin/documents.php'; ?>
</div>
=== public/views/dashboard/modules/admin/reports.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="reports-container">
    <?php include __DIR__ . '/../../admin/reports.php'; ?>
</div>
=== public/views/dashboard/modules/admin/settings.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="settings-container">
    <?php include __DIR__ . '/../../admin/settings.php'; ?>
</div>
=== public/views/dashboard/modules/user/profile.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn()) {
    header("Location: /login");
    exit();
}
?>

<div class="profile-container">
    <?php include __DIR__ . '/../../user/profile.php'; ?>
</div>
=== public/views/dashboard/modules/user/overview.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn()) {
    header("Location: /login");
    exit();
}
?>

<div class="dashboard-overview">
    <?php include __DIR__ . '/../../user/dashboard.php'; ?>
</div>
=== public/views/dashboard/modules/user/notifications.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn()) {
    header("Location: /login");
    exit();
}
?>

<div class="notifications-container">
    <?php include __DIR__ . '/../../user/notifications.php'; ?>
</div>
=== public/views/dashboard/modules/user/douments.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn()) {
    header("Location: /login");
    exit();
}
?>

<div class="documents-container">
    <?php include __DIR__ . '/../../user/documents.php'; ?>
</div>
=== public/views/dashboard/modules/user/bookings.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn()) {
    header("Location: /login");
    exit();
}
?>

<div class="bookings-container">
    <?php include __DIR__ . '/../../user/bookings.php'; ?>
</div>
=== public/views/dashboard/modules/user/settings.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn()) {
    header("Location: /login");
    exit();
}
?>

<div class="settings-container">
    <?php include __DIR__ . '/../../user/settings.php'; ?>
</div>
=== public/views/dashboard/modules/user/payments.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn()) {
    header("Location: /login");
    exit();
}
?>

<div class="payments-container">
    <?php include __DIR__ . '/../../user/payments.php'; ?>
</div>
=== public/views/dashboard/modules/shared/charts.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn()) {
    header("Location: /login");
    exit();
}
?>

<div class="charts-container">
    <div class="row">
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-body">
                    <h5 class="text-center">Trendy Rezerwacji</h5>
                    <canvas id="bookingTrends"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-body">
                    <h5 class="text-center">Trendy Przychod√≥w</h5>
                    <canvas id="revenueTrends"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/js/charts.js"></script>
=== public/views/dashboard/modules/shared/tables.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn()) {
    header("Location: /login");
    exit();
}
?>

<div class="tables-container">
    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nazwa</th>
                <th>Status</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody id="sharedTableData">
            <!-- Dynamiczne ≈Çadowanie danych -->
        </tbody>
    </table>
</div>

<script src="/js/tables.js"></script>
=== public/views/dashboard/modules/shared/modals.php ===
<div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Potwierdzenie</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Czy na pewno chcesz wykonaƒá tƒô akcjƒô?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" id="confirmAction">Tak</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Anuluj</button>
            </div>
        </div>
    </div>
</div>

<script src="/js/modals.js"></script>
=== public/index copy.php ===
<?php
/*
|--------------------------------------------------------------------------
| CarFuse Homepage
|--------------------------------------------------------------------------
| This is now the landing page and entry point for the application.
|
| Path: public/index.php
*/

declare(strict_types=1);

require_once __DIR__ . '/../bootstrap.php';
require_once __DIR__ . '/../vendor/autoload.php';
require_once __DIR__ . '/../App/Helpers/SecurityHelper.php';

$view = __DIR__ . '/views/home.php'; // Home page content
include __DIR__ . '/layouts/main.php';
?>
=== public/logout.php ===
<?php



setcookie("PHPSESSID", "", time() - 3600, "/");

if (session_status() === PHP_SESSION_NONE) {
    session_start();
}
session_unset();
session_destroy();
header("Location: /");
exit;

http_response_code(200);
echo json_encode(["message" => "Logged out successfully."]);
=== public/js/main.js ===
=== public/js/ajax.js ===
class Ajax {
    constructor() {
        this.baseUrl = '/api';
        this.token = localStorage.getItem('auth_token') || null;
    }

    /**
     * Stores the authentication token for future requests.
     */
    setToken(token) {
        this.token = token;
        localStorage.setItem('auth_token', token);
    }

    /**
     * Makes an API request with automatic retry and session handling.
     */
    async request(endpoint, method = 'GET', data = null, retry = true) {
        const url = `${this.baseUrl}${endpoint}`;
        const headers = {
            'Content-Type': 'application/json',
            'Authorization': this.token ? `Bearer ${this.token}` : ''
        };

        const options = { method, headers };

        if (data) {
            options.body = JSON.stringify(data);
        }

        try {
            const response = await fetch(url, options);

            if (response.status === 401 && retry) {
                // Attempt token refresh before retrying request
                const refreshed = await this.refreshToken();
                if (refreshed) {
                    return this.request(endpoint, method, data, false);
                }
                throw new Error('Unauthorized: Session expired.');
            }

            if (!response.ok) {
                throw new Error(`HTTP error ${response.status}: ${response.statusText}`);
            }

            return await response.json();
        } catch (error) {
            console.error('B≈ÇƒÖd API:', error);
            throw error;
        }
    }

    /**
     * Fetches data using GET method.
     */
    get(endpoint) {
        return this.request(endpoint, 'GET');
    }

    /**
     * Sends data using POST method.
     */
    post(endpoint, data) {
        return this.request(endpoint, 'POST', data);
    }

    /**
     * Updates data using PUT method.
     */
    put(endpoint, data) {
        return this.request(endpoint, 'PUT', data);
    }

    /**
     * Deletes a resource using DELETE method.
     */
    delete(endpoint) {
        return this.request(endpoint, 'DELETE');
    }

    /**
     * Attempts to refresh the session token.
     */
    async refreshToken() {
        try {
            const response = await fetch(`${this.baseUrl}/session/refresh`, {
                method: 'POST',
                headers: { 'Authorization': this.token ? `Bearer ${this.token}` : '' }
            });

            if (!response.ok) {
                this.clearToken();
                return false;
            }

            const data = await response.json();
            if (data.success && data.token) {
                this.setToken(data.token);
                return true;
            }

            return false;
        } catch (error) {
            console.error('B≈ÇƒÖd od≈õwie≈ºania tokena:', error);
            this.clearToken();
            return false;
        }
    }

    /**
     * Clears stored authentication token.
     */
    clearToken() {
        this.token = null;
        localStorage.removeItem('auth_token');
    }
}

// Ensures global availability
window.ajax = new Ajax();
=== public/js/dashboard.js ===
import ajax from './ajax';
import { showErrorToast } from './toasts';

document.addEventListener('DOMContentLoaded', function () {
    fetchStatistics();
    setInterval(checkUserActivity, 60000); // Aktualizuj statystyki tylko przy aktywno≈õci u≈ºytkownika
    window.addEventListener('resize', handleResponsiveUpdates);
});

/**
 * Fetches real-time statistics for the dashboard.
 */
async function fetchStatistics() {
    try {
        const response = await ajax.get('/statistics');
        updateWidgets(response);
    } catch (error) {
        showErrorToast('Nie uda≈Ço siƒô pobraƒá statystyk.');
        console.error('B≈ÇƒÖd pobierania statystyk:', error);
    }
}

/**
 * Updates dashboard widgets based on API data.
 */
function updateWidgets(data) {
    updateWidget('total-users', data.totalUsers);
    updateWidget('active-sessions', data.activeSessions);
    updateWidget('new-bookings', data.newBookings);
    updateWidget('total-revenue', formatCurrency(data.totalRevenue));
}

/**
 * Updates a single widget if it exists.
 */
function updateWidget(widgetId, value) {
    const widget = document.getElementById(widgetId);
    if (widget) {
        widget.innerText = value ?? 'Brak danych';
    }
}

/**
 * Handles dynamic UI responsiveness updates.
 */
function handleResponsiveUpdates() {
    console.log('Zaktualizowano UI na podstawie zmiany rozmiaru ekranu.');
    // Mo≈ºna dodaƒá dodatkowe funkcje do aktualizacji wid≈ºet√≥w lub uk≈Çadu
}

/**
 * Formats numbers into readable currency format.
 */
function formatCurrency(amount) {
    return new Intl.NumberFormat('pl-PL', { style: 'currency', currency: 'PLN' }).format(amount);
}

/**
 * Checks user activity and updates statistics only if the tab is active.
 */
function checkUserActivity() {
    if (document.visibilityState === 'visible') {
        fetchStatistics();
    }
}
=== public/js/notifications.js ===
import ajax from './ajax';
import { showErrorToast, showSuccessToast } from './toasts';

let lastFetchTimestamp = 0;
const FETCH_INTERVAL = 30000; // 30 seconds

document.addEventListener('DOMContentLoaded', function () {
    if (document.visibilityState === 'visible') {
        fetchNotifications();
    }
    document.addEventListener('visibilitychange', handleVisibilityChange);
    document.addEventListener('newEvent', handleNewEvent); // Custom event for new actions
});

/**
 * Handles visibility change events.
 */
function handleVisibilityChange() {
    if (document.visibilityState === 'visible') {
        fetchNotifications();
    }
}

/**
 * Handles new events that require fresh notifications.
 */
function handleNewEvent() {
    fetchNotifications();
}

/**
 * Fetches notifications from the server.
 */
async function fetchNotifications() {
    const now = Date.now();
    if (now - lastFetchTimestamp < FETCH_INTERVAL) return; // Prevent redundant calls

    lastFetchTimestamp = now;
    try {
        const notifications = await ajax.get('/notifications');
        if (notifications.length > 0) {
            displayNotifications(notifications);
        } else {
            displayNoNotificationsMessage();
        }
    } catch (error) {
        console.error('B≈ÇƒÖd pobierania powiadomie≈Ñ:', error);
        showErrorToast('Nie uda≈Ço siƒô pobraƒá powiadomie≈Ñ.');
    }
}

/**
 * Displays notifications in the UI.
 */
function displayNotifications(notifications) {
    const notificationsContainer = document.getElementById('notifications-container');
    if (!notificationsContainer) return;

    notificationsContainer.innerHTML = '';

    notifications.forEach(notification => {
        const notificationElement = document.createElement('div');
        notificationElement.className = `notification ${notification.read ? 'read' : 'unread'}`;
        notificationElement.innerHTML = `
            <p>${notification.message}</p>
            <button class="mark-as-read" data-id="${notification.id}">Oznacz jako przeczytane</button>
        `;
        notificationsContainer.appendChild(notificationElement);
    });

    attachMarkAsReadListeners();
}

/**
 * Adds event listeners to "Mark as Read" buttons.
 */
function attachMarkAsReadListeners() {
    document.querySelectorAll('.mark-as-read').forEach(button => {
        button.addEventListener('click', function () {
            markAsRead(this.dataset.id);
        });
    });
}

/**
 * Marks a notification as read.
 */
async function markAsRead(notificationId) {
    try {
        const response = await ajax.post(`/notifications/${notificationId}/read`);
        if (response.success) {
            updateNotificationStatus(notificationId);
            showSuccessToast('Powiadomienie oznaczone jako przeczytane.');
        } else {
            showErrorToast(response.error || 'B≈ÇƒÖd oznaczania powiadomienia jako przeczytanego.');
        }
    } catch (error) {
        console.error('B≈ÇƒÖd oznaczania powiadomienia:', error);
        showErrorToast('Nie uda≈Ço siƒô oznaczyƒá powiadomienia.');
    }
}

/**
 * Updates the UI when a notification is marked as read.
 */
function updateNotificationStatus(notificationId) {
    const notificationElement = document.querySelector(`.mark-as-read[data-id="${notificationId}"]`);
    if (notificationElement) {
        notificationElement.closest('.notification').classList.add('read');
        notificationElement.remove();
    }
}

/**
 * Displays a message when there are no notifications.
 */
function displayNoNotificationsMessage() {
    const notificationsContainer = document.getElementById('notifications-container');
    if (!notificationsContainer) return;

    notificationsContainer.innerHTML = `<p class="text-muted">Brak nowych powiadomie≈Ñ.</p>`;
}
=== public/js/forms.js ===
document.addEventListener('DOMContentLoaded', function () {
    const forms = document.querySelectorAll('form');

    forms.forEach(form => {
        form.addEventListener('submit', function (event) {
            if (!validateForm(form)) {
                event.preventDefault();
            }
        });

        attachRealTimeValidation(form);
    });
});

/**
 * Validates form before submission.
 */
function validateForm(form) {
    let isValid = true;
    const inputs = form.querySelectorAll('input[required], textarea[required], select[required]');

    inputs.forEach(input => {
        if (!validateInput(input)) {
            isValid = false;
        }
    });

    return isValid;
}

/**
 * Attaches real-time validation to form inputs.
 */
function attachRealTimeValidation(form) {
    const inputs = form.querySelectorAll('input[required], textarea[required], select[required]');

    inputs.forEach(input => {
        input.addEventListener('input', function () {
            validateInput(input);
        });
    });
}

/**
 * Validates a single input field.
 */
function validateInput(input) {
    const value = input.value.trim();
    const type = input.type;

    if (!value) {
        showError(input, 'To pole jest wymagane.');
        return false;
    }

    if (type === 'email' && !isValidEmail(value)) {
        showError(input, 'Wprowad≈∫ poprawny adres e-mail.');
        return false;
    }

    if (type === 'password') {
        if (value.length < 6) {
            showError(input, 'Has≈Ço musi zawieraƒá co najmniej 6 znak√≥w.');
            return false;
        }
        if (!/\d/.test(value) || !/[A-Za-z]/.test(value)) {
            showError(input, 'Has≈Ço musi zawieraƒá litery i cyfry.');
            return false;
        }
    }

    if (input.dataset.minLength && value.length < input.dataset.minLength) {
        showError(input, `To pole musi mieƒá co najmniej ${input.dataset.minLength} znak√≥w.`);
        return false;
    }

    clearError(input);
    return true;
}

/**
 * Displays an error message next to the form field.
 */
function showError(input, message) {
    let error = input.nextElementSibling;
    if (!error || !error.classList.contains('error-message')) {
        error = document.createElement('div');
        error.classList.add('error-message');
        input.parentNode.insertBefore(error, input.nextSibling);
    }
    error.textContent = message;
    input.classList.add('error');
}

/**
 * Clears an error message when input is corrected.
 */
function clearError(input) {
    let error = input.nextElementSibling;
    if (error && error.classList.contains('error-message')) {
        error.remove();
    }
    input.classList.remove('error');
}

/**
 * Checks if an email is valid.
 */
function isValidEmail(email) {
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;
    return emailPattern.test(email);
}
=== public/js/profile.js ===
import ajax from './ajax';
import { showErrorToast, showSuccessToast } from './toasts';

document.addEventListener('DOMContentLoaded', function () {
    initProfileForm();
});

/**
 * Initializes profile form interactions.
 */
function initProfileForm() {
    const profileForm = document.getElementById('profile-form');
    const avatarUpload = document.getElementById('avatar-upload');

    if (profileForm) profileForm.addEventListener('submit', updateProfile);
    if (avatarUpload) avatarUpload.addEventListener('change', handleAvatarUpload);
}

/**
 * Handles profile update submission.
 */
async function updateProfile(event) {
    event.preventDefault();
    const formData = new FormData(event.target);

    if (!validateProfileForm(formData)) return;

    try {
        const response = await ajax.post('/profile/update', formData);
        if (response.success) {
            showSuccessToast('Profil zaktualizowany pomy≈õlnie.');
        } else {
            showErrorToast(response.message || 'B≈ÇƒÖd podczas aktualizacji profilu.');
        }
    } catch (error) {
        console.error('B≈ÇƒÖd aktualizacji profilu:', error);
        showErrorToast('Nie uda≈Ço siƒô zaktualizowaƒá profilu.');
    }
}

/**
 * Handles avatar image upload and preview.
 */
function handleAvatarUpload(event) {
    const fileInput = event.target;
    const file = fileInput.files[0];

    if (!validateImage(file)) return;

    const reader = new FileReader();
    reader.onload = function (e) {
        document.getElementById('avatar-preview').src = e.target.result;
    };
    reader.readAsDataURL(file);
}

/**
 * Validates profile form inputs.
 */
function validateProfileForm(formData) {
    const name = formData.get('name').trim();
    const email = formData.get('email').trim();
    const password = formData.get('password')?.trim();

    if (!name) {
        showErrorToast('Imiƒô i nazwisko jest wymagane.');
        return false;
    }

    if (!isValidEmail(email)) {
        showErrorToast('Wprowad≈∫ poprawny adres e-mail.');
        return false;
    }

    if (password && password.length < 6) {
        showErrorToast('Has≈Ço musi mieƒá co najmniej 6 znak√≥w.');
        return false;
    }

    return true;
}

/**
 * Validates uploaded image format.
 */
function validateImage(file) {
    if (!file) {
        showErrorToast('Wybierz obraz do przes≈Çania.');
        return false;
    }

    const allowedTypes = ['image/png', 'image/jpeg', 'image/webp'];
    if (!allowedTypes.includes(file.type)) {
        showErrorToast('Nieobs≈Çugiwany format obrazu. Dozwolone: PNG, JPG, WEBP.');
        return false;
    }

    return true;
}

/**
 * Checks if an email is valid.
 */
function isValidEmail(email) {
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;
    return emailPattern.test(email);
}
=== public/js/auth.js ===
import ajax from './ajax';
import { showErrorToast, showSuccessToast } from './toasts';

document.addEventListener('DOMContentLoaded', function () {
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const logoutButton = document.getElementById('logout-button');

    if (loginForm) loginForm.addEventListener('submit', handleLogin);
    if (registerForm) registerForm.addEventListener('submit', handleRegister);
    if (logoutButton) logoutButton.addEventListener('click', logout);

    refreshSession(); // Validate session on load
    setInterval(refreshSession, 60000); // Check session expiration every 60s
});

/**
 * Handles user login
 */
async function handleLogin(event) {
    event.preventDefault();
    clearErrors();

    const formData = new FormData(event.target);
    const username = formData.get('username').trim();
    const password = formData.get('password').trim();

    if (!validateCredentials(username, password)) return;

    if (await checkAndRefreshSession()) return;

    try {
        const response = await ajax.post('/login', { username, password });
        if (response.success) {
            ajax.setToken(response.token);
            showSuccessToast('Logowanie udane! Przekierowywanie...');
            setTimeout(() => window.location.href = '/dashboard', 1500);
        } else {
            showError(response.error || 'B≈ÇƒÖd logowania.');
        }
    } catch (error) {
        console.error('B≈ÇƒÖd logowania:', error);
        showError('Nie uda≈Ço siƒô zalogowaƒá.');
    }
}

/**
 * Handles user registration
 */
async function handleRegister(event) {
    event.preventDefault();
    clearErrors();

    const formData = new FormData(event.target);
    const username = formData.get('username').trim();
    const email = formData.get('email').trim();
    const password = formData.get('password').trim();
    const confirmPassword = formData.get('confirm_password').trim();

    if (!validateCredentials(username, password, confirmPassword, email)) return;

    if (await checkAndRefreshSession()) return;

    try {
        const response = await ajax.post('/register', { username, email, password });
        if (response.success) {
            ajax.setToken(response.token);
            showSuccessToast('Rejestracja udana! Przekierowywanie...');
            setTimeout(() => window.location.href = '/dashboard', 1500);
        } else {
            showError(response.error || 'B≈ÇƒÖd rejestracji.');
        }
    } catch (error) {
        console.error('B≈ÇƒÖd rejestracji:', error);
        showError('Nie uda≈Ço siƒô zarejestrowaƒá.');
    }
}

/**
 * Logs out user and clears session data
 */
function logout() {
    localStorage.removeItem('auth_token');
    showSuccessToast('Wylogowano pomy≈õlnie.');
    setTimeout(() => window.location.href = '/auth/login', 1500);
}

/**
 * Refreshes the user session and handles expiration
 */
async function refreshSession() {
    const token = localStorage.getItem('auth_token');
    if (!token) return;

    try {
        const payload = JSON.parse(atob(token.split('.')[1]));
        const expiration = payload.exp * 1000;
        const now = Date.now();

        if (now >= expiration) {
            await logout();
        } else {
            const response = await ajax.get('/session/refresh');
            if (response.success) {
                ajax.setToken(response.token);
            } else {
                await logout();
            }
        }
    } catch (error) {
        await logout();
    }
}

/**
 * Checks and refreshes the session if the token is expired
 */
async function checkAndRefreshSession() {
    const token = localStorage.getItem('auth_token');
    if (!token) return false;

    try {
        const payload = JSON.parse(atob(token.split('.')[1]));
        const expiration = payload.exp * 1000;
        const now = Date.now();

        if (now >= expiration) {
            await refreshSession();
            return true;
        }
    } catch (error) {
        await logout();
        return true;
    }

    return false;
}

/**
 * Clears error messages
 */
function clearErrors() {
    const errorContainer = document.getElementById('error-container');
    if (errorContainer) {
        errorContainer.innerText = '';
        errorContainer.style.display = 'none';
    }
}

/**
 * Displays an error message
 */
function showError(message) {
    const errorContainer = document.getElementById('error-container');
    if (errorContainer) {
        errorContainer.innerText = message;
        errorContainer.style.display = 'block';
    }
    showErrorToast(message);
}

/**
 * Validates login and registration credentials
 */
function validateCredentials(username, password, confirmPassword = null, email = null) {
    if (!username || username.length < 3) {
        showError('Nazwa u≈ºytkownika musi mieƒá co najmniej 3 znaki.');
        return false;
    }

    if (email && !isValidEmail(email)) {
        showError('Wprowad≈∫ poprawny adres e-mail.');
        return false;
    }

    if (!password || password.length < 6) {
        showError('Has≈Ço musi mieƒá co najmniej 6 znak√≥w.');
        return false;
    }

    if (confirmPassword !== null && password !== confirmPassword) {
        showError('Has≈Ça nie sƒÖ identyczne.');
        return false;
    }

    return true;
}

/**
 * Validates email format
 */
function isValidEmail(email) {
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailPattern.test(email);
}
=== public/js/toasts.js ===
document.addEventListener('DOMContentLoaded', function () {
    ensureToastContainer();
});

/**
 * Ensures the toast container exists on the page.
 */
function ensureToastContainer() {
    let toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        document.body.appendChild(toastContainer);
    }
}

/**
 * Creates a toast notification.
 */
function createToast(type, message, autoDismiss = true, dismissTime = 3000) {
    const toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
        console.error('Toast container not found');
        return;
    }

    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.innerHTML = `
        <span>${message}</span>
        <button class="toast-close">&times;</button>
    `;

    toastContainer.appendChild(toast);

    // Add event listener for manual close
    toast.querySelector('.toast-close').addEventListener('click', function () {
        fadeOutToast(toast);
    });

    if (autoDismiss) {
        setTimeout(() => fadeOutToast(toast), dismissTime);
    }
}

/**
 * Smoothly fades out and removes a toast notification.
 */
function fadeOutToast(toast) {
    toast.style.opacity = '0';
    setTimeout(() => toast.remove(), 300);
}

/**
 * Displays a success toast.
 */
function showSuccessToast(message, autoDismiss = true, dismissTime = 3000) {
    createToast('success', message, autoDismiss, dismissTime);
}

/**
 * Displays a warning toast.
 */
function showWarningToast(message, autoDismiss = true, dismissTime = 3000) {
    createToast('warning', message, autoDismiss, dismissTime);
}

/**
 * Displays an error toast.
 */
function showErrorToast(message, autoDismiss = true, dismissTime = 3000) {
    createToast('error', message, autoDismiss, dismissTime);
}
=== public/js/documents.js ===
import ajax from './ajax';
import { showErrorToast, showSuccessToast } from './toasts';

document.addEventListener('DOMContentLoaded', function () {
    initDocumentForm();
});

/**
 * Initializes document-related form actions.
 */
function initDocumentForm() {
    const uploadForm = document.getElementById('document-upload-form');
    const signButton = document.getElementById('sign-button');
    const uploadInput = document.getElementById('uploadButton');

    if (uploadForm) uploadForm.addEventListener('submit', uploadDocument);
    if (signButton) signButton.addEventListener('click', handleSignButtonClick);
    if (uploadInput) uploadInput.addEventListener('change', handleFileSelection);
}

/**
 * Handles document upload process.
 */
async function uploadDocument(event) {
    event.preventDefault();
    const formData = new FormData(event.target);

    if (!validateFileUpload(formData)) {
        return;
    }

    try {
        const response = await fetch('/api/user/documents.php?action=upload', {
            method: 'POST',
            body: formData
        }).then(res => res.json());

        if (response.success) {
            showSuccessToast('Dokument przes≈Çany pomy≈õlnie.');
            previewDocument(response.documentUrl);
        } else {
            showErrorToast(response.message || 'Nie uda≈Ço siƒô przes≈Çaƒá dokumentu.');
        }
    } catch (error) {
        console.error('B≈ÇƒÖd przesy≈Çania dokumentu:', error);
        showErrorToast('WystƒÖpi≈Ç problem podczas przesy≈Çania dokumentu.');
    }
}

/**
 * Validates file upload before sending.
 */
function validateFileUpload(formData) {
    const file = formData.get('document');
    if (!file) {
        showErrorToast('Wybierz dokument do przes≈Çania.');
        return false;
    }

    const allowedTypes = ['application/pdf', 'image/png', 'image/jpeg'];
    if (!allowedTypes.includes(file.type)) {
        showErrorToast('Nieobs≈Çugiwany format pliku. Dozwolone: PDF, PNG, JPG.');
        return false;
    }

    return true;
}

/**
 * Handles file selection and previews before upload.
 */
function handleFileSelection(event) {
    const file = event.target.files[0];
    if (!file) return;

    previewContract(file);
}

/**
 * Previews document before signing.
 */
function previewDocument(documentUrl) {
    const previewFrame = document.getElementById('document-preview');
    if (previewFrame) {
        previewFrame.src = documentUrl;
        previewFrame.style.display = 'block';
    }
}

/**
 * Handles document signing process.
 */
function handleSignButtonClick() {
    const documentId = document.getElementById('document-id').value.trim();
    if (!documentId) {
        showErrorToast('Wybierz dokument do podpisania.');
        return;
    }

    signDocument(documentId);
}

/**
 * Sends request to sign a document.
 */
async function signDocument(documentId) {
    try {
        const response = await fetch('/api/user/documents.php?action=sign', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ documentId })
        }).then(res => res.json());

        if (response.success) {
            showSuccessToast('Dokument zosta≈Ç pomy≈õlnie podpisany.');
        } else {
            showErrorToast(response.message || 'Nie uda≈Ço siƒô podpisaƒá dokumentu.');
        }
    } catch (error) {
        console.error('B≈ÇƒÖd podpisywania dokumentu:', error);
        showErrorToast('WystƒÖpi≈Ç problem podczas podpisywania dokumentu.');
    }
}

/**
 * Previews document for user review before submission.
 */
function previewContract(file) {
    const reader = new FileReader();
    reader.onload = function (event) {
        const previewFrame = document.getElementById('contractPreview');
        if (previewFrame) {
            previewFrame.src = event.target.result;
        }
    };
    reader.readAsDataURL(file);
}
=== public/js/payments.js ===
import ajax from './ajax';
import { showErrorToast, showSuccessToast } from './toasts';

document.addEventListener('DOMContentLoaded', function () {
    const paymentForm = document.getElementById('paymentForm');

    if (paymentForm) {
        paymentForm.addEventListener('submit', function (event) {
            event.preventDefault();
            if (validateForm()) {
                const paymentDetails = new FormData(paymentForm);
                processPayment(paymentDetails);
            }
        });
    }

    initRealTimeValidation();
});

/**
 * Validates payment form before submission
 */
function validateForm() {
    let isValid = true;
    const cardNumber = document.getElementById('cardNumber').value.trim();
    const expiryDate = document.getElementById('expiryDate').value.trim();
    const cvv = document.getElementById('cvv').value.trim();

    if (!isValidCardNumber(cardNumber)) {
        showErrorToast('Nieprawid≈Çowy numer karty. Wprowad≈∫ 16 cyfr.');
        isValid = false;
    }

    if (!isValidExpiryDate(expiryDate)) {
        showErrorToast('Nieprawid≈Çowa data wa≈ºno≈õci. U≈ºyj formatu MM/YY.');
        isValid = false;
    }

    if (!isValidCVV(cvv)) {
        showErrorToast('Nieprawid≈Çowy kod CVV. Wprowad≈∫ 3 cyfry.');
        isValid = false;
    }

    return isValid;
}

/**
 * Sends payment request to the API
 */
async function processPayment(paymentDetails) {
    try {
        const response = await ajax.post('/payments', paymentDetails);
        if (response.success) {
            showSuccessToast('P≈Çatno≈õƒá zako≈Ñczona sukcesem! Przekierowywanie...');
            setTimeout(() => window.location.href = '/booking/confirmation', 1500);
        } else {
            displayErrors(response.errors);
        }
    } catch (error) {
        showErrorToast('WystƒÖpi≈Ç b≈ÇƒÖd podczas przetwarzania p≈Çatno≈õci.');
    }
}

/**
 * Displays error messages
 */
function displayErrors(errors) {
    errors.forEach(error => showErrorToast(error));
}

/**
 * Validates card number format
 */
function isValidCardNumber(cardNumber) {
    return /^\d{16}$/.test(cardNumber);
}

/**
 * Validates expiry date format (MM/YY)
 */
function isValidExpiryDate(expiryDate) {
    return /^(0[1-9]|1[0-2])\/\d{2}$/.test(expiryDate);
}

/**
 * Validates CVV format (3 digits)
 */
function isValidCVV(cvv) {
    return /^\d{3}$/.test(cvv);
}

/**
 * Initializes real-time validation for payment fields
 */
function initRealTimeValidation() {
    document.getElementById('cardNumber')?.addEventListener('input', function () {
        if (!isValidCardNumber(this.value)) {
            showErrorToast('Numer karty powinien zawieraƒá 16 cyfr.');
        }
    });

    document.getElementById('expiryDate')?.addEventListener('input', function () {
        if (!isValidExpiryDate(this.value)) {
            showErrorToast('Nieprawid≈Çowy format daty wa≈ºno≈õci (MM/YY).');
        }
    });

    document.getElementById('cvv')?.addEventListener('input', function () {
        if (!isValidCVV(this.value)) {
            showErrorToast('Kod CVV powinien zawieraƒá 3 cyfry.');
        }
    });
}
=== public/js/user.js ===
document.addEventListener("DOMContentLoaded", function () {
    // Fetch and manage user dashboard data
    function loadUserDashboard() {
        fetch("/api/user/dashboard.php")
            .then(response => response.json())
            .then(data => {
                document.getElementById("totalBookings").textContent = data.totalBookings || 0;
                document.getElementById("totalPayments").textContent = data.totalPayments + " PLN" || "0 PLN";
                document.getElementById("totalDocuments").textContent = data.totalDocuments || 0;
            })
            .catch(error => console.error("B≈ÇƒÖd ≈Çadowania dashboardu:", error));
    }

    // Fetch and manage bookings
    function fetchBookings() {
        fetch("/api/user/bookings.php")
            .then(response => response.json())
            .then(data => {
                const bookingTable = document.getElementById("bookingList");
                bookingTable.innerHTML = "";

                if (data.length === 0) {
                    bookingTable.innerHTML = `<tr><td colspan="6" class="text-center text-muted">Brak rezerwacji.</td></tr>`;
                } else {
                    data.forEach(booking => {
                        bookingTable.innerHTML += `
                            <tr>
                                <td>${booking.id}</td>
                                <td>${booking.vehicle}</td>
                                <td>${booking.start_date}</td>
                                <td>${booking.end_date}</td>
                                <td>${booking.status}</td>
                                <td><button class="btn btn-sm btn-info" onclick="viewBooking(${booking.id})">PodglƒÖd</button></td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd ≈Çadowania rezerwacji:", error));
    }

    loadUserDashboard();
    fetchBookings();
});
=== public/js/shared.js ===
document.addEventListener("DOMContentLoaded", function () {
    // Initialize Charts
    function loadCharts() {
        fetch("/api/shared/charts.php")
            .then(response => response.json())
            .then(data => {
                let ctx = document.getElementById("bookingTrends").getContext("2d");
                new Chart(ctx, {
                    type: "line",
                    data: data.bookingTrends,
                });

                ctx = document.getElementById("revenueTrends").getContext("2d");
                new Chart(ctx, {
                    type: "bar",
                    data: data.revenueTrends,
                });
            })
            .catch(error => console.error("B≈ÇƒÖd ≈Çadowania wykres√≥w:", error));
    }

    // Initialize Modals
    function showModal(modalId) {
        $("#" + modalId).modal("show");
    }

    loadCharts();
});
=== public/js/admin.js ===
document.addEventListener("DOMContentLoaded", function () {
    // Fetch and manage admin dashboard data
    function loadAdminDashboard() {
        fetch("/api/admin/dashboard.php")
            .then(response => response.json())
            .then(data => {
                document.getElementById("totalUsers").textContent = data.totalUsers || 0;
                document.getElementById("totalRevenue").textContent = `$${data.totalRevenue || "0.00"}`;
                document.getElementById("totalBookings").textContent = data.totalBookings || 0;
            })
            .catch(error => console.error("B≈ÇƒÖd ≈Çadowania dashboardu:", error));
    }

    // Fetch and manage users
    function fetchUsers() {
        fetch("/api/admin/users.php")
            .then(response => response.json())
            .then(data => {
                const userTable = document.getElementById("userList");
                userTable.innerHTML = "";

                if (data.length === 0) {
                    userTable.innerHTML = `<tr><td colspan="5" class="text-center text-muted">Brak u≈ºytkownik√≥w.</td></tr>`;
                } else {
                    data.forEach(user => {
                        userTable.innerHTML += `
                            <tr>
                                <td>${user.id}</td>
                                <td>${user.name}</td>
                                <td>${user.role}</td>
                                <td>
                                    <button class="btn btn-sm btn-warning" onclick="changeUserRole(${user.id})">Zmie≈Ñ rolƒô</button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteUser(${user.id})">Usu≈Ñ</button>
                                </td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd ≈Çadowania u≈ºytkownik√≥w:", error));
    }

    function deleteUser(userId) {
        if (confirm("Czy na pewno chcesz usunƒÖƒá u≈ºytkownika?")) {
            fetch(`/api/admin/delete_user.php?id=${userId}`, { method: "DELETE" })
                .then(response => response.json())
                .then(() => {
                    alert("U≈ºytkownik usuniƒôty.");
                    fetchUsers();
                })
                .catch(error => console.error("B≈ÇƒÖd usuwania u≈ºytkownika:", error));
        }
    }

    // Fetch and manage reports
    function fetchReports() {
        fetch("/api/admin/reports.php")
            .then(response => response.json())
            .then(data => {
                const reportTable = document.getElementById("reportList");
                reportTable.innerHTML = "";

                if (data.length === 0) {
                    reportTable.innerHTML = `<tr><td colspan="4" class="text-center text-muted">Brak raport√≥w.</td></tr>`;
                } else {
                    data.forEach(report => {
                        reportTable.innerHTML += `
                            <tr>
                                <td>${report.id}</td>
                                <td>${report.type}</td>
                                <td>${report.date}</td>
                                <td>
                                    <button class="btn btn-sm btn-info" onclick="viewReport(${report.id})">PodglƒÖd</button>
                                </td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd ≈Çadowania raport√≥w:", error));
    }

    loadAdminDashboard();
    fetchUsers();
    fetchReports();
});
=== public/js/bookings.js ===
import ajax from './ajax';
import { showErrorToast, showSuccessToast } from './toasts';

document.addEventListener('DOMContentLoaded', function () {
    const pickupDateInput = document.getElementById('pickup-date');
    const bookingForm = document.getElementById('booking-form');
    const vehiclesContainer = document.getElementById('vehicles-container');
    const errorContainer = document.getElementById('error-container');
    const loadingIndicator = document.getElementById('loading-indicator');

    if (pickupDateInput) pickupDateInput.addEventListener('change', fetchAvailableVehicles);
    if (bookingForm) bookingForm.addEventListener('submit', submitBookingRequest);

    initRealTimeValidation();
});

/**
 * Fetches available vehicles based on the selected pickup date.
 */
async function fetchAvailableVehicles() {
    const pickupDate = document.getElementById('pickup-date').value.trim();
    if (!pickupDate) return;

    showLoadingIndicator();

    try {
        const response = await fetch(`/api/user/bookings.php?pickup_date=${pickupDate}`);
        const data = await response.json();
        hideLoadingIndicator();

        if (data.vehicles && data.vehicles.length > 0) {
            displayAvailableVehicles(data.vehicles);
        } else {
            showErrorToast('Brak dostƒôpnych pojazd√≥w na wybrany termin.');
            clearVehicles();
            fetchAlternativeDates(pickupDate);
        }
    } catch (error) {
        hideLoadingIndicator();
        console.error('B≈ÇƒÖd pobierania dostƒôpnych pojazd√≥w:', error);
        showErrorToast('Nie uda≈Ço siƒô pobraƒá dostƒôpnych pojazd√≥w.');
    }
}

/**
 * Displays the available vehicles in the UI.
 */
function displayAvailableVehicles(vehicles) {
    vehiclesContainer.innerHTML = '';

    vehicles.forEach(vehicle => {
        const vehicleElement = document.createElement('div');
        vehicleElement.className = 'vehicle';
        vehicleElement.innerHTML = `
            <h4>${vehicle.name}</h4>
            <p>Typ: ${vehicle.type}</p>
        `;
        vehiclesContainer.appendChild(vehicleElement);
    });
}

/**
 * Clears the vehicle list.
 */
function clearVehicles() {
    vehiclesContainer.innerHTML = '<p class="text-muted">Brak dostƒôpnych pojazd√≥w.</p>';
}

/**
 * Fetches alternative dates with available vehicles
 */
async function fetchAlternativeDates(pickupDate) {
    try {
        const response = await fetch(`/api/user/bookings.php?alternative_dates=true&pickup_date=${pickupDate}`);
        const data = await response.json();
        if (data.alternativeDates && data.alternativeDates.length > 0) {
            displayAlternativeDates(data.alternativeDates, pickupDate);
        } else {
            showErrorToast('Brak alternatywnych termin√≥w.');
        }
    } catch (error) {
        console.error('B≈ÇƒÖd pobierania alternatywnych termin√≥w:', error);
        showErrorToast('Nie uda≈Ço siƒô pobraƒá alternatywnych termin√≥w.');
    }
}

/**
 * Displays alternative dates in the UI
 */
function displayAlternativeDates(alternativeDates, originalDate) {
    vehiclesContainer.innerHTML = '<p class="text-muted">Brak dostƒôpnych pojazd√≥w.</p>';

    const alternativesContainer = document.createElement('div');
    alternativesContainer.className = 'alternatives';

    const title = document.createElement('h5');
    title.innerText = 'Dostƒôpne alternatywne terminy:';
    alternativesContainer.appendChild(title);

    alternativeDates.forEach(date => {
        const dateElement = document.createElement('button');
        dateElement.className = 'alternative-date';
        dateElement.innerText = date;
        dateElement.addEventListener('click', () => {
            document.getElementById('pickup-date').value = date;
            fetchAvailableVehicles();
        });
        alternativesContainer.appendChild(dateElement);
    });

    const notifyButton = document.createElement('button');
    notifyButton.className = 'notify-button';
    notifyButton.innerText = 'Powiadom mnie, gdy pojazdy bƒôdƒÖ dostƒôpne';
    notifyButton.addEventListener('click', () => setNotificationAlert(originalDate));
    alternativesContainer.appendChild(notifyButton);

    vehiclesContainer.appendChild(alternativesContainer);
}

/**
 * Sets a notification alert for the user
 */
async function setNotificationAlert(pickupDate) {
    try {
        const response = await fetch('/api/user/bookings.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ pickup_date: pickupDate })
        });
        const data = await response.json();
        if (data.success) {
            showSuccessToast('Powiadomienie zosta≈Ço ustawione.');
        } else {
            showErrorToast(data.error || 'Nie uda≈Ço siƒô ustawiƒá powiadomienia.');
        }
    } catch (error) {
        console.error('B≈ÇƒÖd ustawiania powiadomienia:', error);
        showErrorToast('Nie uda≈Ço siƒô ustawiƒá powiadomienia.');
    }
}

/**
 * Handles the booking form submission.
 */
async function submitBookingRequest(event) {
    event.preventDefault();
    clearErrors();

    if (!validateBookingForm()) return;

    const formData = new FormData(event.target);
    showLoadingIndicator();

    try {
        const response = await fetch('/api/user/bookings.php', {
            method: 'POST',
            body: formData
        });
        const data = await response.json();
        hideLoadingIndicator();

        if (data.success) {
            showSuccessToast('Rezerwacja zako≈Ñczona sukcesem!');
            setTimeout(() => window.location.href = "/bookings/view", 1500);
        } else {
            showErrorToast(data.error || 'WystƒÖpi≈Ç problem podczas tworzenia rezerwacji.');
        }
    } catch (error) {
        hideLoadingIndicator();
        console.error('B≈ÇƒÖd tworzenia rezerwacji:', error);
        showErrorToast('Nie uda≈Ço siƒô utworzyƒá rezerwacji.');
    }
}

/**
 * Initializes real-time validation for booking form fields.
 */
function initRealTimeValidation() {
    const requiredFields = ['pickup-date', 'return-date', 'pickup-location', 'dropoff-location'];

    requiredFields.forEach(field => {
        const input = document.getElementById(field);
        if (input) {
            input.addEventListener('input', () => validateField(input));
        }
    });
}

/**
 * Validates a single form field.
 */
function validateField(input) {
    if (!input.value.trim()) {
        showError(input.dataset.errorMessage || 'To pole jest wymagane.');
    } else {
        clearError();
    }
}

/**
 * Validates the entire booking form before submission.
 */
function validateBookingForm() {
    let isValid = true;
    const requiredFields = ['pickup-date', 'return-date', 'pickup-location', 'dropoff-location'];

    requiredFields.forEach(field => {
        const input = document.getElementById(field);
        if (!input || !input.value.trim()) {
            showError(`Pole ${field.replace('-', ' ')} jest wymagane.`);
            isValid = false;
        }
    });

    return isValid;
}

/**
 * Shows a loading indicator.
 */
function showLoadingIndicator() {
    if (loadingIndicator) {
        loadingIndicator.style.display = 'block';
    }
}

/**
 * Hides the loading indicator.
 */
function hideLoadingIndicator() {
    if (loadingIndicator) {
        loadingIndicator.style.display = 'none';
    }
}

/**
 * Displays an error message.
 */
function showError(message) {
    if (errorContainer) {
        errorContainer.innerText = message;
        errorContainer.style.display = 'block';
    }
}

/**
 * Clears all error messages.
 */
function clearErrors() {
    if (errorContainer) {
        errorContainer.innerText = '';
        errorContainer.style.display = 'none';
    }
}
=== public/api.php ===
<?php

require_once __DIR__ . '/../vendor/autoload.php';

use Firebase\JWT\JWT;
use Firebase\JWT\Key;



// Load encryption keys
$config = require __DIR__ . '/../config/encryption.php';
$jwtSecret = $config['jwt_secret'] ?? '';

function validateToken()
{
    global $jwtSecret;

    $headers = getallheaders();
    $authHeader = $headers['Authorization'] ?? '';

    if (!$authHeader || !str_starts_with($authHeader, 'Bearer ')) {
        http_response_code(401);
        echo json_encode(["error" => "Unauthorized: Missing or invalid token"]);
        exit;
    }

    $token = substr($authHeader, 7);
    try {
        return (array) JWT::decode($token, new Key($jwtSecret, 'HS256'));
    } catch (Exception $e) {
        http_response_code(401);
        echo json_encode(["error" => "Unauthorized: Invalid token"]);
        exit;
    }
}
