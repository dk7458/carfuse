=== public/profile.php ===
=== public/.htaccess ===
RewriteEngine On

# ‚úÖ Ensure all requests go through index.php (EXCEPT static files and APIs)
RewriteCond %{REQUEST_URI} !^/(css|js|images|api)/.*$
RewriteRule ^ index.php [QSA,L]

# ‚úÖ Allow direct access to API files
RewriteCond %{REQUEST_URI} ^/api/.*\.php$
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# üîí Protect sensitive backend files (Prevent direct access to config & helper files)
RewriteRule ^(App/|config/|helpers/|private/).* - [F,L]

# ‚úÖ Allow direct access to static files
RewriteCond %{REQUEST_URI} ^/(css|js|images)/(.*)$
RewriteCond %{DOCUMENT_ROOT}/public/%1/%2 -f
RewriteRule ^(css|js|images)/(.*)$ /public/$1/$2 [L]
=== public/dashboard.php ===
<?php
session_start();
if (!isset($_SESSION["user_id"])) {
    header("Location: /login");
    exit();
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/css/shared.css">
</head>
<body>
    <h1>Dashboard</h1>
    <p>Welcome, <?= htmlspecialchars($_SESSION["username"] ?? "User") ?>!</p>

    <p><a href="/profile">View Profile</a></p>
    <p><a href="/logout.php">Logout</a></p>
</body>
</html>
=== public/config/routes.php ===
<?php

use FastRoute\RouteCollector;
use function FastRoute\simpleDispatcher;
use App\Controllers\AuthController;
use App\Controllers\PaymentController;
use App\Controllers\DashboardController;
use App\Controllers\BookingController;
use App\Controllers\NotificationController;
use App\Controllers\NotificationQueueController;
use App\Controllers\AdminDashboardController;
use App\Controllers\ReportController;
use AuditManager\Controllers\AuditController;
use DocumentManager\Controllers\DocumentController;
use DocumentManager\Controllers\SignatureController;
use App\Controllers\UserController;

return simpleDispatcher(function (RouteCollector $router) {
    // Middleware-like Authentication Handling
    if (!function_exists('requireAuth')) {
        function requireAuth() {
            require_once BASE_PATH . '/App/Helpers/SecurityHelper.php';
            if (!isUserLoggedIn()) {
                http_response_code(403);
                echo json_encode(["error" => "Unauthorized"]);
                exit();
            }
        }
    }

    // Home Page: now use a dedicated view to avoid recursion
    $router->get('/', function () {
        file_put_contents(__DIR__ . "/../debug.log", "Home Route Hit\n", FILE_APPEND);
        require BASE_PATH . "/public/views/home.php"; // use a dedicated home view file
    });
    

    // Authentication Routes (Static First)
    $router->get('/login', [AuthController::class, 'loginView']);
    $router->get('/register', [AuthController::class, 'registerView']);
    $router->post('/register', [UserController::class, 'register']);
    $router->post('/login', [UserController::class, 'login']);
    $router->post('/profile/update', [UserController::class, 'updateProfile']);
    $router->post('/password/reset/request', [UserController::class, 'requestPasswordReset']);
    $router->post('/password/reset', [UserController::class, 'resetPassword']);

    // Dashboard & Profile (Static First)
    $router->get('/dashboard', [DashboardController::class, 'userDashboard']);
    $router->get('/profile', function () { require BASE_PATH . "/public/views/user/profile.php"; });

    // Payments (Static First)
    $router->get('/payments/history', [PaymentController::class, 'viewPaymentHistory']);
    $router->get('/payments/installments', [PaymentController::class, 'viewInstallments']);
    $router->post('/payments/process', [PaymentController::class, 'processPayment']);
    $router->post('/payments/refund', [PaymentController::class, 'refundPayment']);

    // Bookings (Static First)
    $router->get('/bookings', [DashboardController::class, 'getUserBookings']);
    $router->get('/bookings/{id}', [BookingController::class, 'viewBooking']);
    $router->post('/bookings/{id}/reschedule', [BookingController::class, 'rescheduleBooking']);
    $router->post('/bookings/{id}/cancel', [BookingController::class, 'cancelBooking']);

    // Notifications API Routes
    $router->get('/notifications', [NotificationController::class, 'getUserNotifications']);
    $router->post('/notifications/mark-as-read', [NotificationController::class, 'markNotificationAsRead']);
    $router->post('/notifications/delete', [NotificationController::class, 'deleteNotification']);
    $router->post('/notifications/send', [NotificationController::class, 'sendNotification']);
    $router->post('/notifications/process-queue', [NotificationQueueController::class, 'processQueue']);

    // Dynamic API Routing (Auth Required)
    $router->get('/api/{endpoint}', function ($vars) {
        requireAuth();
        $endpoint = $vars['endpoint'];
        $apiPath = BASE_PATH . "/public/api/$endpoint.php";

        if (file_exists($apiPath)) {
            require $apiPath;
        } else {
            http_response_code(404);
            echo json_encode(["error" => "API endpoint not found"]);
        }
    });

    // Admin Routes (Static First)
    $router->get('/admin/dashboard', [AdminDashboardController::class, 'index']);
    $router->get('/admin/reports', [ReportController::class, 'index']);
    $router->post('/admin/reports/generate', [ReportController::class, 'generateReport']);
    $router->post('/user/reports/generate', [ReportController::class, 'generateUserReport']);

    // Audit Logs
    $router->post('/admin/audit-logs/fetch', [AuditController::class, 'fetchLogs']);

    // Document Manager Routes
    $router->post('/documents/upload-template', [DocumentController::class, 'uploadTemplate']);
    $router->post('/documents/generate-contract/{bookingId}/{userId}', [DocumentController::class, 'generateContract']);
    $router->post('/documents/upload-terms', [DocumentController::class, 'uploadTerms']);
    $router->post('/documents/generate-invoice/{bookingId}', [DocumentController::class, 'generateInvoice']);
    $router->delete('/documents/{documentId}', [DocumentController::class, 'deleteDocument']);

    // Dynamic View Routing (Must be Last)
    $router->get('/{view}', function ($vars) {
        $allowedViews = ['dashboard', 'bookings', 'payments', 'documents', 'notifications', 'profile', 'settings'];
        $view = $vars['view'];

        if (in_array($view, $allowedViews)) {
            require BASE_PATH . "/public/views/user/$view.php";
        } else {
            http_response_code(404);
            require BASE_PATH . "/public/views/errors/404.php";
        }
    });
});
=== public/api/views/profile.php ===
<?php
require_once __DIR__ . '/../../../App/Helpers/SecurityHelper.php';

// Log the receipt of the request
file_put_contents(__DIR__ . '/../../../logs/debug.log', date('Y-m-d H:i:s') . " - Received API /views/profile request\n", FILE_APPEND);

// Set header for valid JSON
header("Content-Type: application/json");

// Check if user is logged in
if (!isUserLoggedIn()) {
    http_response_code(403);
    echo json_encode(["error" => "Unauthorized"]);
    file_put_contents(__DIR__ . '/../../../logs/debug.log', date('Y-m-d H:i:s') . " - Unauthorized access to /views/profile\n", FILE_APPEND);
    exit();
}

// Explicit success status
http_response_code(200);

// Load user profile details dynamically
$userProfile = [
    "name" => "John Doe",
    "email" => "john.doe@example.com",
    "accountStatus" => "Active"
    // ...additional profile details...
];

// Return JSON response with user profile details
echo json_encode($userProfile);

// Log completion of API handling
file_put_contents(__DIR__ . '/../../../logs/debug.log', date('Y-m-d H:i:s') . " - /views/profile API processed successfully\n", FILE_APPEND);
?>
=== public/api/views/dashboard.php ===
=== public/api/views/vehicles.php ===
<?php
// Log the receipt of the request
file_put_contents(__DIR__ . '/../../../logs/debug.log', date('Y-m-d H:i:s') . " - Received API /views/vehicles request\n", FILE_APPEND);

// Set header for valid JSON
header("Content-Type: application/json");

// Explicit success status
http_response_code(200);

// Load available vehicles dynamically
$vehicles = [
    ["id" => 1, "name" => "2019 Toyota Camry", "price_per_day" => 50, "availability" => true],
    ["id" => 2, "name" => "2018 Honda Accord", "price_per_day" => 45, "availability" => true],
    ["id" => 3, "name" => "2020 Ford Mustang", "price_per_day" => 70, "availability" => false],
    // ...additional vehicles...
];

// Return JSON response with available vehicles
echo json_encode($vehicles);

// Log completion of API handling
file_put_contents(__DIR__ . '/../../../logs/debug.log', date('Y-m-d H:i:s') . " - /views/vehicles API processed successfully\n", FILE_APPEND);
?>
=== public/api/views/home.php ===
=== public/api/views/reports.php ===
<?php
require_once __DIR__ . '/../../../App/Helpers/SecurityHelper.php';

// Log the receipt of the request
file_put_contents(__DIR__ . '/../../../logs/debug.log', date('Y-m-d H:i:s') . " - Received API /views/reports request\n", FILE_APPEND);

// Set header for valid JSON
header("Content-Type: application/json");

// Check if admin is logged in
if (!isAdminLoggedIn()) {
    http_response_code(403);
    echo json_encode(["error" => "Unauthorized"]);
    file_put_contents(__DIR__ . '/../../../logs/debug.log', date('Y-m-d H:i:s') . " - Unauthorized access to /views/reports\n", FILE_APPEND);
    exit();
}

// Explicit success status
http_response_code(200);

// Load reports data dynamically
$revenueData = [
    "totalRevenue" => 50000,
    "monthlyRevenue" => 5000,
    // ...additional revenue data...
];
$recentTransactions = [
    ["id" => 201, "user" => "John Doe", "amount" => 24000, "date" => "2023-10-01"],
    ["id" => 202, "user" => "Jane Smith", "amount" => 22000, "date" => "2023-10-02"],
    // ...additional transactions...
];
$systemActivity = [
    ["id" => 1, "activity" => "User login", "timestamp" => "2023-10-01 12:00:00"],
    ["id" => 2, "activity" => "Booking created", "timestamp" => "2023-10-01 12:05:00"],
    // ...additional activities...
];

// Prepare response data
$responseData = [
    "revenueData" => $revenueData,
    "recentTransactions" => $recentTransactions,
    "systemActivity" => $systemActivity
];

// Return JSON response with reports data
echo json_encode($responseData);

// Log completion of API handling
file_put_contents(__DIR__ . '/../../../logs/debug.log', date('Y-m-d H:i:s') . " - /views/reports API processed successfully\n", FILE_APPEND);
?>
=== public/api/test.php ===
<?php
// Log the receipt of the request
file_put_contents('debug.log', date('Y-m-d H:i:s') . " - Received API /test request\n", FILE_APPEND);

// Optional authentication check flag
$requiresAuth = false;

// Define authentication function
function requireAuthTest() {
	// Check for 'Authorization' header (adjust condition per requirements)
	if (!isset($_SERVER['HTTP_AUTHORIZATION'])) {
		file_put_contents('debug.log', date('Y-m-d H:i:s') . " - Authentication failed\n", FILE_APPEND);
		http_response_code(401);
		header("Content-Type: application/json");
		echo json_encode(["error" => "Unauthorized"]);
		exit();
	}
	file_put_contents('debug.log', date('Y-m-d H:i:s') . " - Authentication succeeded\n", FILE_APPEND);
}

// Perform authentication if required
if ($requiresAuth) {
	requireAuthTest();
}

// Set header always for valid JSON
header("Content-Type: application/json");

// Explicit success status
http_response_code(200);

// ...existing code...
echo json_encode(["status" => "API working"]);
// ...existing code...

// Log completion of API handling
file_put_contents('debug.log', date('Y-m-d H:i:s') . " - /test API processed successfully\n", FILE_APPEND);
?>
=== public/css/shared.css ===
body {
    font-family: Arial, sans-serif;
    margin: 20px;
    text-align: center;
}

h1 {
    color: #333;
}

nav {
    margin-bottom: 20px;
}

a {
    text-decoration: none;
    color: #007bff;
}

a:hover {
    text-decoration: underline;
}

form {
    max-width: 300px;
    margin: auto;
    display: flex;
    flex-direction: column;
}

input {
    margin-bottom: 10px;
    padding: 8px;
    font-size: 16px;
}

button {
    padding: 10px;
    font-size: 16px;
    cursor: pointer;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
}

button:hover {
    background: #0056b3;
}
=== public/index.php ===
<?php
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);

require_once __DIR__ . '/../vendor/autoload.php';
require_once __DIR__ . '/../config/routes.php';
require_once __DIR__ . '/../App/Helpers/SecurityHelper.php';

startSecureSession();
// Debugging: List available views
$viewsDirectory = __DIR__ . "/views/";
$availableViews = scandir($viewsDirectory);
echo "<pre>Available Views:\n" . print_r($availableViews, true) . "</pre>";

// Get the requested URL path
$requestUri = parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH);

// ‚úÖ Prevent API requests from being misrouted
if (strpos($requestUri, '/api/') === 0) {
    http_response_code(404);
    echo json_encode(["error" => "Invalid API request"]);
    exit;
}

// ‚úÖ Serve home page for `/`
if ($requestUri === '/' || $requestUri === '/index.php') {
    require __DIR__ . '/views/home.php';
    exit;
}

// ‚úÖ Serve other views dynamically
$viewPath = __DIR__ . "/views$requestUri.php";
if (file_exists($viewPath)) {
    require $viewPath;
    exit;
} else {
    echo "View not found: " . htmlspecialchars($viewPath); // Debugging output
}

// üöÄ If no matching view, show 404 page
http_response_code(404);
echo "404 Not Found";
?>
=== public/views/auth/register.php ===
<?php
/*
|--------------------------------------------------------------------------
| Rejestracja U≈ºytkownika
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi za≈Ço≈ºenie konta.
|
| ≈öcie≈ºka: App/Views/auth/register.php
|
| Zale≈ºy od:
| - JavaScript: /js/auth.js (obs≈Çuga AJAX, dynamiczna walidacja)
| - CSS: /css/auth.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego przetwarzania rejestracji)
| - HTML, CSS (interfejs)
*/

require_once BASE_PATH . '/App/Helpers/SecurityHelper.php';

if (session_status() === PHP_SESSION_NONE) {
    require_once __DIR__ . '/../../../helpers/SecurityHelper.php';
}

if (isset($_SESSION['user_id'])) {
    header("Location: /dashboard");
    exit;
}
?>

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rejestracja</title>
    
    <!-- ‚úÖ Bootstrap & Custom Styles -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/public/css/auth.css">
</head>
<body class="d-flex justify-content-center align-items-center vh-100 bg-light">

<div class="auth-container bg-white p-4 rounded shadow-lg">
    <h1 class="text-center mb-4">Zarejestruj siƒô</h1>

    <form id="registerForm">
        <?= csrf_field(); ?>
        <div class="mb-3">
            <label for="name" class="form-label">Imiƒô i nazwisko</label>
            <input type="text" class="form-control" id="name" name="name" required>
        </div>
        <div class="mb-3">
            <label for="email" class="form-label">Adres e-mail</label>
            <input type="email" class="form-control" id="email" name="email" required>
        </div>
        <div class="mb-3">
            <label for="password" class="form-label">Has≈Ço</label>
            <input type="password" class="form-control" id="password" name="password" required>
        </div>
        <div class="mb-3">
            <label for="confirm_password" class="form-label">Potwierd≈∫ has≈Ço</label>
            <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Zarejestruj siƒô</button>
    </form>

    <div id="responseMessage" class="alert mt-3 d-none"></div>
    <p class="text-center mt-3"><a href="/auth/login.php">Masz ju≈º konto? Zaloguj siƒô</a></p>
</div>

<!-- ‚úÖ Bootstrap & Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/auth.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const registerForm = document.getElementById("registerForm");

    registerForm.addEventListener("submit", function(e) {
        e.preventDefault();
        
        const formData = new FormData(registerForm);
        formData.append("csrf_token", document.querySelector('input[name="csrf_token"]').value); // Ensure CSRF token is included
        
        registerUser(formData);
    });

    function registerUser(formData) {
        fetch("/api/auth/register.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            const responseMessage = document.getElementById("responseMessage");
            responseMessage.classList.remove("d-none");
            responseMessage.style.display = "block";

            if (data.success) {
                responseMessage.className = "alert alert-success";
                responseMessage.textContent = "‚úÖ Rejestracja udana! Przekierowywanie...";
                setTimeout(() => window.location.href = "/auth/login.php", 2000);
            } else {
                responseMessage.className = "alert alert-danger";
                responseMessage.textContent = "‚ùå B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            console.error("B≈ÇƒÖd rejestracji:", error);
        });
    }
});
</script>

</body>
</html>
=== public/views/auth/password_reset.php ===
<?php
/*
|--------------------------------------------------------------------------
| Resetowanie Has≈Ça
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi ustawienie nowego has≈Ça po klikniƒôciu w link
| resetujƒÖcy, kt√≥ry zosta≈Ç wys≈Çany na jego e-mail.
|
| ≈öcie≈ºka: App/Views/auth/password_reset.php
|
| Zale≈ºy od:
| - JavaScript: /js/auth.js (obs≈Çuga AJAX, dynamiczne przetwarzanie resetu)
| - CSS: /css/auth.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznej zmiany has≈Ça)
| - HTML, CSS (interfejs)
*/

require_once BASE_PATH . '/App/Helpers/SecurityHelper.php';

if (session_status() === PHP_SESSION_NONE) {
    require_once __DIR__ . '/../../../helpers/SecurityHelper.php';
}

if (isset($_SESSION['user_id'])) {
    header("Location: /dashboard");
    exit;
}

// Pobranie tokenu resetujƒÖcego z URL
$token = $_GET['token'] ?? null;
if (!$token) {
    die("‚ùå Nieprawid≈Çowy link resetujƒÖcy.");
}
?>

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ustaw nowe has≈Ço</title>
    
    <!-- ‚úÖ Bootstrap & Custom Styles -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/public/css/auth.css">
</head>
<body class="d-flex justify-content-center align-items-center vh-100 bg-light">

<div class="auth-container bg-white p-4 rounded shadow-lg">
    <h1 class="text-center mb-4">Ustaw nowe has≈Ço</h1>

    <form id="passwordResetForm">
        <?= csrf_field(); ?>
        <input type="hidden" name="token" value="<?= htmlspecialchars($token) ?>">

        <div class="mb-3">
            <label for="new_password" class="form-label">Nowe has≈Ço</label>
            <input type="password" class="form-control" id="new_password" name="new_password" required>
        </div>
        <div class="mb-3">
            <label for="confirm_password" class="form-label">Potwierd≈∫ nowe has≈Ço</label>
            <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Zmie≈Ñ has≈Ço</button>
    </form>

    <div id="responseMessage" class="alert mt-3 d-none"></div>
</div>

<!-- ‚úÖ Bootstrap & Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/auth.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const passwordResetForm = document.getElementById("passwordResetForm");

    passwordResetForm.addEventListener("submit", function(e) {
        e.preventDefault();
        resetPassword(new FormData(passwordResetForm));
    });

    function resetPassword(formData) {
        fetch("/api/auth/password_reset.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            const responseMessage = document.getElementById("responseMessage");
            responseMessage.classList.remove("d-none");
            responseMessage.style.display = "block";

            if (data.success) {
                responseMessage.className = "alert alert-success";
                responseMessage.textContent = "‚úÖ Has≈Ço zosta≈Ço zmienione! Mo≈ºesz siƒô teraz zalogowaƒá.";
                setTimeout(() => window.location.href = "/auth/login.php", 2000);
            } else {
                responseMessage.className = "alert alert-danger";
                responseMessage.textContent = "‚ùå B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            console.error("B≈ÇƒÖd zmiany has≈Ça:", error);
        });
    }
});
</script>

</body>
</html>
=== public/views/auth/login.php ===
<?php
/*
|--------------------------------------------------------------------------
| Logowanie U≈ºytkownika
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi zalogowanie siƒô do systemu.
|
| ≈öcie≈ºka: App/Views/auth/login.php
|
| Zale≈ºy od:
| - JavaScript: /js/auth.js (obs≈Çuga AJAX, dynamiczna walidacja)
| - CSS: /css/auth.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego logowania)
| - HTML, CSS (interfejs)
*/
header("Content-Type: text/html; charset=UTF-8");

require_once BASE_PATH . '/App/Helpers/SecurityHelper.php'; // Ensure CSRF functions are loaded
include __DIR__ . '/../layouts/header.php';

if (session_status() === PHP_SESSION_NONE) {
    require_once __DIR__ . '/../../../helpers/SecurityHelper.php';
}

if (isset($_SESSION['user_id'])) {
    header("Location: /dashboard");
    exit;
}
?>

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zaloguj siƒô</title>

    <!-- ‚úÖ Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <!-- ‚úÖ Custom Authentication CSS -->
    <link rel="stylesheet" href="/public/css/auth.css">
</head>
<body class="d-flex justify-content-center align-items-center vh-100 bg-light">

<div class="auth-container bg-white p-4 rounded shadow-lg">
    <h1 class="text-center mb-4">Zaloguj siƒô</h1>

    <form id="loginForm">
        <?= csrf_field(); ?>
        <div class="mb-3">
            <label for="email" class="form-label">Adres e-mail</label>
            <input type="email" class="form-control" id="email" name="email" required>
        </div>
        <div class="mb-3">
            <label for="password" class="form-label">Has≈Ço</label>
            <input type="password" class="form-control" id="password" name="password" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Zaloguj siƒô</button>
    </form>
    
    <div id="responseMessage" class="alert mt-3 d-none"></div>
    <p class="text-center mt-3"><a href="/auth/password_reset.php">Nie pamiƒôtasz has≈Ça?</a></p>
</div>

<!-- ‚úÖ Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- ‚úÖ Custom Authentication Script -->
<script src="/js/auth.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const loginForm = document.getElementById("loginForm");

    loginForm.addEventListener("submit", function(e) {
        e.preventDefault();
        
        const formData = new FormData(loginForm);
        formData.append("csrf_token", document.querySelector('input[name="csrf_token"]').value); // Ensure CSRF token is included

        loginUser(formData);
    });

    function loginUser(formData) {
        fetch("/api/auth/login.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            const responseMessage = document.getElementById("responseMessage");
            responseMessage.classList.remove("d-none");
            responseMessage.style.display = "block";

            if (data.success) {
                responseMessage.className = "alert alert-success";
                responseMessage.textContent = "Logowanie pomy≈õlne! Przekierowywanie...";
                setTimeout(() => window.location.href = "/dashboard", 2000);
            } else {
                responseMessage.className = "alert alert-danger";
                responseMessage.textContent = "B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            console.error("B≈ÇƒÖd logowania:", error);
        });
    }
});
</script>

</body>
</html>
<?php include __DIR__ . '/../layouts/footer.php'; ?>
=== public/views/auth/reset_request.php ===
<?php
/*
|--------------------------------------------------------------------------
| ≈ªƒÖdanie Resetu Has≈Ça
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi wys≈Çanie pro≈õby o resetowanie has≈Ça.
| Na podany adres e-mail zostanie wys≈Çany link do resetu.
|
| ≈öcie≈ºka: App/Views/auth/reset_request.php
|
| Zale≈ºy od:
| - JavaScript: /js/auth.js (obs≈Çuga AJAX, dynamiczne wysy≈Çanie resetu)
| - CSS: /css/auth.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego wysy≈Çania zapytania)
| - HTML, CSS (interfejs)
*/

require_once BASE_PATH . '/App/Helpers/SecurityHelper.php';

if (session_status() === PHP_SESSION_NONE) {
    require_once __DIR__ . '/../../../helpers/SecurityHelper.php';
}

if (isset($_SESSION['user_id'])) {
    header("Location: /dashboard");
    exit;
}
?>

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resetowanie Has≈Ça</title>

    <!-- ‚úÖ Bootstrap & Custom Styles -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/public/css/auth.css">
</head>
<body class="d-flex justify-content-center align-items-center vh-100 bg-light">

<div class="auth-container bg-white p-4 rounded shadow-lg">
    <h1 class="text-center mb-4">Resetowanie Has≈Ça</h1>

    <form id="resetRequestForm">
        <?= csrf_field(); ?>
        <div class="mb-3">
            <label for="email" class="form-label">Adres e-mail</label>
            <input type="email" class="form-control" id="email" name="email" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Wy≈õlij link resetujƒÖcy</button>
    </form>

    <div id="responseMessage" class="alert mt-3 d-none"></div>
    <p class="text-center mt-3"><a href="/auth/login.php">Pamiƒôtasz has≈Ço? Zaloguj siƒô</a></p>
</div>

<!-- ‚úÖ Bootstrap & Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/auth.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const resetRequestForm = document.getElementById("resetRequestForm");

    resetRequestForm.addEventListener("submit", function(e) {
        e.preventDefault();

        const formData = new FormData(resetRequestForm);
        formData.append("csrf_token", document.querySelector('input[name="csrf_token"]').value);

        requestPasswordReset(formData);
    });

    function requestPasswordReset(formData) {
        fetch("/api/auth/reset_request.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            const responseMessage = document.getElementById("responseMessage");
            responseMessage.classList.remove("d-none");
            responseMessage.style.display = "block";

            if (data.success) {
                responseMessage.className = "alert alert-success";
                responseMessage.textContent = "‚úÖ Link do resetowania has≈Ça zosta≈Ç wys≈Çany na podany e-mail.";
            } else {
                responseMessage.className = "alert alert-danger";
                responseMessage.textContent = "‚ùå B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            console.error("B≈ÇƒÖd wysy≈Çania resetu:", error);
        });
    }
});
</script>

</body>
</html>
=== public/views/admin/payments/dashboard.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';
if (!isset($_SESSION['admin_id'])) {
    header('Location: login.php');
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Panel ZarzƒÖdzania P≈Çatno≈õciami
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia administratorowi przeglƒÖd wszystkich transakcji, zwrot√≥w
| oraz statystyk finansowych. Obs≈Çuguje dynamiczne filtrowanie i obs≈Çugƒô zwrot√≥w.
|
| ≈öcie≈ºka: App/Views/admin/payments/dashboard.php
|
| Zale≈ºy od:
| - JavaScript: /js/admin.js (obs≈Çuga AJAX, filtrowanie)
| - CSS: /css/admin.css (stylizacja interfejsu)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane transakcji, zwroty)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do pobierania danych)
| - Chart.js (wizualizacja p≈Çatno≈õci)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Panel P≈Çatno≈õci</h1>

<div class="admin-container">
    <div class="row">
        <!-- Statystyki p≈Çatno≈õci -->
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>≈ÅƒÖczna liczba transakcji</h4>
                    <p id="totalTransactions" class="display-6">0</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>≈ÅƒÖczna kwota przychodu</h4>
                    <p id="totalRevenue" class="display-6">0 PLN</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>≈ÅƒÖczna liczba zwrot√≥w</h4>
                    <p id="totalRefunds" class="display-6">0</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Filtry transakcji -->
    <form id="paymentFilterForm" class="row mt-4">
        <?= csrf_field() ?>
        <div class="col-md-3">
            <select class="form-control" name="status">
                <option value="">Wybierz status</option>
                <option value="completed">Zako≈Ñczona</option>
                <option value="pending">OczekujƒÖca</option>
                <option value="failed">Nieudana</option>
            </select>
        </div>
        <div class="col-md-3">
            <select class="form-control" name="method">
                <option value="">Metoda p≈Çatno≈õci</option>
                <option value="card">Karta kredytowa</option>
                <option value="paypal">PayPal</option>
                <option value="transfer">Przelew bankowy</option>
            </select>
        </div>
        <div class="col-md-3">
            <input type="date" class="form-control" name="start_date" placeholder="Data poczƒÖtkowa">
        </div>
        <div class="col-md-3 text-end">
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </div>
    </form>

    <!-- Tabela transakcji -->
    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>U≈ºytkownik</th>
                <th>Kwota</th>
                <th>Metoda</th>
                <th>Status</th>
                <th>Data</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody id="transactionList">
            <!-- Dane bƒôdƒÖ ≈Çadowane dynamicznie -->
        </tbody>
    </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterForm = document.getElementById("paymentFilterForm");

    filterForm.addEventListener("submit", function(e) {
        e.preventDefault();
        fetchTransactions(new FormData(filterForm));
    });

    function fetchTransactions(formData = null) {
        let url = "/api/admin/payments.php";
        if (formData) {
            url += "?" + new URLSearchParams(formData).toString();
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const transactionTable = document.getElementById("transactionList");
                transactionTable.innerHTML = "";

                if (data.length === 0) {
                    transactionTable.innerHTML = `<tr><td colspan="7" class="text-center text-muted">Brak transakcji spe≈ÇniajƒÖcych kryteria.</td></tr>`;
                } else {
                    data.forEach(transaction => {
                        transactionTable.innerHTML += `
                            <tr>
                                <td>${transaction.id}</td>
                                <td>${transaction.user}</td>
                                <td>${transaction.amount} PLN</td>
                                <td>${transaction.method}</td>
                                <td>${transaction.status}</td>
                                <td>${transaction.date}</td>
                                <td>
                                    ${transaction.status === "completed" ? `<button class="btn btn-danger btn-sm" onclick="processRefund(${transaction.id})">Zwrot</button>` : ""}
                                </td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania transakcji:", error));
    }

    function processRefund(transactionId) {
        if (!confirm("Czy na pewno chcesz dokonaƒá zwrotu?")) return;

        fetch(`/api/admin/refund.php?id=${transactionId}`, { method: "POST" })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Zwrot zosta≈Ç pomy≈õlnie przetworzony.");
                    fetchTransactions();
                } else {
                    alert("B≈ÇƒÖd zwrotu: " + data.error);
                }
            })
            .catch(error => console.error("B≈ÇƒÖd zwrotu:", error));
    }

    fetchTransactions();
});
</script>
=== public/views/admin/payments/transactions.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';
if (!isset($_SESSION['admin_id'])) {
    header('Location: login.php');
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Panel Transakcji P≈Çatno≈õci
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia administratorowi przeglƒÖd i zarzƒÖdzanie wszystkimi
| transakcjami finansowymi systemu. Obs≈Çuguje filtrowanie i eksport danych.
|
| ≈öcie≈ºka: App/Views/admin/payments/transactions.php
|
| Zale≈ºy od:
| - JavaScript: /js/admin.js (obs≈Çuga AJAX, filtrowanie, eksport)
| - CSS: /css/admin.css (stylizacja interfejsu)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane transakcji)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do pobierania danych)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Transakcje P≈Çatno≈õci</h1>

<div class="admin-container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Historia Transakcji</h3>
        <div>
            <button class="btn btn-success btn-sm" id="exportCSV">Eksport CSV</button>
            <button class="btn btn-danger btn-sm" id="exportPDF">Eksport PDF</button>
        </div>
    </div>

    <!-- Filtry transakcji -->
    <form id="transactionFilterForm" class="row mt-4">
        <?= csrf_field() ?>
        <div class="col-md-3">
            <input type="text" class="form-control" name="user_id" placeholder="ID U≈ºytkownika">
        </div>
        <div class="col-md-3">
            <select class="form-control" name="status">
                <option value="">Status transakcji</option>
                <option value="completed">Zako≈Ñczona</option>
                <option value="pending">OczekujƒÖca</option>
                <option value="failed">Nieudana</option>
            </select>
        </div>
        <div class="col-md-3">
            <select class="form-control" name="method">
                <option value="">Metoda p≈Çatno≈õci</option>
                <option value="card">Karta kredytowa</option>
                <option value="paypal">PayPal</option>
                <option value="transfer">Przelew bankowy</option>
            </select>
        </div>
        <div class="col-md-3 text-end">
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </div>
    </form>

    <!-- Tabela transakcji -->
    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>U≈ºytkownik</th>
                <th>Kwota</th>
                <th>Metoda</th>
                <th>Status</th>
                <th>Data</th>
            </tr>
        </thead>
        <tbody id="transactionList">
            <!-- Dane bƒôdƒÖ ≈Çadowane dynamicznie -->
        </tbody>
    </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterForm = document.getElementById("transactionFilterForm");
    const exportCSV = document.getElementById("exportCSV");
    const exportPDF = document.getElementById("exportPDF");

    filterForm.addEventListener("submit", function(e) {
        e.preventDefault();
        fetchTransactions(new FormData(filterForm));
    });

    exportCSV.addEventListener("click", function() {
        window.location.href = "/api/admin/export_transactions.php?format=csv";
    });

    exportPDF.addEventListener("click", function() {
        window.location.href = "/api/admin/export_transactions.php?format=pdf";
    });

    function fetchTransactions(formData = null) {
        let url = "/api/admin/transactions.php";
        if (formData) {
            url += "?" + new URLSearchParams(formData).toString();
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const transactionTable = document.getElementById("transactionList");
                transactionTable.innerHTML = "";

                if (data.length === 0) {
                    transactionTable.innerHTML = `<tr><td colspan="6" class="text-center text-muted">Brak transakcji spe≈ÇniajƒÖcych kryteria.</td></tr>`;
                } else {
                    data.forEach(transaction => {
                        transactionTable.innerHTML += `
                            <tr>
                                <td>${transaction.id}</td>
                                <td>${transaction.user}</td>
                                <td>${transaction.amount} PLN</td>
                                <td>${transaction.method}</td>
                                <td>${transaction.status}</td>
                                <td>${transaction.date}</td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania transakcji:", error));
    }

    fetchTransactions();
});
</script>
=== public/views/admin/payments/refunds.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';
if (!isset($_SESSION['admin_id'])) {
    header('Location: login.php');
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Panel Zwrot√≥w P≈Çatno≈õci
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia administratorowi przeglƒÖd i zarzƒÖdzanie zwrotami.
| Administrator mo≈ºe sprawdziƒá status zwrot√≥w oraz anulowaƒá wybrane operacje.
|
| ≈öcie≈ºka: App/Views/admin/payments/refunds.php
|
| Zale≈ºy od:
| - JavaScript: /js/admin.js (obs≈Çuga AJAX, filtrowanie, anulowanie zwrot√≥w)
| - CSS: /css/admin.css (stylizacja interfejsu)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane zwrot√≥w)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do pobierania danych)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Zwroty P≈Çatno≈õci</h1>

<div class="admin-container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Historia Zwrot√≥w</h3>
    </div>

    <!-- Filtry zwrot√≥w -->
    <form id="refundFilterForm" class="row mt-4">
        <?= csrf_field() ?>
        <div class="col-md-3">
            <input type="text" class="form-control" name="user_id" placeholder="ID U≈ºytkownika">
        </div>
        <div class="col-md-3">
            <select class="form-control" name="status">
                <option value="">Status zwrotu</option>
                <option value="pending">OczekujƒÖcy</option>
                <option value="completed">Zako≈Ñczony</option>
                <option value="failed">Nieudany</option>
            </select>
        </div>
        <div class="col-md-3">
            <input type="date" class="form-control" name="start_date" placeholder="Data poczƒÖtkowa">
        </div>
        <div class="col-md-3 text-end">
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </div>
    </form>

    <!-- Tabela zwrot√≥w -->
    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>U≈ºytkownik</th>
                <th>Kwota</th>
                <th>Status</th>
                <th>Data</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody id="refundList">
            <!-- Dane bƒôdƒÖ ≈Çadowane dynamicznie -->
        </tbody>
    </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterForm = document.getElementById("refundFilterForm");

    filterForm.addEventListener("submit", function(e) {
        e.preventDefault();
        fetchRefunds(new FormData(filterForm));
    });

    function fetchRefunds(formData = null) {
        let url = "/api/admin/refunds.php";
        if (formData) {
            url += "?" + new URLSearchParams(formData).toString();
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const refundTable = document.getElementById("refundList");
                refundTable.innerHTML = "";

                if (data.length === 0) {
                    refundTable.innerHTML = `<tr><td colspan="6" class="text-center text-muted">Brak zwrot√≥w spe≈ÇniajƒÖcych kryteria.</td></tr>`;
                } else {
                    data.forEach(refund => {
                        refundTable.innerHTML += `
                            <tr>
                                <td>${refund.id}</td>
                                <td>${refund.user}</td>
                                <td>${refund.amount} PLN</td>
                                <td>${refund.status}</td>
                                <td>${refund.date}</td>
                                <td>
                                    ${refund.status === "pending" ? `<button class="btn btn-danger btn-sm" onclick="cancelRefund(${refund.id})">Anuluj</button>` : ""}
                                </td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania zwrot√≥w:", error));
    }

    function cancelRefund(refundId) {
        if (!confirm("Czy na pewno chcesz anulowaƒá ten zwrot?")) return;

        fetch(`/api/admin/cancel_refund.php?id=${refundId}`, { method: "POST" })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Zwrot zosta≈Ç anulowany.");
                    fetchRefunds();
                } else {
                    alert("B≈ÇƒÖd anulowania zwrotu: " + data.error);
                }
            })
            .catch(error => console.error("B≈ÇƒÖd anulowania zwrotu:", error));
    }

    fetchRefunds();
});
</script>
=== public/views/admin/dashboard.php ===
<?php require_once __DIR__ . '/../layouts/header.php'; ?>

<h1 class="text-center">Admin Dashboard</h1>

<div class="dashboard-container">
    <!-- Overview Cards -->
    <div class="row">
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>Total Users</h4>
                    <p id="totalUsers" class="display-6">0</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>Total Bookings</h4>
                    <p id="totalBookings" class="display-6">0</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>Total Revenue</h4>
                    <p id="totalRevenue" class="display-6">$0.00</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Graphs -->
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-body">
                    <h5 class="text-center">Monthly Booking Trends</h5>
                    <canvas id="bookingTrends"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-body">
                    <h5 class="text-center">Monthly Revenue Trends</h5>
                    <canvas id="revenueTrends"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/js/admin.js"></script>

<?php require_once __DIR__ . '/../layouts/footer.php'; ?>
=== public/views/admin/users.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';
if (!isset($_SESSION['admin_id'])) {
    header('Location: login.php');
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Panel ZarzƒÖdzania U≈ºytkownikami
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia administratorowi przeglƒÖd i zarzƒÖdzanie u≈ºytkownikami.
| Obs≈Çuguje filtrowanie, edycjƒô, dodawanie i usuwanie u≈ºytkownik√≥w.
|
| ≈öcie≈ºka: App/Views/admin/users.php
|
| Zale≈ºy od:
| - JavaScript: /js/admin.js (obs≈Çuga AJAX, edycja, usuwanie)
| - CSS: /css/admin.css (stylizacja interfejsu)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane u≈ºytkownik√≥w)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do pobierania danych)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">ZarzƒÖdzanie U≈ºytkownikami</h1>

<div class="admin-container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Lista U≈ºytkownik√≥w</h3>
        <button class="btn btn-primary" id="addUserBtn">Dodaj U≈ºytkownika</button>
    </div>

    <!-- Filtry u≈ºytkownik√≥w -->
    <form id="userFilterForm" class="row mt-4">
        <?= csrf_field() ?>
        <div class="col-md-3">
            <select class="form-control" name="role">
                <option value="">Wybierz rolƒô</option>
                <option value="user">U≈ºytkownik</option>
                <option value="admin">Administrator</option>
            </select>
        </div>
        <div class="col-md-3">
            <select class="form-control" name="status">
                <option value="">Status</option>
                <option value="active">Aktywny</option>
                <option value="inactive">Nieaktywny</option>
            </select>
        </div>
        <div class="col-md-3">
            <input type="date" class="form-control" name="registration_date" placeholder="Data rejestracji">
        </div>
        <div class="col-md-3 text-end">
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </div>
    </form>

    <!-- Tabela u≈ºytkownik√≥w -->
    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>Imiƒô i nazwisko</th>
                <th>Email</th>
                <th>Rola</th>
                <th>Status</th>
                <th>Data rejestracji</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody id="userList">
            <!-- Dane bƒôdƒÖ ≈Çadowane dynamicznie -->
        </tbody>
    </table>
</div>

<!-- Modal dodawania/edycji u≈ºytkownika -->
<div id="userModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="modalTitle">Dodaj U≈ºytkownika</h2>
        <form id="userForm">
            <?= csrf_field() ?>
            <input type="hidden" id="userId" name="userId">

            <div class="form-group">
                <label for="name">Imiƒô i nazwisko</label>
                <input type="text" id="name" name="name" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="email">Adres e-mail</label>
                <input type="email" id="email" name="email" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="role">Rola</label>
                <select id="role" name="role" class="form-control" required>
                    <option value="user">U≈ºytkownik</option>
                    <option value="admin">Administrator</option>
                </select>
            </div>

            <div class="form-group">
                <label for="status">Status</label>
                <select id="status" name="status" class="form-control" required>
                    <option value="active">Aktywny</option>
                    <option value="inactive">Nieaktywny</option>
                </select>
            </div>

            <button type="submit" class="btn btn-success">Zapisz</button>
        </form>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterForm = document.getElementById("userFilterForm");
    const addUserBtn = document.getElementById("addUserBtn");

    filterForm.addEventListener("submit", function(e) {
        e.preventDefault();
        fetchUsers(new FormData(filterForm));
    });

    addUserBtn.addEventListener("click", function() {
        openUserModal();
    });

    function fetchUsers(formData = null) {
        let url = "/api/admin/users.php";
        if (formData) {
            url += "?" + new URLSearchParams(formData).toString();
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const userTable = document.getElementById("userList");
                userTable.innerHTML = "";

                if (data.length === 0) {
                    userTable.innerHTML = `<tr><td colspan="7" class="text-center text-muted">Brak u≈ºytkownik√≥w spe≈ÇniajƒÖcych kryteria.</td></tr>`;
                } else {
                    data.forEach(user => {
                        userTable.innerHTML += `
                            <tr>
                                <td>${user.id}</td>
                                <td>${user.name}</td>
                                <td>${user.email}</td>
                                <td>${user.role}</td>
                                <td>${user.status}</td>
                                <td>${user.registration_date}</td>
                                <td>
                                    <button class="btn btn-warning btn-sm" onclick="editUser(${user.id})">Edytuj</button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">Usu≈Ñ</button>
                                </td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania u≈ºytkownik√≥w:", error));
    }

    fetchUsers();
});
</script>

<?php
// Improved AJAX for fetching users
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['action']) && $_POST['action'] === 'fetch_users') {
    // Fetch users from the database
    // ...existing code...
    $users = []; // Assume this array is populated with user data from the database

    foreach ($users as &$user) {
        $user['role'] = $user['is_admin'] ? 'admin' : 'user';
    }

    echo json_encode($users);
    exit();
}
?>
=== public/views/admin/audit_logs.php ===
<?php
if (!isset($_SESSION['admin_id'])) {
    header('Location: login.php');
    exit();
}

/*
|--------------------------------------------------------------------------
| Logi Audytowe Administratora
|--------------------------------------------------------------------------
| Ten plik odpowiada za wy≈õwietlanie log√≥w audytowych systemu. Administrator
| mo≈ºe filtrowaƒá historiƒô dzia≈Ça≈Ñ u≈ºytkownik√≥w wed≈Çug ID, rezerwacji, daty i IP.
|
| ≈öcie≈ºka: App/Views/admin/audit_logs.php
|
| Zale≈ºy od:
| - JavaScript: admin.js (obs≈Çuga log√≥w, AJAX)
| - CSS: admin.css (stylizacja tabeli, formularzy)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane pobierane z bazy)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX, dynamiczne ≈Çadowanie danych)
| - HTML, CSS (interfejs)
*/
?>
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logi Audytowe</title>
    <link rel="stylesheet" href="path/to/admin.css">
</head>
<body>
    <h1 class="text-center">Logi Audytowe</h1>

    <div class="admin-container">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3>Historia Zdarze≈Ñ w Systemie</h3>
            <button class="btn btn-secondary" id="clearFilters">Wyczy≈õƒá Filtry</button>
        </div>

        <!-- Filtry -->
        <form id="filterForm" class="row mb-4">
            <?= csrf_field() ?>
            <div class="col-md-2">
                <input type="text" class="form-control" name="user_id" placeholder="ID U≈ºytkownika">
            </div>
            <div class="col-md-2">
                <input type="text" class="form-control" name="booking_id" placeholder="ID Rezerwacji">
            </div>
            <div class="col-md-2">
                <input type="date" class="form-control" name="start_date" placeholder="Data poczƒÖtkowa">
            </div>
            <div class="col-md-2">
                <input type="date" class="form-control" name="end_date" placeholder="Data ko≈Ñcowa">
            </div>
            <div class="col-md-2">
                <select class="form-control" name="action_type">
                    <option value="">Rodzaj akcji</option>
                    <option value="login">Logowanie</option>
                    <option value="update">Aktualizacja</option>
                    <option value="delete">Usuniƒôcie</option>
                </select>
            </div>
            <div class="col-md-2 text-end">
                <button type="submit" class="btn btn-primary">Filtruj</button>
            </div>
        </form>

        <!-- Tabela Log√≥w -->
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>U≈ºytkownik</th>
                    <th>Akcja</th>
                    <th>Opis</th>
                    <th>ID Rezerwacji</th>
                    <th>Adres IP</th>
                    <th>Data</th>
                </tr>
            </thead>
            <tbody id="auditLogs">
                <!-- Dane bƒôdƒÖ ≈Çadowane dynamicznie -->
            </tbody>
        </table>
    </div>

    <script src="path/to/admin.js"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        const filterForm = document.getElementById("filterForm");
        const clearFilters = document.getElementById("clearFilters");

        // Obs≈Çuga filtr√≥w
        filterForm.addEventListener("submit", function(e) {
            e.preventDefault();
            fetchAuditLogs(new FormData(filterForm));
        });

        clearFilters.addEventListener("click", function() {
            filterForm.reset();
            fetchAuditLogs();
        });

        // Pobieranie log√≥w audytowych przez AJAX
        function fetchAuditLogs(formData = null) {
            let url = "/api/admin/audit_logs.php";
            if (formData) {
                url += "?" + new URLSearchParams(formData).toString();
            }

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const auditLogsTable = document.getElementById("auditLogs");
                    auditLogsTable.innerHTML = "";
                    data.forEach(log => {
                        auditLogsTable.innerHTML += `
                            <tr>
                                <td>${log.id}</td>
                                <td>${log.user}</td>
                                <td>${log.action}</td>
                                <td>${log.details}</td>
                                <td>${log.booking_id || '-'}</td>
                                <td>${log.ip_address}</td>
                                <td>${log.formatted_date}</td>
                            </tr>
                        `;
                    });
                })
                .catch(error => console.error("B≈ÇƒÖd pobierania log√≥w audytowych:", error));
        }

        // Automatyczne za≈Çadowanie log√≥w po otwarciu strony
        fetchAuditLogs();
    });
    </script>
</body>
</html>
=== public/views/admin/logs.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';
if (!isset($_SESSION['admin_id'])) {
    header('Location: login.php');
    exit();
}

/*
|--------------------------------------------------------------------------
| Logi Systemowe Administratora
|--------------------------------------------------------------------------
| Ten plik odpowiada za wy≈õwietlanie log√≥w systemowych, kt√≥re pomagajƒÖ
| administratorowi diagnozowaƒá problemy techniczne.
|
| ≈öcie≈ºka: App/Views/admin/logs.php
|
| Zale≈ºy od:
| - JavaScript: /js/admin.js (obs≈Çuga log√≥w, AJAX)
| - CSS: /css/admin.css (stylizacja tabeli)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane pobierane z bazy)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX, dynamiczne ≈Çadowanie danych)
| - HTML, CSS (interfejs)
*/
?>

<h1 class="text-center">Logi Systemowe</h1>

<div class="admin-container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>PrzeglƒÖd Log√≥w Systemowych</h3>
        <button class="btn btn-secondary" id="clearFilters">Wyczy≈õƒá Filtry</button>
    </div>

    <!-- Filtry log√≥w -->
    <form id="logFilterForm" class="row mb-4">
        <?= csrf_field() ?>
        <div class="col-md-3">
            <select class="form-control" name="log_type">
                <option value="">Wybierz typ logu</option>
                <option value="error">B≈ÇƒÖd</option>
                <option value="info">Informacja</option>
                <option value="warning">Ostrze≈ºenie</option>
            </select>
        </div>
        <div class="col-md-3">
            <input type="text" class="form-control" name="log_message" placeholder="Wyszukaj w tre≈õci logu">
        </div>
        <div class="col-md-2">
            <input type="date" class="form-control" name="start_date" placeholder="Data poczƒÖtkowa">
        </div>
        <div class="col-md-2">
            <input type="date" class="form-control" name="end_date" placeholder="Data ko≈Ñcowa">
        </div>
        <div class="col-md-2 text-end">
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </div>
    </form>

    <!-- Tabela log√≥w -->
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Typ Logu</th>
                <th>Wiadomo≈õƒá</th>
                <th>Data</th>
            </tr>
        </thead>
        <tbody id="systemLogs">
            <!-- Dane bƒôdƒÖ ≈Çadowane dynamicznie -->
        </tbody>
    </table>
    <p id="noLogsMessage" class="text-center text-muted" style="display:none;">Brak log√≥w spe≈ÇniajƒÖcych kryteria.</p>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterForm = document.getElementById("logFilterForm");
    const clearFilters = document.getElementById("clearFilters");

    // Obs≈Çuga filtr√≥w
    filterForm.addEventListener("submit", function(e) {
        e.preventDefault();
        fetchLogs(new FormData(filterForm));
    });

    clearFilters.addEventListener("click", function() {
        filterForm.reset();
        fetchLogs();
    });

    // Pobieranie log√≥w systemowych przez AJAX
    function fetchLogs(formData = null) {
        let url = "/api/admin/logs.php";
        if (formData) {
            url += "?" + new URLSearchParams(formData).toString();
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const logsTable = document.getElementById("systemLogs");
                logsTable.innerHTML = "";
                const noLogsMessage = document.getElementById("noLogsMessage");

                if (data.length === 0) {
                    noLogsMessage.style.display = "block";
                } else {
                    noLogsMessage.style.display = "none";
                    data.forEach(log => {
                        logsTable.innerHTML += `
                            <tr>
                                <td>${log.id}</td>
                                <td>${log.type}</td>
                                <td>${log.message}</td>
                                <td>${log.formatted_date}</td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania log√≥w systemowych:", error));
    }

    // Automatyczne za≈Çadowanie log√≥w po otwarciu strony
    fetchLogs();
});
</script>

<?php
// Fetch and display logs
$logs = []; // Assume this array is populated with log data from the database

foreach ($logs as &$log) {
    $log['formatted_date'] = date('Y-m-d H:i:s', strtotime($log['date']));
}
?>
=== public/views/admin/documents.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';
if (!isset($_SESSION['admin_id'])) {
    header('Location: login.php');
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Panel ZarzƒÖdzania Dokumentami
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia administratorowi przeglƒÖd i zarzƒÖdzanie dokumentami 
| przes≈Çanymi przez u≈ºytkownik√≥w. Obs≈Çuguje filtrowanie i podglƒÖd plik√≥w.
|
| ≈öcie≈ºka: App/Views/admin/documents.php
|
| Zale≈ºy od:
| - JavaScript: /js/admin.js (obs≈Çuga AJAX, filtrowanie, usuwanie dokument√≥w)
| - CSS: /css/admin.css (stylizacja interfejsu)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane dokument√≥w)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do pobierania danych)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">ZarzƒÖdzanie Dokumentami</h1>

<div class="admin-container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Lista Dokument√≥w</h3>
    </div>

    <!-- Filtry dokument√≥w -->
    <form id="documentFilterForm" class="row mt-4">
        <?= csrf_field() ?>
        <div class="col-md-3">
            <input type="text" class="form-control" name="user_id" placeholder="ID U≈ºytkownika">
        </div>
        <div class="col-md-3">
            <select class="form-control" name="document_type">
                <option value="">Typ dokumentu</option>
                <option value="contract">Umowa</option>
                <option value="invoice">Faktura</option>
                <option value="identity">Dow√≥d to≈ºsamo≈õci</option>
            </select>
        </div>
        <div class="col-md-3">
            <input type="date" class="form-control" name="upload_date" placeholder="Data przes≈Çania">
        </div>
        <div class="col-md-3 text-end">
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </div>
    </form>

    <!-- Tabela dokument√≥w -->
    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>U≈ºytkownik</th>
                <th>Typ</th>
                <th>Plik</th>
                <th>Data przes≈Çania</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody id="documentList">
            <!-- Dane bƒôdƒÖ ≈Çadowane dynamicznie -->
        </tbody>
    </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterForm = document.getElementById("documentFilterForm");

    filterForm.addEventListener("submit", function(e) {
        e.preventDefault();
        fetchDocuments(new FormData(filterForm));
    });

    function fetchDocuments(formData = null) {
        let url = "/api/admin/documents.php";
        if (formData) {
            url += "?" + new URLSearchParams(formData).toString();
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const documentTable = document.getElementById("documentList");
                documentTable.innerHTML = "";

                if (data.length === 0) {
                    documentTable.innerHTML = `<tr><td colspan="6" class="text-center text-muted">Brak dokument√≥w spe≈ÇniajƒÖcych kryteria.</td></tr>`;
                } else {
                    data.forEach(doc => {
                        documentTable.innerHTML += `
                            <tr>
                                <td>${doc.id}</td>
                                <td>${doc.user}</td>
                                <td>${doc.type}</td>
                                <td><a href="${doc.file_url}" target="_blank">PodglƒÖd</a></td>
                                <td>${doc.upload_date}</td>
                                <td>
                                    <button class="btn btn-danger btn-sm" onclick="deleteDocument(${doc.id})">Usu≈Ñ</button>
                                </td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania dokument√≥w:", error));
    }

    function deleteDocument(documentId) {
        if (!confirm("Czy na pewno chcesz usunƒÖƒá ten dokument?")) return;

        fetch(`/api/admin/delete_document.php?id=${documentId}`, { method: "POST" })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Dokument zosta≈Ç usuniƒôty.");
                    fetchDocuments();
                } else {
                    alert("B≈ÇƒÖd usuwania dokumentu: " + data.error);
                }
            })
            .catch(error => console.error("B≈ÇƒÖd usuwania dokumentu:", error));
    }

    fetchDocuments();
});
</script>
=== public/views/admin/reports.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';
if (!isset($_SESSION['admin_id'])) {
    header('Location: login.php');
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Raporty Administratora
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia generowanie raport√≥w dotyczƒÖcych rezerwacji, p≈Çatno≈õci,
| u≈ºytkownik√≥w, aktywno≈õci w systemie oraz audyt√≥w.
|
| ≈öcie≈ºka: App/Views/admin/reports.php
|
| Zale≈ºy od:
| - JavaScript: /js/admin.js (obs≈Çuga generowania raport√≥w, AJAX)
| - CSS: /css/admin.css (stylizacja formularzy i tabeli)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane pobierane z bazy)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX, dynamiczne generowanie raport√≥w)
| - Chart.js (wizualizacja raport√≥w)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Raporty Systemowe</h1>

<div class="admin-container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Generowanie raport√≥w</h3>
        <button class="btn btn-secondary" id="clearFilters">Reset</button>
    </div>

    <!-- Formularz generowania raport√≥w -->
    <form id="adminReportForm" class="mt-4">
        <?= csrf_field() ?>

        <div class="mb-3">
            <label for="reportType" class="form-label">Typ raportu</label>
            <select class="form-select" id="reportType" name="reportType" required>
                <option value="" disabled selected>Wybierz typ raportu</option>
                <option value="bookings">Rezerwacje</option>
                <option value="payments">P≈Çatno≈õci</option>
                <option value="users">U≈ºytkownicy</option>
                <option value="activity">Aktywno≈õƒá u≈ºytkownik√≥w</option>
                <option value="audit">Logi audytowe</option>
            </select>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="startDate" class="form-label">Data poczƒÖtkowa</label>
                <input type="date" class="form-control" id="startDate" name="startDate" required>
            </div>

            <div class="col-md-6 mb-3">
                <label for="endDate" class="form-label">Data ko≈Ñcowa</label>
                <input type="date" class="form-control" id="endDate" name="endDate" required>
            </div>
        </div>

        <div class="mb-3">
            <label for="format" class="form-label">Format raportu</label>
            <select class="form-select" id="format" name="format" required>
                <option value="csv">CSV</option>
                <option value="pdf">PDF</option>
                <option value="json">JSON</option>
            </select>
        </div>

        <button type="submit" class="btn btn-primary w-100">Generuj raport</button>
    </form>

    <div id="responseMessage" class="alert mt-3" style="display:none;"></div>

    <div class="mt-4">
        <h4>PodglƒÖd raportu</h4>
        <canvas id="reportChart"></canvas>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const reportForm = document.getElementById("adminReportForm");
    const responseMessage = document.getElementById("responseMessage");
    const clearFilters = document.getElementById("clearFilters");

    reportForm.addEventListener("submit", function(e) {
        e.preventDefault();
        generateReport(new FormData(reportForm));
    });

    clearFilters.addEventListener("click", function() {
        reportForm.reset();
        responseMessage.style.display = "none";
    });

    function generateReport(formData) {
        let url = "/api/admin/reports.php";

        fetch(url, {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            responseMessage.style.display = "block";
            if (data.success) {
                responseMessage.className = "alert alert-success";
                responseMessage.textContent = "Raport wygenerowany pomy≈õlnie! Pobierz go tutaj: " + data.download_link;
                renderChart(data.chartData);
            } else {
                responseMessage.className = "alert alert-danger";
                responseMessage.textContent = "B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            responseMessage.style.display = "block";
            responseMessage.className = "alert alert-danger";
            responseMessage.textContent = "B≈ÇƒÖd po≈ÇƒÖczenia z serwerem.";
            console.error("B≈ÇƒÖd generowania raportu:", error);
        });
    }

    function renderChart(chartData) {
        const ctx = document.getElementById("reportChart").getContext("2d");
        new Chart(ctx, {
            type: "bar",
            data: {
                labels: chartData.labels,
                datasets: [{
                    label: "Liczba zg≈Çosze≈Ñ",
                    data: chartData.values,
                    backgroundColor: "rgba(54, 162, 235, 0.6)"
                }]
            }
        });
    }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<?php
// Date range validation
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['start_date'], $_POST['end_date'])) {
    $start_date = $_POST['start_date'];
    $end_date = $_POST['end_date'];

    if (strtotime($start_date) > strtotime($end_date)) {
        echo 'Invalid date range';
        exit();
    }

    // Export reports logic (PDF, CSV)
    // ...existing code...
}
?>
=== public/views/admin/settings.php ===
/*
|--------------------------------------------------------------------------
| Ustawienia Systemowe Administratora
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia administratorowi konfiguracjƒô systemu ‚Äì ustawienia
| og√≥lne, tryb konserwacji, strefƒô czasowƒÖ oraz konfiguracjƒô API.
|
| ≈öcie≈ºka: App/Views/admin/settings.php
|
| Zale≈ºy od:
| - JavaScript: /js/admin.js (obs≈Çuga formularza ustawie≈Ñ, AJAX)
| - CSS: /css/admin.css (stylizacja interfejsu)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (przechowywanie ustawie≈Ñ)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do zapisu ustawie≈Ñ)
| - HTML, CSS (interfejs)
*/

<?php
if (!isset($_SESSION['admin_id'])) {
    header('Location: login.php');
    exit();
}

// Improved form validation
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $errors = [];

    if (empty($_POST['setting_name'])) {
        $errors[] = 'Setting name is required';
    }

    if (empty($_POST['setting_value'])) {
        $errors[] = 'Setting value is required';
    }

    if (empty($errors)) {
        // Save settings logic
        // ...existing code...
    } else {
        foreach ($errors as $error) {
            echo "<p>$error</p>";
        }
    }
}
?>

<h1 class="text-center">Ustawienia Systemowe</h1>

<div class="admin-container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Konfiguracja systemu</h3>
        <button class="btn btn-secondary" id="resetSettings">Resetuj</button>
    </div>

    <!-- Formularz ustawie≈Ñ systemowych -->
    <form id="settingsForm" class="mt-4">
        <?= csrf_field() ?>

        <div class="mb-3">
            <label for="site_name" class="form-label">Nazwa strony</label>
            <input type="text" id="site_name" name="site_name" class="form-control" placeholder="Podaj nazwƒô strony" value="<?= esc($settings['site_name'] ?? '') ?>" required>
        </div>

        <div class="mb-3">
            <label for="admin_email" class="form-label">E-mail administratora</label>
            <input type="email" id="admin_email" name="admin_email" class="form-control" placeholder="Podaj e-mail administratora" value="<?= esc($settings['admin_email'] ?? '') ?>" required>
        </div>

        <div class="mb-3">
            <label for="logo_url" class="form-label">Logo strony (URL)</label>
            <input type="url" id="logo_url" name="logo_url" class="form-control" placeholder="Podaj URL logo" value="<?= esc($settings['logo_url'] ?? '') ?>">
        </div>

        <div class="mb-3">
            <label for="timezone" class="form-label">Strefa czasowa</label>
            <select id="timezone" name="timezone" class="form-select">
                <?php foreach (timezone_identifiers_list() as $tz): ?>
                    <option value="<?= esc($tz) ?>" <?= ($settings['timezone'] ?? '') === $tz ? 'selected' : '' ?>><?= esc($tz) ?></option>
                <?php endforeach; ?>
            </select>
        </div>

        <div class="mb-3">
            <label for="log_limit" class="form-label">Maksymalna liczba log√≥w</label>
            <input type="number" id="log_limit" name="log_limit" class="form-control" value="<?= esc($settings['log_limit'] ?? 1000) ?>" min="100">
        </div>

        <div class="mb-3">
            <label for="api_key" class="form-label">Klucz API</label>
            <input type="text" id="api_key" name="api_key" class="form-control" placeholder="Podaj klucz API" value="<?= esc($settings['api_key'] ?? '') ?>">
        </div>

        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="maintenance_mode" name="maintenance_mode" <?= isset($settings['maintenance_mode']) && $settings['maintenance_mode'] ? 'checked' : '' ?>>
            <label class="form-check-label" for="maintenance_mode">Tryb konserwacji</label>
        </div>

        <button type="submit" class="btn btn-primary w-100">Zapisz zmiany</button>
    </form>

    <div id="responseMessage" class="alert mt-3" style="display:none;"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const settingsForm = document.getElementById("settingsForm");
    const responseMessage = document.getElementById("responseMessage");
    const resetSettings = document.getElementById("resetSettings");

    settingsForm.addEventListener("submit", function(e) {
        e.preventDefault();
        saveSettings(new FormData(settingsForm));
    });

    resetSettings.addEventListener("click", function() {
        if (confirm("Czy na pewno chcesz przywr√≥ciƒá domy≈õlne ustawienia?")) {
            fetch("/api/admin/reset_settings.php", { method: "POST" })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    responseMessage.style.display = "block";
                    responseMessage.className = "alert alert-danger";
                    responseMessage.textContent = "B≈ÇƒÖd resetowania ustawie≈Ñ.";
                }
            })
            .catch(error => console.error("B≈ÇƒÖd resetowania ustawie≈Ñ:", error));
        }
    });

    function saveSettings(formData) {
        let url = "/api/admin/save_settings.php";

        fetch(url, {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            responseMessage.style.display = "block";
            if (data.success) {
                responseMessage.className = "alert alert-success";
                responseMessage.textContent = "Ustawienia zapisane pomy≈õlnie!";
            } else {
                responseMessage.className = "alert alert-danger";
                responseMessage.textContent = "B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            responseMessage.style.display = "block";
            responseMessage.className = "alert alert-danger";
            responseMessage.textContent = "B≈ÇƒÖd po≈ÇƒÖczenia z serwerem.";
            console.error("B≈ÇƒÖd zapisywania ustawie≈Ñ:", error);
        });
    }
});
</script>
=== public/views/layouts/header.php ===
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarFuse Dashboard</title>
    <link rel="stylesheet" href="/public/css/main.css">
    <script src="/public/js/main.js" defer></script>
</head>
<body>
=== public/views/layouts/footer.php ===
</body>
</html>
=== public/views/layouts/sidebar.php ===
<?php
/*
|--------------------------------------------------------------------------
| Sidebar - Nawigacja w Dashboardzie
|--------------------------------------------------------------------------
| Plik odpowiada za wy≈õwietlanie bocznego menu nawigacyjnego w dashboardzie.
| Umo≈ºliwia u≈ºytkownikom i administratorom prze≈ÇƒÖczanie siƒô miƒôdzy podstronami.
|
| ≈öcie≈ºka: App/Views/layouts/sidebar.php
*/
?>

<aside class="sidebar">
    <nav class="sidebar-menu">
        <ul>
            <li><a href="/user/dashboard" class="dashboard-link">üìä Panel</a></li>
            <li><a href="/bookings/view" class="dashboard-link">üìÖ Moje rezerwacje</a></li>
            <li><a href="/payments/history" class="dashboard-link">üí≥ Historia p≈Çatno≈õci</a></li>
            <li><a href="/documents/user_documents" class="dashboard-link">üìÑ Moje dokumenty</a></li>
            <li><a href="/user/notifications" class="dashboard-link">üîî Powiadomienia</a></li>
            <li><a href="/user/profile" class="dashboard-link">üë§ Profil</a></li>
            <li><a href="/admin/users" class="dashboard-link">üë• ZarzƒÖdzanie u≈ºytkownikami</a></li>
            <li><a href="/admin/audit_logs" class="dashboard-link">üìú Logi audytowe</a></li>
            <li><a href="/admin/logs" class="dashboard-link">üìÇ Logi systemowe</a></li>
            <li><a href="/admin/reports" class="dashboard-link">üìë Raporty</a></li>
            <li><a href="/admin/settings" class="dashboard-link">‚öôÔ∏è Ustawienia</a></li>
            <li><a href="/logout">üö™ Wyloguj</a></li>
        </ul>
    </nav>
</aside>

<script src="/public/js/main.js" defer></script>
=== public/views/layouts/main copy.php ===
<?php
/*
|--------------------------------------------------------------------------
| Global Layout Wrapper - main.php
|--------------------------------------------------------------------------
| This file ensures all views have a consistent layout with a header and footer.
|
| Path: public/layouts/main.php
*/

require_once __DIR__ . '/../bootstrap.php';
require_once __DIR__ . '/../vendor/autoload.php';
require_once __DIR__ . '/../App/Helpers/SecurityHelper.php';

// Ensure $view is set before including it
if (!isset($view) || !file_exists($view)) {
    die("Error: View file not found.");
}

// Include header
require_once __DIR__ . '/header.php';
?>

<main class="content">
    <?php include $view; ?>
</main>

<?php
// Include footer
require_once __DIR__ . '/footer.php';
?>
=== public/views/layouts/modals.php ===
<?php
/*
|--------------------------------------------------------------------------
| Modale - Okna Modalne
|--------------------------------------------------------------------------
| Plik zawiera globalne okna modalne wykorzystywane w aplikacji.
|
| ≈öcie≈ºka: App/Views/layouts/modals.php
*/
?>

<div id="globalModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="modalTitle"></h2>
        <div id="modalBody"></div>
        <button class="btn btn-primary" id="modalConfirm">OK</button>
    </div>
</div>
=== public/views/layouts/main.php ===
<?php
/*
|--------------------------------------------------------------------------
| Global Layout Wrapper - main.php
|--------------------------------------------------------------------------
| This wrapper ensures that every view is displayed inside a structured
| layout with a header and footer.
|
| Path: public/layouts/main.php
*/

require_once __DIR__ . '/../layouts/header.php';
?>

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/public/css/main.css">
    <script src="/public/js/main.js" defer></script>
</head>
<body>

<?php include __DIR__ . '/../layouts/header.php'; ?>

<div class="dashboard-container">
    <aside class="sidebar">
        <?php
        if ($userRole === 'admin') {
            include __DIR__ . '/../layouts/sidebars/admin_sidebar.php';
        } else {
            include __DIR__ . '/../layouts/sidebars/user_sidebar.php';
        }
        ?>
    </aside>
    <main class="main-content">
        <?php include $view; ?>
    </main>
</div>

<?php include __DIR__ . '/../layouts/footer.php'; ?>

</body>
</html>
=== public/views/layouts/alerts.php ===
<?php
/*
|--------------------------------------------------------------------------
| Alerts - Globalne Powiadomienia
|--------------------------------------------------------------------------
| Plik odpowiada za wy≈õwietlanie globalnych alert√≥w i powiadomie≈Ñ.
|
| ≈öcie≈ºka: App/Views/layouts/alerts.php
*/
?>

<div id="alert-container"></div>
=== public/views/layouts/navbar.php ===
<?php
/*
|--------------------------------------------------------------------------
| Navbar - G√≥rna Nawigacja Dashboardu
|--------------------------------------------------------------------------
| Plik odpowiada za wy≈õwietlanie g√≥rnej belki nawigacyjnej w dashboardzie.
| Pokazuje podstawowe opcje nawigacyjne i dostƒôp do ustawie≈Ñ konta.
|
| ≈öcie≈ºka: App/Views/layouts/navbar.php
*/
?>
<nav class="navbar">
    <div class="container">
        <a href="/dashboard" class="logo">üöó CarFuse</a>
        <ul class="nav-links">
            <li><a href="/user/profile" class="dashboard-link">üë§ M√≥j Profil</a></li>
            <li><a href="/user/notifications" class="dashboard-link">üîî Powiadomienia</a></li>
            <li><a href="/logout">üö™ Wyloguj</a></li>
        </ul>
    </div>
</nav>
<?php if (strpos($_SERVER['REQUEST_URI'], '/dashboard') !== false): ?>
    <script src="/js/main.js"></script>
<?php endif; ?>
<script src="/js/shared.js"></script>


=== public/views/payments/make_payment.php ===
<?php
/*
|--------------------------------------------------------------------------
| Dokonaj P≈Çatno≈õci
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi dokonanie nowej p≈Çatno≈õci za rezerwacje
| lub inne us≈Çugi dostƒôpne w systemie.
|
| ≈öcie≈ºka: App/Views/payments/make_payment.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, dynamiczne przetwarzanie p≈Çatno≈õci)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (obs≈Çuga transakcji)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego przetwarzania p≈Çatno≈õci)
| - HTML, CSS (interfejs)
*/


if (!isset($_SESSION['user_id'])) {
    header("Location: /auth/login.php");
    exit;
}

$userId = $_SESSION['user_id'];
?>

<h1 class="text-center">Dokonaj P≈Çatno≈õci</h1>

<div class="payments-make-container">
    <form id="paymentForm">
        <?= csrf_field() ?>

        <!-- Wyb√≥r kwoty -->
        <div class="mb-3">
            <label for="amount" class="form-label">Kwota p≈Çatno≈õci (PLN)</label>
            <input type="number" class="form-control" id="amount" name="amount" min="1" required>
        </div>

        <!-- Metoda p≈Çatno≈õci -->
        <div class="mb-3">
            <label for="payment_method" class="form-label">Metoda p≈Çatno≈õci</label>
            <select class="form-select" id="payment_method" name="payment_method" required>
                <option value="card">Karta kredytowa</option>
                <option value="paypal">PayPal</option>
                <option value="transfer">Przelew bankowy</option>
            </select>
        </div>

        <div id="cardDetails" style="display:none;">
            <div class="mb-3">
                <label for="card_number" class="form-label">Numer karty</label>
                <input type="text" class="form-control" id="card_number" name="card_number" pattern="\d{16}" placeholder="1234 5678 9012 3456">
            </div>
            <div class="mb-3 row">
                <div class="col">
                    <label for="expiry_date" class="form-label">Data wa≈ºno≈õci</label>
                    <input type="text" class="form-control" id="expiry_date" name="expiry_date" placeholder="MM/YY">
                </div>
                <div class="col">
                    <label for="cvv" class="form-label">CVV</label>
                    <input type="text" class="form-control" id="cvv" name="cvv" pattern="\d{3}" placeholder="123">
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary w-100">Zap≈Çaƒá</button>
    </form>

    <div id="responseMessage" class="alert mt-3" style="display:none;"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const paymentTypeSelect = document.getElementById("payment_method");
    const cardDetails = document.getElementById("cardDetails");

    paymentTypeSelect.addEventListener("change", function() {
        cardDetails.style.display = this.value === "card" ? "block" : "none";
    });

    const paymentForm = document.getElementById("paymentForm");

    paymentForm.addEventListener("submit", function(e) {
        e.preventDefault();
        submitPayment(new FormData(paymentForm));
    });

    function submitPayment(formData) {
        fetch("/api/user/make_payment.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            const responseMessage = document.getElementById("responseMessage");
            responseMessage.style.display = "block";

            if (data.success) {
                responseMessage.className = "alert alert-success";
                responseMessage.textContent = "P≈Çatno≈õƒá zosta≈Ça pomy≈õlnie zrealizowana!";
                setTimeout(() => window.location.href = "/payments/history", 2000);
            } else {
                responseMessage.className = "alert alert-danger";
                responseMessage.textContent = "B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            const responseMessage = document.getElementById("responseMessage");
            responseMessage.style.display = "block";
            responseMessage.className = "alert alert-danger";
            responseMessage.textContent = "B≈ÇƒÖd po≈ÇƒÖczenia z serwerem.";
            console.error("B≈ÇƒÖd p≈Çatno≈õci:", error);
        });
    }
});
</script>
=== public/views/payments/methods.php ===
<?php
/*
|--------------------------------------------------------------------------
| Metody P≈Çatno≈õci U≈ºytkownika
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi zarzƒÖdzanie zapisanymi metodami p≈Çatno≈õci.
| Obs≈Çuguje dodawanie nowych metod oraz usuwanie zapisanych kart czy kont PayPal.
|
| ≈öcie≈ºka: App/Views/payments/methods.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, dynamiczne pobieranie metod p≈Çatno≈õci)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane metod p≈Çatno≈õci)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego pobierania metod p≈Çatno≈õci)
| - HTML, CSS (interfejs)
*/


if (!isset($_SESSION['user_id'])) {
    header("Location: /auth/login.php");
    exit;
}

$userId = $_SESSION['user_id'];
?>

<h1 class="text-center">Moje Metody P≈Çatno≈õci</h1>

<div class="payments-methods-container">
    <!-- Formularz dodawania metody p≈Çatno≈õci -->
    <form id="addPaymentMethodForm">
        <?= csrf_field() ?>
        <div class="mb-3">
            <label for="payment_type" class="form-label">Wybierz metodƒô</label>
            <select class="form-select" id="payment_type" name="payment_type" required>
                <option value="card">Karta kredytowa</option>
                <option value="paypal">PayPal</option>
                <option value="transfer">Przelew bankowy</option>
            </select>
        </div>

        <div id="cardDetails" style="display:none;">
            <div class="mb-3">
                <label for="card_number" class="form-label">Numer karty</label>
                <input type="text" class="form-control" id="card_number" name="card_number" pattern="\d{16}" placeholder="1234 5678 9012 3456">
            </div>
            <div class="mb-3 row">
                <div class="col">
                    <label for="expiry_date" class="form-label">Data wa≈ºno≈õci</label>
                    <input type="text" class="form-control" id="expiry_date" name="expiry_date" placeholder="MM/YY">
                </div>
                <div class="col">
                    <label for="cvv" class="form-label">CVV</label>
                    <input type="text" class="form-control" id="cvv" name="cvv" pattern="\d{3}" placeholder="123">
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary w-100">Dodaj metodƒô p≈Çatno≈õci</button>
    </form>

    <h3 class="mt-4">Zapisane Metody P≈Çatno≈õci</h3>
    <ul id="paymentMethodsList" class="list-group">
        <!-- Metody p≈Çatno≈õci ≈Çadowane dynamicznie -->
    </ul>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const paymentTypeSelect = document.getElementById("payment_type");
    const cardDetails = document.getElementById("cardDetails");

    paymentTypeSelect.addEventListener("change", function() {
        cardDetails.style.display = this.value === "card" ? "block" : "none";
    });

    const addPaymentForm = document.getElementById("addPaymentMethodForm");

    addPaymentForm.addEventListener("submit", function(e) {
        e.preventDefault();
        addPaymentMethod(new FormData(addPaymentForm));
    });

    function loadPaymentMethods() {
        fetch("/api/user/get_payment_methods.php")
            .then(response => response.json())
            .then(data => {
                const methodList = document.getElementById("paymentMethodsList");
                methodList.innerHTML = "";

                if (data.length > 0) {
                    data.forEach(method => {
                        methodList.innerHTML += `
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>${method.type === "card" ? "üí≥ Karta kredytowa" : method.type === "paypal" ? "üÖøÔ∏è PayPal" : "üè¶ Przelew bankowy"}</span>
                                <button class="btn btn-sm btn-danger" onclick="deletePaymentMethod(${method.id})">Usu≈Ñ</button>
                            </li>
                        `;
                    });
                } else {
                    methodList.innerHTML = `<li class="list-group-item text-muted">Brak zapisanych metod p≈Çatno≈õci</li>`;
                }
            })
            .catch(error => console.error("B≈ÇƒÖd ≈Çadowania metod p≈Çatno≈õci:", error));
    }

    function addPaymentMethod(formData) {
        fetch("/api/user/add_payment_method.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Metoda p≈Çatno≈õci zosta≈Ça dodana!");
                loadPaymentMethods();
            } else {
                alert("B≈ÇƒÖd: " + data.error);
            }
        })
        .catch(error => console.error("B≈ÇƒÖd dodawania metody p≈Çatno≈õci:", error));
    }

    function deletePaymentMethod(methodId) {
        if (!confirm("Czy na pewno chcesz usunƒÖƒá tƒô metodƒô p≈Çatno≈õci?")) return;

        fetch(`/api/user/delete_payment_method.php?id=${methodId}`, { method: "POST" })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Metoda p≈Çatno≈õci zosta≈Ça usuniƒôta!");
                loadPaymentMethods();
            } else {
                alert("B≈ÇƒÖd: " + data.error);
            }
        })
        .catch(error => console.error("B≈ÇƒÖd usuwania metody p≈Çatno≈õci:", error));
    }

    loadPaymentMethods();
});
</script>
=== public/views/payments/history.php ===
/*
|--------------------------------------------------------------------------
| Historia P≈Çatno≈õci
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi przeglƒÖdanie historii p≈Çatno≈õci i ich status√≥w.
| Obs≈Çuguje filtrowanie oraz podglƒÖd szczeg√≥≈Ç√≥w transakcji.
|
| ≈öcie≈ºka: App/Views/payments/history.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, dynamiczne pobieranie p≈Çatno≈õci)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane p≈Çatno≈õci)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego pobierania p≈Çatno≈õci)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Historia P≈Çatno≈õci</h1>

<div class="payments-history-container">
    <!-- Filtry p≈Çatno≈õci -->
    <form id="paymentFilterForm" class="row mt-4">
        <?= csrf_field() ?>
        <div class="col-md-4">
            <select class="form-control" name="status">
                <option value="">Wybierz status</option>
                <option value="completed">Zako≈Ñczona</option>
                <option value="pending">OczekujƒÖca</option>
                <option value="failed">Nieudana</option>
            </select>
        </div>
        <div class="col-md-4">
            <input type="date" class="form-control" name="start_date" placeholder="Data poczƒÖtkowa">
        </div>
        <div class="col-md-4 text-end">
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </div>
    </form>

    <!-- Tabela p≈Çatno≈õci -->
    <table class="table table-bordered table-striped table-responsive mt-3">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Kwota</th>
                <th>Metoda</th>
                <th>Status</th>
                <th>Data</th>
                <th class="text-center">Akcje</th>
            </tr>
        </thead>
        <tbody id="paymentList">
            <!-- Dane bƒôdƒÖ ≈Çadowane dynamicznie -->
        </tbody>
    </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterForm = document.getElementById("paymentFilterForm");

    filterForm.addEventListener("submit", function(e) {
        e.preventDefault();
        fetchPayments(new FormData(filterForm));
    });

    function fetchPayments(formData = null) {
        let url = "/api/user/payments.php";
        if (formData) {
            url += "?" + new URLSearchParams(formData).toString();
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const paymentTable = document.getElementById("paymentList");
                paymentTable.innerHTML = "";

                if (data.length === 0) {
                    paymentTable.innerHTML = `<tr><td colspan="6" class="text-center text-muted">Brak p≈Çatno≈õci spe≈ÇniajƒÖcych kryteria.</td></tr>`;
                } else {
                    data.forEach(payment => {
                        paymentTable.innerHTML += `
                            <tr>
                                <td>${payment.id}</td>
                                <td>${payment.amount} PLN</td>
                                <td>${payment.method}</td>
                                <td>${payment.status}</td>
                                <td>${payment.date}</td>
                                <td class="text-center">
                                    <button class="btn btn-info btn-sm" onclick="viewPayment(${payment.id})">PodglƒÖd</button>
                                    <button class="btn btn-warning btn-sm" onclick="refundPayment(${payment.id})">Zwrot</button>
                                </td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania p≈Çatno≈õci:", error));
    }

    function viewPayment(paymentId) {
        fetch(`/api/user/payment_details.php?id=${paymentId}`)
            .then(response => response.json())
            .then(data => {
                alert(`Szczeg√≥≈Çy p≈Çatno≈õci:\n\nKwota: ${data.amount} PLN\nMetoda: ${data.method}\nStatus: ${data.status}\nData: ${data.date}`);
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania szczeg√≥≈Ç√≥w p≈Çatno≈õci:", error));
    }

    function refundPayment(paymentId) {
        if (confirm("Czy na pewno chcesz zwr√≥ciƒá tƒô p≈Çatno≈õƒá?")) {
            fetch(`/api/user/refund_payment.php?id=${paymentId}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert("P≈Çatno≈õƒá zosta≈Ça zwr√≥cona.");
                        fetchPayments();
                    } else {
                        alert("B≈ÇƒÖd zwrotu p≈Çatno≈õci: " + data.message);
                    }
                })
                .catch(error => console.error("B≈ÇƒÖd zwrotu p≈Çatno≈õci:", error));
        }
    }

    fetchPayments();
});
</script>
=== public/views/payments/refund.php ===
<?php
/*
|--------------------------------------------------------------------------
| Historia Zwrot√≥w P≈Çatno≈õci
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi przeglƒÖdanie historii swoich zwrot√≥w p≈Çatno≈õci
| oraz ich status√≥w. Obs≈Çuguje filtrowanie oraz podglƒÖd szczeg√≥≈Ç√≥w.
|
| ≈öcie≈ºka: App/Views/payments/refund.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, dynamiczne pobieranie zwrot√≥w)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane zwrot√≥w p≈Çatno≈õci)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego pobierania zwrot√≥w)
| - HTML, CSS (interfejs)
*/


if (!isset($_SESSION['user_id'])) {
    header("Location: /auth/login.php");
    exit;
}

$userId = $_SESSION['user_id'];
?>

<h1 class="text-center">Historia Zwrot√≥w</h1>

<div class="payments-refund-container">
    <!-- Filtry zwrot√≥w -->
    <form id="refundFilterForm" class="row mt-4">
        <?= csrf_field() ?>
        <div class="col-md-4">
            <select class="form-control" name="status">
                <option value="">Wybierz status</option>
                <option value="processed">Zako≈Ñczony</option>
                <option value="pending">OczekujƒÖcy</option>
                <option value="failed">Nieudany</option>
            </select>
        </div>
        <div class="col-md-4">
            <input type="date" class="form-control" name="start_date" placeholder="Data poczƒÖtkowa">
        </div>
        <div class="col-md-4 text-end">
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </div>
    </form>

    <!-- Tabela zwrot√≥w -->
    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>Kwota</th>
                <th>Metoda</th>
                <th>Status</th>
                <th>Data</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody id="refundList">
            <tr>
                <td colspan="6" class="text-center text-muted">≈Åadowanie danych...</td>
            </tr>
        </tbody>
    </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterForm = document.getElementById("refundFilterForm");

    filterForm.addEventListener("submit", function(e) {
        e.preventDefault();
        fetchRefunds(new FormData(filterForm));
    });

    function fetchRefunds(formData = null) {
        let url = "/api/user/refunds.php";
        if (formData) {
            url += "?" + new URLSearchParams(formData).toString();
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const refundTable = document.getElementById("refundList");
                refundTable.innerHTML = "";

                if (data.length === 0) {
                    refundTable.innerHTML = `<tr><td colspan="6" class="text-center text-muted">Brak zwrot√≥w spe≈ÇniajƒÖcych kryteria.</td></tr>`;
                } else {
                    data.forEach(refund => {
                        let statusColor;
                        switch (refund.status) {
                            case "processed": statusColor = "text-success"; break;
                            case "pending": statusColor = "text-warning"; break;
                            case "failed": statusColor = "text-danger"; break;
                            default: statusColor = "text-secondary";
                        }

                        refundTable.innerHTML += `
                            <tr>
                                <td>${refund.id}</td>
                                <td>${refund.amount} PLN</td>
                                <td>${refund.method}</td>
                                <td class="${statusColor}">${refund.status}</td>
                                <td>${refund.date}</td>
                                <td>
                                    <button class="btn btn-info btn-sm" onclick="viewRefund(${refund.id})">PodglƒÖd</button>
                                </td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania zwrot√≥w:", error));
    }

    function viewRefund(refundId) {
        fetch(`/api/user/refund_details.php?id=${refundId}`)
            .then(response => response.json())
            .then(data => {
                alert(`Szczeg√≥≈Çy zwrotu:\n\nKwota: ${data.amount} PLN\nMetoda: ${data.method}\nStatus: ${data.status}\nData: ${data.date}`);
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania szczeg√≥≈Ç√≥w zwrotu:", error));
    }

    fetchRefunds();
});
</script>
=== public/views/dashboard.php ===
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarFuse - Dashboard</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<?php include __DIR__ . '/layouts/navbar.php'; ?>

<div class="dashboard-container">
    <div id="dashboard-view">
        <!-- Dashboard content will be loaded here -->
    </div>
</div>

<?php include __DIR__ . '/layouts/footer.php'; ?>
<script src="/js/shared.js"></script>
<script src="/js/main.js"></script>
</body>
</html>
<?php
// ...existing code...
$page = 'dashboard';
// ...existing code...
?>=== public/views/user/profile.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';
if (!isset($_SESSION['user_id'])) {
    header("Location: /login.php");
    exit();
}
$page = 'profile';

?>

/*
|--------------------------------------------------------------------------
| Edycja Profilu U≈ºytkownika
|--------------------------------------------------------------------------
| Ten plik pozwala u≈ºytkownikowi aktualizowaƒá swoje dane, zmieniaƒá has≈Ço
| oraz zarzƒÖdzaƒá swoim zdjƒôciem profilowym.
|
| ≈öcie≈ºka: App/Views/user/profile.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, walidacja formularzy)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane u≈ºytkownika)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego zapisu)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">M√≥j Profil</h1>

<div class="user-profile-container">
    <div class="row">
        <!-- Edycja Danych U≈ºytkownika -->
        <div class="col-md-6 mb-4">
            <div class="card shadow">
                <div class="card-body">
                    <h4>Edycja Danych</h4>
                    <form id="profileForm">
                        <?= csrf_field() ?>
                        <div class="mb-3">
                            <label for="name" class="form-label">Imiƒô i nazwisko</label>
                            <input type="text" class="form-control" id="name" name="name" value="<?= esc($user['name']) ?>" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Adres e-mail</label>
                            <input type="email" class="form-control" id="email" name="email" value="<?= esc($user['email']) ?>" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Zapisz zmiany</button>
                    </form>
                    <div id="profileResponseMessage" class="alert mt-3" style="display:none;"></div>
                </div>
            </div>
        </div>

        <!-- Zmiana Has≈Ça -->
        <div class="col-md-6 mb-4">
            <div class="card shadow">
                <div class="card-body">
                    <h4>Zmiana Has≈Ça</h4>
                    <form id="passwordForm">
                        <?= csrf_field() ?>
                        <div class="mb-3">
                            <label for="current_password" class="form-label">Obecne has≈Ço</label>
                            <input type="password" class="form-control" id="current_password" name="current_password" required>
                        </div>
                        <div class="mb-3">
                            <label for="new_password" class="form-label">Nowe has≈Ço</label>
                            <input type="password" class="form-control" id="new_password" name="new_password" required>
                        </div>
                        <div class="mb-3">
                            <label for="confirm_password" class="form-label">Potwierd≈∫ nowe has≈Ço</label>
                            <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                        </div>
                        <button type="submit" class="btn btn-danger w-100">Zmie≈Ñ has≈Ço</button>
                    </form>
                    <div id="passwordResponseMessage" class="alert mt-3" style="display:none;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ZarzƒÖdzanie Awatarem -->
    <div class="row mt-4">
        <div class="col-md-6 offset-md-3">
            <div class="card shadow text-center">
                <div class="card-body">
                    <h4>Zdjƒôcie Profilowe</h4>
                    <img id="profileAvatar" src="<?= esc($user['avatar_url'] ?? '/images/default-avatar.png') ?>" class="profile-avatar img-thumbnail mb-3" width="150">
                    <form id="avatarForm" enctype="multipart/form-data">
                        <?= csrf_field() ?>
                        <input type="file" class="form-control mb-2" id="avatar" name="avatar" accept="image/*" onchange="previewAvatar(event)">
                        <button type="submit" class="btn btn-success">Prze≈õlij nowe zdjƒôcie</button>
                        <button type="button" class="btn btn-danger" onclick="deleteAvatar()">Usu≈Ñ zdjƒôcie</button>
                    </form>
                    <div id="avatarResponseMessage" class="alert mt-3" style="display:none;"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const profileForm = document.getElementById("profileForm");
    const passwordForm = document.getElementById("passwordForm");
    const avatarForm = document.getElementById("avatarForm");
    const profileResponseMessage = document.getElementById("profileResponseMessage");
    const passwordResponseMessage = document.getElementById("passwordResponseMessage");
    const avatarResponseMessage = document.getElementById("avatarResponseMessage");

    profileForm.addEventListener("submit", function(e) {
        e.preventDefault();
        updateProfile(new FormData(profileForm));
    });

    passwordForm.addEventListener("submit", function(e) {
        e.preventDefault();
        updatePassword(new FormData(passwordForm));
    });

    avatarForm.addEventListener("submit", function(e) {
        e.preventDefault();
        updateAvatar(new FormData(avatarForm));
    });

    function updateProfile(formData) {
        fetch("/api/user/update_profile.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            profileResponseMessage.style.display = "block";
            if (data.success) {
                profileResponseMessage.className = "alert alert-success";
                profileResponseMessage.textContent = "Dane zaktualizowane!";
            } else {
                profileResponseMessage.className = "alert alert-danger";
                profileResponseMessage.textContent = "B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            profileResponseMessage.style.display = "block";
            profileResponseMessage.className = "alert alert-danger";
            profileResponseMessage.textContent = "B≈ÇƒÖd po≈ÇƒÖczenia z serwerem.";
            console.error("B≈ÇƒÖd aktualizacji profilu:", error);
        });
    }

    function updatePassword(formData) {
        fetch("/api/user/update_password.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            passwordResponseMessage.style.display = "block";
            if (data.success) {
                passwordResponseMessage.className = "alert alert-success";
                passwordResponseMessage.textContent = "Has≈Ço zmienione!";
            } else {
                passwordResponseMessage.className = "alert alert-danger";
                passwordResponseMessage.textContent = "B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            passwordResponseMessage.style.display = "block";
            passwordResponseMessage.className = "alert alert-danger";
            passwordResponseMessage.textContent = "B≈ÇƒÖd po≈ÇƒÖczenia z serwerem.";
            console.error("B≈ÇƒÖd zmiany has≈Ça:", error);
        });
    }

    function updateAvatar(formData) {
        fetch("/api/user/update_avatar.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            avatarResponseMessage.style.display = "block";
            if (data.success) {
                avatarResponseMessage.className = "alert alert-success";
                avatarResponseMessage.textContent = "Zdjƒôcie profilowe zaktualizowane!";
                location.reload();
            } else {
                avatarResponseMessage.className = "alert alert-danger";
                avatarResponseMessage.textContent = "B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            avatarResponseMessage.style.display = "block";
            avatarResponseMessage.className = "alert alert-danger";
            avatarResponseMessage.textContent = "B≈ÇƒÖd po≈ÇƒÖczenia z serwerem.";
            console.error("B≈ÇƒÖd aktualizacji awatara:", error);
        });
    }

    function deleteAvatar() {
        if (!confirm("Czy na pewno chcesz usunƒÖƒá zdjƒôcie profilowe?")) return;

        fetch("/api/user/delete_avatar.php", { method: "POST" })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Zdjƒôcie profilowe usuniƒôte!");
                location.reload();
            } else {
                alert("B≈ÇƒÖd: " + data.error);
            }
        })
        .catch(error => console.error("B≈ÇƒÖd usuwania awatara:", error));
    }

    function previewAvatar(event) {
        const reader = new FileReader();
        reader.onload = function() {
            const output = document.getElementById('profileAvatar');
            output.src = reader.result;
        };
        reader.readAsDataURL(event.target.files[0]);
    }
});
</script>
=== public/views/user/dashboard.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';
if (!isset($_SESSION['user_id'])) {
    header("Location: /login.php");
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Panel U≈ºytkownika
|--------------------------------------------------------------------------
| Ten plik jest centralnym miejscem zarzƒÖdzania kontem u≈ºytkownika. Wy≈õwietla
| podsumowanie aktywno≈õci oraz umo≈ºliwia prze≈ÇƒÖczanie miƒôdzy sekcjami dashboardu.
|
| ≈öcie≈ºka: App/Views/user/dashboard.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, dynamiczne ≈Çadowanie sekcji)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane u≈ºytkownika)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego ≈Çadowania sekcji)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Panel U≈ºytkownika</h1>

<div class="user-dashboard-container">
    <div class="row">
        <!-- Podsumowanie aktywno≈õci -->
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>Twoje Rezerwacje</h4>
                    <p id="totalBookings" class="display-6">0</p>
                    <a href="#bookings/view" class="dashboard-link">ZarzƒÖdzaj rezerwacjami</a>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>Historia P≈Çatno≈õci</h4>
                    <p id="totalPayments" class="display-6">0 PLN</p>
                    <a href="#payments/history" class="dashboard-link">Zobacz p≈Çatno≈õci</a>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body text-center">
                    <h4>Twoje Dokumenty</h4>
                    <p id="totalDocuments" class="display-6">0</p>
                    <a href="#documents/user_documents" class="dashboard-link">PrzeglƒÖdaj dokumenty</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Ostatnie powiadomienia -->
    <h3 class="mt-4">Ostatnie Powiadomienia</h3>
    <ul id="notificationList" class="list-group">
        <!-- Powiadomienia ≈Çadowane dynamicznie -->
    </ul>
    <div id="noNotificationsMessage" class="alert alert-warning mt-3" style="display:none;">Brak nowych powiadomie≈Ñ.</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    function loadDashboardData() {
        fetch("/api/user/dashboard_summary.php")
            .then(response => response.json())
            .then(data => {
                document.getElementById("totalBookings").textContent = data.totalBookings || 0;
                document.getElementById("totalPayments").textContent = data.totalPayments + " PLN" || "0 PLN";
                document.getElementById("totalDocuments").textContent = data.totalDocuments || 0;

                const notificationList = document.getElementById("notificationList");
                const noNotificationsMessage = document.getElementById("noNotificationsMessage");
                notificationList.innerHTML = "";
                if (data.notifications.length > 0) {
                    data.notifications.forEach(notification => {
                        notificationList.innerHTML += `<li class="list-group-item">${notification.message}</li>`;
                    });
                    noNotificationsMessage.style.display = "none";
                } else {
                    noNotificationsMessage.style.display = "block";
                }
            })
            .catch(error => console.error("B≈ÇƒÖd ≈Çadowania danych u≈ºytkownika:", error));
    }

    loadDashboardData();
});
</script>
=== public/views/user/notifications.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';
if (!isset($_SESSION['user_id'])) {
    header("Location: /login.php");
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Powiadomienia U≈ºytkownika
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi przeglƒÖdanie powiadomie≈Ñ, oznaczanie ich
| jako przeczytane oraz usuwanie.
|
| ≈öcie≈ºka: App/Views/user/notifications.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane powiadomie≈Ñ)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego ≈Çadowania i aktualizacji powiadomie≈Ñ)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Powiadomienia</h1>

<div class="user-notifications-container">
    <ul id="notificationList" class="list-group">
        <!-- Powiadomienia ≈Çadowane dynamicznie -->
    </ul>
    <div id="noNotificationsMessage" class="alert alert-warning mt-3" style="display:none;">Brak nowych powiadomie≈Ñ.</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    function loadNotifications() {
        fetch("/api/user/get_notifications.php")
            .then(response => response.json())
            .then(data => {
                const notificationList = document.getElementById("notificationList");
                const noNotificationsMessage = document.getElementById("noNotificationsMessage");
                notificationList.innerHTML = "";
                
                if (data.length > 0) {
                    data.forEach(notification => {
                        notificationList.innerHTML += `
                            <li class="list-group-item d-flex justify-content-between align-items-center ${notification.is_read ? '' : 'list-group-item-warning'}">
                                <span onclick="markAsRead(${notification.id}, this)">${notification.message}</span>
                                <div>
                                    <button class="btn btn-sm btn-danger" onclick="deleteNotification(${notification.id})">Usu≈Ñ</button>
                                </div>
                            </li>
                        `;
                    });
                    noNotificationsMessage.style.display = "none";
                } else {
                    noNotificationsMessage.style.display = "block";
                }
            })
            .catch(error => console.error("B≈ÇƒÖd ≈Çadowania powiadomie≈Ñ:", error));
    }

    function markAsRead(notificationId, element) {
        fetch(`/api/user/mark_notification_read.php?id=${notificationId}`, { method: "POST" })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    element.parentElement.classList.remove('list-group-item-warning');
                } else {
                    alert("B≈ÇƒÖd: " + data.error);
                }
            })
            .catch(error => console.error("B≈ÇƒÖd oznaczania powiadomienia:", error));
    }

    function deleteNotification(notificationId) {
        if (!confirm("Czy na pewno chcesz usunƒÖƒá to powiadomienie?")) return;

        fetch(`/api/user/delete_notification.php?id=${notificationId}`, { method: "POST" })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    loadNotifications();
                } else {
                    alert("B≈ÇƒÖd: " + data.error);
                }
            })
            .catch(error => console.error("B≈ÇƒÖd usuwania powiadomienia:", error));
    }

    loadNotifications();
});
</script>
=== public/views/user/documents.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';

if (!isset($_SESSION['user_id'])) {
    header("Location: /login");
    exit();
}
?>

<h1 class="text-center">ZarzƒÖdzanie Dokumentami</h1>

<div class="documents-container">
    <form id="documentUploadForm" class="mt-3">
        <?= csrf_field() ?>
        <input type="file" name="document" class="form-control">
        <button type="submit" class="btn btn-primary mt-2">Prze≈õlij Dokument</button>
    </form>

    <ul id="documentList" class="list-group mt-3">
        <!-- Dokumenty bƒôdƒÖ ≈Çadowane dynamicznie -->
    </ul>
</div>

<script src="/js/documents.js"></script>
=== public/views/user/reports.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';
if (!isset($_SESSION['user_id'])) {
    header("Location: /login.php");
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Raporty U≈ºytkownika
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi generowanie raport√≥w dotyczƒÖcych rezerwacji,
| p≈Çatno≈õci i aktywno≈õci w systemie. Raporty mogƒÖ byƒá eksportowane do CSV, PDF, JSON.
|
| ≈öcie≈ºka: App/Views/user/reports.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, dynamiczne generowanie raport√≥w)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane do raport√≥w)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego generowania raport√≥w)
| - Chart.js (wizualizacja raport√≥w)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Raporty</h1>

<div class="user-reports-container">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card shadow">
                <div class="card-body">
                    <h4>Generowanie Raport√≥w</h4>
                    <form id="reportForm">
                        <?= csrf_field() ?>

                        <div class="mb-3">
                            <label for="reportType" class="form-label">Typ raportu</label>
                            <select class="form-select" id="reportType" name="reportType" required>
                                <option value="" disabled selected>Wybierz typ raportu</option>
                                <option value="bookings">Rezerwacje</option>
                                <option value="payments">P≈Çatno≈õci</option>
                                <option value="activity">Aktywno≈õƒá u≈ºytkownika</option>
                            </select>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="startDate" class="form-label">Data poczƒÖtkowa</label>
                                <input type="date" class="form-control" id="startDate" name="startDate" required>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="endDate" class="form-label">Data ko≈Ñcowa</label>
                                <input type="date" class="form-control" id="endDate" name="endDate" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="format" class="form-label">Format raportu</label>
                            <select class="form-select" id="format" name="format" required>
                                <option value="csv">CSV</option>
                                <option value="pdf">PDF</option>
                                <option value="json">JSON</option>
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">Generuj raport</button>
                    </form>

                    <div id="responseMessage" class="alert mt-3" style="display:none;"></div>
                    <div id="noResultsMessage" class="alert alert-warning mt-3" style="display:none;">Brak wynik√≥w dla wybranych kryteri√≥w.</div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-4">
        <h4>PodglƒÖd raportu</h4>
        <canvas id="reportChart"></canvas>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const reportForm = document.getElementById("reportForm");
    const responseMessage = document.getElementById("responseMessage");
    const noResultsMessage = document.getElementById("noResultsMessage");

    reportForm.addEventListener("submit", function(e) {
        e.preventDefault();
        generateReport(new FormData(reportForm));
    });

    function generateReport(formData) {
        let url = "/api/user/reports.php";

        fetch(url, {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            responseMessage.style.display = "block";
            if (data.success) {
                responseMessage.className = "alert alert-success";
                responseMessage.textContent = "Raport wygenerowany pomy≈õlnie! Pobierz go tutaj: " + data.download_link;
                renderChart(data.chartData);
                noResultsMessage.style.display = "none";
            } else if (data.noResults) {
                noResultsMessage.style.display = "block";
                responseMessage.style.display = "none";
            } else {
                responseMessage.className = "alert alert-danger";
                responseMessage.textContent = "B≈ÇƒÖd: " + data.error;
                noResultsMessage.style.display = "none";
            }
        })
        .catch(error => {
            responseMessage.style.display = "block";
            responseMessage.className = "alert alert-danger";
            responseMessage.textContent = "B≈ÇƒÖd po≈ÇƒÖczenia z serwerem.";
            console.error("B≈ÇƒÖd generowania raportu:", error);
            noResultsMessage.style.display = "none";
        });
    }

    function renderChart(chartData) {
        const ctx = document.getElementById("reportChart").getContext("2d");
        new Chart(ctx, {
            type: "bar",
            data: {
                labels: chartData.labels,
                datasets: [{
                    label: "Liczba zg≈Çosze≈Ñ",
                    data: chartData.values,
                    backgroundColor: "rgba(54, 162, 235, 0.6)"
                }]
            }
        });
    }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
=== public/views/bookings/view.php ===
<?php
// Sprawdzenie sesji u≈ºytkownika

if (!isset($_SESSION['user_id'])) {
    header("Location: /login");
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Lista Rezerwacji U≈ºytkownika
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi przeglƒÖdanie swoich rezerwacji, filtrowanie
| ich oraz sprawdzanie statusu ka≈ºdej rezerwacji.
|
| ≈öcie≈ºka: App/Views/bookings/view.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, dynamiczne ≈Çadowanie rezerwacji)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane o rezerwacjach)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego ≈Çadowania rezerwacji)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Moje Rezerwacje</h1>

<div class="bookings-container">
    <!-- Filtry rezerwacji -->
    <form id="bookingFilterForm" class="row mt-4">
        <?= csrf_field() ?>
        <div class="col-md-4">
            <select class="form-control" name="status">
                <option value="">Wybierz status</option>
                <option value="active">Aktywna</option>
                <option value="completed">Zako≈Ñczona</option>
                <option value="cancelled">Anulowana</option>
            </select>
        </div>
        <div class="col-md-4">
            <input type="date" class="form-control" name="start_date" placeholder="Data poczƒÖtkowa">
        </div>
        <div class="col-md-4 text-end">
            <button type="submit" class="btn btn-primary">Filtruj</button>
        </div>
    </form>

    <!-- Tabela rezerwacji -->
    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>Pojazd</th>
                <th>Data rozpoczƒôcia</th>
                <th>Data zako≈Ñczenia</th>
                <th>Status</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody id="bookingList">
            <!-- Dane bƒôdƒÖ ≈Çadowane dynamicznie -->
        </tbody>
    </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const filterForm = document.getElementById("bookingFilterForm");

    filterForm.addEventListener("submit", function(e) {
        e.preventDefault();
        fetchBookings(new FormData(filterForm));
    });

    function fetchBookings(formData = null) {
        let url = "/api/user/bookings.php";
        if (formData) {
            url += "?" + new URLSearchParams(formData).toString();
        }

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const bookingTable = document.getElementById("bookingList");
                bookingTable.innerHTML = "";

                if (data.length === 0) {
                    bookingTable.innerHTML = `<tr><td colspan="6" class="text-center text-muted">Brak rezerwacji spe≈ÇniajƒÖcych kryteria.</td></tr>`;
                } else {
                    data.forEach(booking => {
                        let statusClass = "";
                        switch (booking.status) {
                            case "active":
                                statusClass = "text-success";
                                break;
                            case "completed":
                                statusClass = "text-secondary";
                                break;
                            case "cancelled":
                                statusClass = "text-danger";
                                break;
                        }
                        bookingTable.innerHTML += `
                            <tr>
                                <td>${booking.id}</td>
                                <td>${booking.vehicle}</td>
                                <td>${booking.start_date}</td>
                                <td>${booking.end_date}</td>
                                <td class="${statusClass}">${booking.status}</td>
                                <td>
                                    <button class="btn btn-info btn-sm" onclick="viewBooking(${booking.id})">PodglƒÖd</button>
                                </td>
                            </tr>
                        `;
                    });
                }
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania rezerwacji:", error));
    }

    function viewBooking(bookingId) {
        fetch(`/api/user/booking_details.php?id=${bookingId}`)
            .then(response => response.json())
            .then(data => {
                alert(`Szczeg√≥≈Çy rezerwacji:\n\nPojazd: ${data.vehicle}\nOd: ${data.start_date}\nDo: ${data.end_date}\nStatus: ${data.status}`);
            })
            .catch(error => console.error("B≈ÇƒÖd pobierania szczeg√≥≈Ç√≥w rezerwacji:", error));
    }

    fetchBookings();
});
</script>
=== public/views/bookings/create.php ===
<?php
// Sprawdzenie sesji u≈ºytkownika

if (!isset($_SESSION['user_id'])) {
    header("Location: /login");
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Tworzenie Nowej Rezerwacji
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi dokonanie nowej rezerwacji pojazdu.
| Sprawdza dostƒôpno≈õƒá pojazd√≥w i umo≈ºliwia wyb√≥r metody p≈Çatno≈õci.
|
| ≈öcie≈ºka: App/Views/bookings/create.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, dynamiczne sprawdzanie dostƒôpno≈õci)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane pojazd√≥w, dostƒôpno≈õƒá, rezerwacje)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego sprawdzania dostƒôpno≈õci)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Nowa Rezerwacja</h1>

<div class="bookings-create-container">
    <form id="bookingForm">
        <?= csrf_field() ?>

        <!-- Wyb√≥r pojazdu -->
        <div class="mb-3">
            <label for="vehicle" class="form-label">Wybierz pojazd</label>
            <select class="form-select" id="vehicle" name="vehicle" required>
                <option value="" disabled selected>Wybierz pojazd</option>
                <?php foreach ($vehicles as $vehicle): ?>
                    <option value="<?= esc($vehicle['id']) ?>"><?= esc($vehicle['name']) ?> ‚Äì <?= esc($vehicle['price']) ?> PLN/dzie≈Ñ</option>
                <?php endforeach; ?>
            </select>
        </div>

        <!-- Wyb√≥r daty rezerwacji -->
        <div class="row">
            <div class="col-md-6 col-12 mb-3">
                <label for="start_date" class="form-label">Data rozpoczƒôcia</label>
                <input type="date" class="form-control" id="start_date" name="start_date" required>
            </div>
            <div class="col-md-6 col-12 mb-3">
                <label for="end_date" class="form-label">Data zako≈Ñczenia</label>
                <input type="date" class="form-control" id="end_date" name="end_date" required>
            </div>
        </div>

        <!-- Metoda p≈Çatno≈õci -->
        <div class="mb-3">
            <label for="payment_method" class="form-label">Metoda p≈Çatno≈õci</label>
            <select class="form-select" id="payment_method" name="payment_method" required>
                <option value="card">Karta kredytowa</option>
                <option value="paypal">PayPal</option>
                <option value="transfer">Przelew bankowy</option>
            </select>
        </div>

        <button type="submit" class="btn btn-primary w-100">Zarezerwuj</button>
    </form>

    <div id="responseMessage" class="alert mt-3" style="display:none;"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const bookingForm = document.getElementById("bookingForm");
    const responseMessage = document.getElementById("responseMessage");
    const vehicleSelect = document.getElementById("vehicle");
    const startDateInput = document.getElementById("start_date");
    const endDateInput = document.getElementById("end_date");

    // Sprawdzanie dostƒôpno≈õci pojazdu
    vehicleSelect.addEventListener("change", function() {
        checkAvailability(vehicleSelect.value);
    });

    bookingForm.addEventListener("submit", function(e) {
        e.preventDefault();
        if (validateForm()) {
            submitBooking(new FormData(bookingForm));
        }
    });

    function checkAvailability(vehicleId) {
        if (!vehicleId) return;
        fetch(`/api/bookings/check_availability.php?vehicle_id=${vehicleId}`)
            .then(response => response.json())
            .then(data => {
                if (!data.available) {
                    alert("Wybrany pojazd jest niedostƒôpny w wybranym terminie.");
                    vehicleSelect.value = "";
                }
            })
            .catch(error => console.error("B≈ÇƒÖd sprawdzania dostƒôpno≈õci:", error));
    }

    function validateForm() {
        const startDate = new Date(startDateInput.value);
        const endDate = new Date(endDateInput.value);
        if (startDate >= endDate) {
            alert("Data zako≈Ñczenia musi byƒá p√≥≈∫niejsza ni≈º data rozpoczƒôcia.");
            return false;
        }
        return true;
    }

    function submitBooking(formData) {
        fetch("/api/bookings/create.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            responseMessage.style.display = "block";
            if (data.success) {
                responseMessage.className = "alert alert-success";
                responseMessage.textContent = "Rezerwacja zosta≈Ça pomy≈õlnie dokonana!";
                setTimeout(() => window.location.href = "/dashboard", 2000);
            } else {
                responseMessage.className = "alert alert-danger";
                responseMessage.textContent = "B≈ÇƒÖd: " + data.error;
            }
        })
        .catch(error => {
            responseMessage.style.display = "block";
            responseMessage.className = "alert alert-danger";
            responseMessage.textContent = "B≈ÇƒÖd po≈ÇƒÖczenia z serwerem.";
            console.error("B≈ÇƒÖd rezerwacji:", error);
        });
    }
});
</script>
=== public/views/home.php ===
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarFuse - Strona G≈Ç√≥wna</title>
    <link rel="stylesheet" href="/css/style.css">
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            fetch('/api/views/home.php')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    document.getElementById('content').innerHTML = data.content;
                })
                .catch(error => {
                    document.getElementById('content').innerHTML = '<p>Error loading content. Please try again later.</p>';
                    console.error('There was a problem with the fetch operation:', error);
                });
        });
    </script>
</head>
<body>
<?php include __DIR__ . '/layouts/navbar.php'; ?>

<div id="content">
    <!-- Content will be loaded here dynamically -->
</div>

<?php include __DIR__ . '/layouts/footer.php'; ?>
<script src="/js/shared.js"></script>
</body>
</html>
=== public/views/documents/signing_page.php ===
<?php
// Sprawdzenie sesji u≈ºytkownika

if (!isset($_SESSION['user_id'])) {
    header("Location: /login");
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Podpisywanie Dokument√≥w
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi podpisywanie dokument√≥w online.
| Podpisane dokumenty sƒÖ przechowywane w systemie.
|
| ≈öcie≈ºka: App/Views/documents/signing_page.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, podpis elektroniczny)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane dokument√≥w)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (Canvas API do podpisywania dokument√≥w)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Podpisywanie Dokument√≥w</h1>

<div class="documents-sign-container">
    <h3 class="mt-4">Dokumenty do Podpisania</h3>
    <ul id="signDocumentList" class="list-group">
        <!-- Dokumenty ≈Çadowane dynamicznie -->
    </ul>

    <!-- PodglƒÖd dokumentu i podpis elektroniczny -->
    <div id="signingArea" class="mt-4" style="display:none;">
        <h4>Podpisz Dokument</h4>
        <iframe id="documentPreview" style="width:100%; height:400px; border:1px solid #ccc;" onload="resizeIframe(this)"></iframe>
        
        <canvas id="signaturePad" class="border mt-3" style="width:100%; height:200px;" onmousedown="startDrawing(event)" onmouseup="stopDrawing()" onmousemove="draw(event)" ontouchstart="startDrawing(event)" ontouchend="stopDrawing()" ontouchmove="draw(event)"></canvas>
        <button class="btn btn-secondary mt-2" onclick="clearSignature()">Wyczy≈õƒá</button>
        <button class="btn btn-primary mt-2" onclick="submitSignature()">Podpisz</button>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    function loadSignDocuments() {
        fetch("/api/user/get_signable_documents.php")
            .then(response => response.json())
            .then(data => {
                const documentList = document.getElementById("signDocumentList");
                documentList.innerHTML = "";

                if (data.length > 0) {
                    data.forEach(doc => {
                        documentList.innerHTML += `
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>${doc.name}</span>
                                <button class="btn btn-sm btn-success" onclick="openSigning('${doc.file_url}', ${doc.id})">Podpisz</button>
                            </li>
                        `;
                    });
                } else {
                    documentList.innerHTML = `<li class="list-group-item text-muted">Brak dokument√≥w do podpisania</li>`;
                }
            })
            .catch(error => {
                console.error("B≈ÇƒÖd ≈Çadowania dokument√≥w:", error);
                alert("B≈ÇƒÖd ≈Çadowania dokument√≥w.");
            });
    }

    function openSigning(fileUrl, documentId) {
        document.getElementById("signingArea").style.display = "block";
        document.getElementById("documentPreview").src = fileUrl;
        document.getElementById("signaturePad").dataset.documentId = documentId;
    }

    function clearSignature() {
        const canvas = document.getElementById("signaturePad");
        const ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function submitSignature() {
        const canvas = document.getElementById("signaturePad");
        const signature = canvas.toDataURL();
        const documentId = canvas.dataset.documentId;

        fetch("/api/user/sign_document.php", {
            method: "POST",
            body: JSON.stringify({ documentId, signature }),
            headers: { "Content-Type": "application/json" }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Dokument zosta≈Ç podpisany!");
                loadSignDocuments();
                document.getElementById("signingArea").style.display = "none";
            } else {
                alert("B≈ÇƒÖd: " + data.error);
            }
        })
        .catch(error => {
            console.error("B≈ÇƒÖd podpisywania dokumentu:", error);
            alert("B≈ÇƒÖd podpisywania dokumentu.");
        });
    }

    loadSignDocuments();
});

function resizeIframe(iframe) {
    iframe.style.height = iframe.contentWindow.document.documentElement.scrollHeight + 'px';
}

let isDrawing = false;
let lastX = 0;
let lastY = 0;
const canvas = document.getElementById("signaturePad");
const ctx = canvas.getContext("2d");

function startDrawing(event) {
    isDrawing = true;
    [lastX, lastY] = getCoordinates(event);
}

function stopDrawing() {
    isDrawing = false;
    ctx.beginPath();
}

function draw(event) {
    if (!isDrawing) return;
    const [x, y] = getCoordinates(event);
    ctx.lineWidth = 2;
    ctx.lineCap = "round";
    ctx.strokeStyle = "#000";
    ctx.lineTo(x, y);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(x, y);
    [lastX, lastY] = [x, y];
}

function getCoordinates(event) {
    const rect = canvas.getBoundingClientRect();
    const x = (event.clientX || event.touches[0].clientX) - rect.left;
    const y = (event.clientY || event.touches[0].clientY) - rect.top;
    return [x, y];
}
</script>
=== public/views/documents/user_documents.php ===
<?php
// Sprawdzenie sesji u≈ºytkownika

if (!isset($_SESSION['user_id'])) {
    header("Location: /login");
    exit();
}
?>

/*
|--------------------------------------------------------------------------
| Dokumenty U≈ºytkownika
|--------------------------------------------------------------------------
| Ten plik umo≈ºliwia u≈ºytkownikowi przeglƒÖdanie dokument√≥w, ich przesy≈Çanie
| oraz usuwanie. Pliki mogƒÖ byƒá np. umowami, fakturami czy dokumentami to≈ºsamo≈õci.
|
| ≈öcie≈ºka: App/Views/documents/user_documents.php
|
| Zale≈ºy od:
| - JavaScript: /js/dashboard.js (obs≈Çuga AJAX, przesy≈Çanie, usuwanie)
| - CSS: /css/dashboard.css (stylizacja interfejsu u≈ºytkownika)
| - PHP: csrf_field() (zabezpieczenie formularzy)
| - MySQL (dane dokument√≥w)
|
| Technologie:
| - PHP 8+ (backend)
| - MySQL (baza danych)
| - JavaScript (AJAX do dynamicznego ≈Çadowania i usuwania plik√≥w)
| - HTML, CSS (interfejs)
*/

<h1 class="text-center">Moje Dokumenty</h1>

<div class="documents-container">
    <!-- Przesy≈Çanie nowego dokumentu -->
    <form id="uploadDocumentForm" enctype="multipart/form-data" class="mb-4">
        <?= csrf_field() ?>
        <div class="mb-3">
            <label for="document" class="form-label">Prze≈õlij dokument (PDF, JPG, PNG)</label>
            <input type="file" class="form-control" id="document" name="document" accept=".pdf, .jpg, .jpeg, .png" required>
        </div>
        <button type="submit" class="btn btn-success">Prze≈õlij</button>
    </form>

    <!-- Lista dokument√≥w -->
    <h3 class="mt-4">Twoje Dokumenty</h3>
    <ul id="documentList" class="list-group">
        <!-- Dokumenty ≈Çadowane dynamicznie -->
    </ul>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const uploadForm = document.getElementById("uploadDocumentForm");

    uploadForm.addEventListener("submit", function(e) {
        e.preventDefault();
        const fileInput = document.getElementById("document");
        const file = fileInput.files[0];
        if (file && (file.type === "application/pdf" || file.type.startsWith("image/"))) {
            uploadDocument(new FormData(uploadForm));
        } else {
            alert("Nieprawid≈Çowy typ pliku. Dozwolone formaty: PDF, JPG, PNG.");
        }
    });

    function loadDocuments() {
        fetch("/api/user/get_documents.php")
            .then(response => response.json())
            .then(data => {
                const documentList = document.getElementById("documentList");
                documentList.innerHTML = "";

                if (data.length > 0) {
                    data.forEach(doc => {
                        documentList.innerHTML += `
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <a href="${doc.file_url}" target="_blank">${doc.name}</a>
                                <button class="btn btn-sm btn-danger" onclick="deleteDocument(${doc.id})">Usu≈Ñ</button>
                            </li>
                        `;
                    });
                } else {
                    documentList.innerHTML = `<li class="list-group-item text-muted">Brak dokument√≥w</li>`;
                }
            })
            .catch(error => {
                console.error("B≈ÇƒÖd ≈Çadowania dokument√≥w:", error);
                alert("B≈ÇƒÖd ≈Çadowania dokument√≥w.");
            });
    }

    function uploadDocument(formData) {
        fetch("/api/user/upload_document.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Dokument przes≈Çany pomy≈õlnie!");
                loadDocuments();
            } else {
                alert("B≈ÇƒÖd: " + data.error);
            }
        })
        .catch(error => {
            console.error("B≈ÇƒÖd przesy≈Çania dokumentu:", error);
            alert("B≈ÇƒÖd przesy≈Çania dokumentu.");
        });
    }

    function deleteDocument(documentId) {
        if (!confirm("Czy na pewno chcesz usunƒÖƒá ten dokument?")) return;

        fetch(`/api/user/delete_document.php?id=${documentId}`, { method: "POST" })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Dokument usuniƒôty!");
                loadDocuments();
            } else {
                alert("B≈ÇƒÖd: " + data.error);
            }
        })
        .catch(error => {
            console.error("B≈ÇƒÖd usuwania dokumentu:", error);
            alert("B≈ÇƒÖd usuwania dokumentu.");
        });
    }

    loadDocuments();
});
</script>
=== public/views/dashboard/dashboard.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';
$userRole = $_SESSION['user_role'] ?? 'user'; // Assume 'user' role if not set

$module = $_GET['module'] ?? 'home';
$view = __DIR__ . "/dashboard_modules/{$module}.php";

if (!file_exists($view)) {
    $view = __DIR__ . "/dashboard_modules/404.php"; // Load 404 if module doesn't exist
}

// Removed any redundant <script> tags for main.js to prevent double loading

include __DIR__ . '/../layouts/main.php';
?>
=== public/views/dashboard/modules/admin/payments/dashboard.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="payments-dashboard">
    <?php include __DIR__ . '/../../../admin/payments/dashboard.php'; ?>
</div>
=== public/views/dashboard/modules/admin/payments/transactions.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="transactions-container">
    <?php include __DIR__ . '/../../../admin/transactions.php'; ?>
</div>
=== public/views/dashboard/modules/admin/payments/refunds.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="refunds-container">
    <?php include __DIR__ . '/../../../admin/refunds.php'; ?>
</div>
=== public/views/dashboard/modules/admin/dashboard.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="dashboard-overview">
    <?php include __DIR__ . '/../../admin/dashboard.php'; ?>
</div>
=== public/views/dashboard/modules/admin/users.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="users-container">
    <?php include __DIR__ . '/../../admin/users.php'; ?>
</div>
=== public/views/dashboard/modules/admin/audit_logs.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="audit-logs-container">
    <?php include __DIR__ . '/../../admin/audit_logs.php'; ?>
</div>
=== public/views/dashboard/modules/admin/logs.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="logs-container">
    <?php include __DIR__ . '/../../admin/logs.php'; ?>
</div>
=== public/views/dashboard/modules/admin/documents.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="documents-container">
    <?php include __DIR__ . '/../../admin/documents.php'; ?>
</div>
=== public/views/dashboard/modules/admin/reports.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="reports-container">
    <?php include __DIR__ . '/../../admin/reports.php'; ?>
</div>
=== public/views/dashboard/modules/admin/settings.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn() || getUserRole() !== 'admin') {
    header("Location: /admin/login");
    exit();
}
?>

<div class="settings-container">
    <?php include __DIR__ . '/../../admin/settings.php'; ?>
</div>
=== public/views/dashboard/modules/user/profile.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn()) {
    header("Location: /login");
    exit();
}
?>

<div class="profile-container">
    <?php include __DIR__ . '/../../user/profile.php'; ?>
</div>
=== public/views/dashboard/modules/user/documentd.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn()) {
    header("Location: /login");
    exit();
}
?>

<div class="documents-container">
    <?php include __DIR__ . '/../../user/documents.php'; ?>
</div>
=== public/views/dashboard/modules/user/overview.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn()) {
    header("Location: /login");
    exit();
}
?>

<div class="dashboard-overview">
    <?php include __DIR__ . '/../../user/dashboard.php'; ?>
</div>
=== public/views/dashboard/modules/user/bookings/view.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn()) {
    header("Location: /login");
    exit();
}
?>

<div class="bookings-container">
    <?php include __DIR__ . '/../../user/bookings.php'; ?>
</div>
=== public/views/dashboard/modules/user/notifications.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn()) {
    header("Location: /login");
    exit();
}
?>

<div class="notifications-container">
    <?php include __DIR__ . '/../../user/notifications.php'; ?>
</div>
=== public/views/dashboard/modules/user/settings.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn()) {
    header("Location: /login");
    exit();
}
?>

<div class="settings-container">
    <?php include __DIR__ . '/../../user/settings.php'; ?>
</div>
=== public/views/dashboard/modules/user/payments.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn()) {
    header("Location: /login");
    exit();
}
?>

<div class="payments-container">
    <?php include __DIR__ . '/../../user/payments.php'; ?>
</div>
=== public/views/dashboard/modules/shared/charts.php ===
<?php
require_once __DIR__ . '/../../../helpers/SecurityHelper.php';

if (!isUserLoggedIn()) {
    header("Location: /login");
    exit();
}
?>

<div class="charts-container">
    <div class="row">
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-body">
                    <h5 class="text-center">Trendy Rezerwacji</h5>
                    <canvas id="bookingTrends"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-body">
                    <h5 class="text-center">Trendy Przychod√≥w</h5>
                    <canvas id="revenueTrends"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="/js/shared.js"></script>
=== public/views/dashboard/modules/shared/tables.php ===
<?php
require_once __DIR__ . '/../../helpers/SecurityHelper.php';

if (!isUserLoggedIn()) {
    header("Location: /login");
    exit();
}
?>

<div class="tables-container">
    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nazwa</th>
                <th>Status</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody id="sharedTableData">
            <!-- Dynamiczne ≈Çadowanie danych -->
        </tbody>
    </table>
</div>

<script src="/js/tables.js"></script>
=== public/views/dashboard/modules/shared/modals.php ===
<div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Potwierdzenie</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Czy na pewno chcesz wykonaƒá tƒô akcjƒô?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" id="confirmAction">Tak</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Anuluj</button>
            </div>
        </div>
    </div>
</div>

<script src="/js/modals.js"></script>
=== public/login.php ===
<?php
session_start();

if ($_SERVER["REQUEST_METHOD"] === "POST") {
    $username = $_POST["username"] ?? "";
    $password = $_POST["password"] ?? "";

    // Simulated authentication check
    if ($username === "admin" && $password === "password") {
        $_SESSION["user_id"] = 1;
        $_SESSION["username"] = "admin";
        header("Location: /dashboard");
        exit();
    } else {
        $error = "Invalid credentials!";
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="/css/shared.css">
</head>
<body>
    <h1>Login</h1>

    <?php if (isset($error)) : ?>
        <p style="color: red;"><?= htmlspecialchars($error) ?></p>
    <?php endif; ?>

    <form method="POST">
        <label>Username:</label>
        <input type="text" name="username" required>
        
        <label>Password:</label>
        <input type="password" name="password" required>
        
        <button type="submit">Login</button>
    </form>

    <p><a href="/">Back to Home</a></p>
</body>
</html>
=== public/js/shared.js ===
document.addEventListener("DOMContentLoaded", function () {
    console.log("Minimal JavaScript Loaded");

    fetch("/api/test")
        .then(response => response.json())
        .then(data => console.log("API Response:", data))
        .catch(error => console.error("API Error:", error));
});
=== public/helpers/SecurityHelper.php ===
<?php
function startMinimalSession() {
    if (session_status() === PHP_SESSION_NONE) {
        session_start();
        if (!isset($_SESSION['user_id'])) {
            $_SESSION['guest'] = true;
        }
    }
}
startMinimalSession();
?>
