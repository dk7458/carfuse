RewriteEngine On

# ✅ Forward Authorization header to PHP
SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1

# ✅ Automatically map requests to /public/ if they exist there (EXCEPT /api/)
RewriteCond %{REQUEST_URI} !^/public/
RewriteCond %{REQUEST_URI} !^/api/
RewriteCond %{DOCUMENT_ROOT}/public/%{REQUEST_URI} -f
RewriteRule ^(.*)$ public/$1 [L]

# ✅ Route API requests to public/api.php
RewriteCond %{REQUEST_URI} ^/api/ [NC]
RewriteRule ^api/(.*)$ /public/api.php?route=$1 [QSA,L]

# ✅ Prevent direct access to backend directories
RewriteRule ^(App/Controllers|App/Services|config|vendor|logs) - [F,L]

# ✅ Allow direct access to static files in public
RewriteCond %{REQUEST_URI} ^/(css|js|images|views|uploads|assets)/(.*)$
RewriteCond %{DOCUMENT_ROOT}/public/%1/%2 -f
RewriteRule ^(css|js|images|views|uploads|assets)/(.*)$ /public/$1/$2 [L]

# ✅ Ensure requests with no extension are forwarded correctly
RewriteCond %{REQUEST_URI} !\.(css|js|png|jpg|jpeg|gif|svg|woff|woff2|ttf|eot|ico|pdf|json)$ [NC]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# ✅ Forward remaining requests to public/index.php for FastRoute
RewriteRule ^ index.php [QSA,L]
